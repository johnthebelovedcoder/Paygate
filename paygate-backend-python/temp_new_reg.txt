    # Generate email verification token
    verification_token = user_service.create_access_token(
        data={"sub": db_user.email},
        expires_delta=timedelta(hours=24)  # Verification token expires in 24 hours
    )

    # Send email verification
    try:
        from tasks.email import send_verification_email
        send_verification_email.delay(db_user.email, db_user.full_name or db_user.email, verification_token)
    except Exception as e:
        print(f"[WARNING] Could not send verification email: {str(e)}. User created but no verification email sent.")
        import logging
        logger = logging.getLogger(__name__)
        logger.error(f"Could not send verification email: {str(e)}")

    # Return success message without tokens
    return {
        "success": True,
        "message": "Registration successful! Please check your email to verify your account."
    }