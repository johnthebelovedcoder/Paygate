INFO:     Will watch for changes in these directories: ['C:\\Users\\Home\\Downloads\\Documents\\paygate\\paygate-backend-python']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [49100] using WatchFiles
INFO:     Started server process [52604]
INFO:     Waiting for application startup.
2025-10-22 16:15:17,701 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:17,701 INFO sqlalchemy.engine.Engine COMMIT
INFO:     Application startup complete.
In-memory cache initialized
Database tables created successfully
2025-10-22 16:15:18,104 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:18,144 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:18,144 INFO sqlalchemy.engine.Engine [generated in 0.00039s] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:18.102856')
2025-10-22 16:15:18,152 INFO sqlalchemy.engine.Engine SELECT users.id, users.name, users.email, users.hashed_password, users.is_active, users.is_verified, users.mfa_enabled, users.mfa_secret, users.role, users.country, users.currency, users.created_at, users.updated_at, users.last_login, users.username, users.avatar, users.user_type 
FROM users 
WHERE users.email = ?
2025-10-22 16:15:18,152 INFO sqlalchemy.engine.Engine [generated in 0.00020s] ('admin@example.com',)
2025-10-22 16:15:18,154 INFO sqlalchemy.engine.Engine SELECT sum(payments.amount) AS sum_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ?
2025-10-22 16:15:18,154 INFO sqlalchemy.engine.Engine [generated in 0.00015s] (1, 'completed')
2025-10-22 16:15:18,158 INFO sqlalchemy.engine.Engine SELECT count(payments.id) AS count_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ?
2025-10-22 16:15:18,158 INFO sqlalchemy.engine.Engine [generated in 0.00023s] (1, 'completed')
2025-10-22 16:15:18,162 INFO sqlalchemy.engine.Engine SELECT count(paywalls.id) AS count_1 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:15:18,162 INFO sqlalchemy.engine.Engine [generated in 0.00020s] (1,)
2025-10-22 16:15:18,164 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:18,164 INFO sqlalchemy.engine.Engine [generated in 0.00015s] (1,)
2025-10-22 16:15:18,165 INFO sqlalchemy.engine.Engine SELECT count(payments.id) AS count_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ?
2025-10-22 16:15:18,165 INFO sqlalchemy.engine.Engine [generated in 0.00017s] (1, 'completed', '2025-10-15 15:15:18.165639')
INFO:     127.0.0.1:15782 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:18,169 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:19,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:19,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:19,287 INFO sqlalchemy.engine.Engine [cached since 1.142s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:19.283697')
2025-10-22 16:15:19,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:19,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:19,290 INFO sqlalchemy.engine.Engine [cached since 1.144s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:19.283697')
2025-10-22 16:15:19,296 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue, count(payments.id) AS sales 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:19,296 INFO sqlalchemy.engine.Engine [generated in 0.00038s] (1, 'completed', '2025-09-22 15:15:19.290926')
2025-10-22 16:15:19,299 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, sum(payments.amount) AS revenue, count(payments.id) AS conversions 
FROM paywalls LEFT OUTER JOIN payments ON paywalls.id = payments.paywall_id 
WHERE paywalls.owner_id = ? AND payments.status = ? GROUP BY paywalls.id, paywalls.title ORDER BY sum(payments.amount) DESC
 LIMIT ? OFFSET ?
2025-10-22 16:15:19,301 INFO sqlalchemy.engine.Engine [generated in 0.00031s] (1, 'completed', 5, 0)
INFO:     127.0.0.1:15782 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:19,302 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:19,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine [cached since 3.141s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:21.284486')
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine [cached since 3.142s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:21.284486')
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine [cached since 3.126s ago] (1,)
2025-10-22 16:15:21,287 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:21,293 INFO sqlalchemy.engine.Engine [generated in 0.00105s] (1, 'completed', '2025-09-22 15:15:21.287946')
2025-10-22 16:15:21,313 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:21,313 INFO sqlalchemy.engine.Engine [generated in 0.00023s] (1,)
2025-10-22 16:15:21,326 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:15782 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:21,346 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:23,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:23,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:23,292 INFO sqlalchemy.engine.Engine [cached since 5.145s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:23.288075')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:23,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:23,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:23,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:23,301 INFO sqlalchemy.engine.Engine [cached since 5.155s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:23.299566')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:23,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine [cached since 7.137s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:25.280906')
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine [cached since 7.138s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:25.280906')
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:25,280 INFO sqlalchemy.engine.Engine [cached since 7.122s ago] (1,)
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:25,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:25,290 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:25,290 INFO sqlalchemy.engine.Engine [cached since 3.977s ago] (1,)
INFO:     127.0.0.1:43690 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:25,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:27,283 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:27,283 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:27,283 INFO sqlalchemy.engine.Engine [cached since 9.139s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:27.281400')
2025-10-22 16:15:27,286 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:27,286 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:27,287 INFO sqlalchemy.engine.Engine [cached since 9.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:27.283916')
2025-10-22 16:15:27,290 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:27,290 INFO sqlalchemy.engine.Engine [cached since 5.998s ago] (1, 'completed', '2025-09-22 15:15:27.288769')
2025-10-22 16:15:27,292 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:27,294 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:43690 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:15:29,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:29,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:29,288 INFO sqlalchemy.engine.Engine [cached since 11.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:29.285642')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:29,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:29,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:29,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:29,298 INFO sqlalchemy.engine.Engine [cached since 11.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:29.295663')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:29,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:31,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:31,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:31,287 INFO sqlalchemy.engine.Engine [cached since 13.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:31.279127')
2025-10-22 16:15:31,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:31,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:31,287 INFO sqlalchemy.engine.Engine [cached since 13.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:31.287787')
2025-10-22 16:15:31,291 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:31,291 INFO sqlalchemy.engine.Engine [cached since 13.13s ago] (1,)
2025-10-22 16:15:31,293 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:31,293 INFO sqlalchemy.engine.Engine [cached since 10s ago] (1, 'completed', '2025-09-22 15:15:31.292129')
2025-10-22 16:15:31,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:31,295 INFO sqlalchemy.engine.Engine [cached since 9.984s ago] (1,)
2025-10-22 16:15:31,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54025 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:31,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:33,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:33,282 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:33,282 INFO sqlalchemy.engine.Engine [cached since 15.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:33.278679')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:33,282 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:33,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:33,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:33,294 INFO sqlalchemy.engine.Engine [cached since 15.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:33.288690')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:33,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:35,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:35,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:35,293 INFO sqlalchemy.engine.Engine [cached since 17.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:35.284701')
2025-10-22 16:15:35,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:35,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:35,295 INFO sqlalchemy.engine.Engine [cached since 17.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:35.287646')
2025-10-22 16:15:35,300 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:35,300 INFO sqlalchemy.engine.Engine [cached since 17.14s ago] (1,)
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:35,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:35,306 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:35,306 INFO sqlalchemy.engine.Engine [cached since 13.99s ago] (1,)
INFO:     127.0.0.1:41076 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:35,319 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:37,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:37,310 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:37,310 INFO sqlalchemy.engine.Engine [cached since 19.16s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:37.288026')
2025-10-22 16:15:37,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:37,312 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:37,312 INFO sqlalchemy.engine.Engine [cached since 19.17s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:37.288026')
2025-10-22 16:15:37,325 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:37,325 INFO sqlalchemy.engine.Engine [cached since 16.04s ago] (1, 'completed', '2025-09-22 15:15:37.325973')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:37,325 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:37,336 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:41076 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:15:39,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:39,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:39,293 INFO sqlalchemy.engine.Engine [cached since 21.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:39.288074')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:39,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:39,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:39,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:39,302 INFO sqlalchemy.engine.Engine [cached since 21.16s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:39.299658')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:39,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine [cached since 23.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:41.280288')
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine [cached since 23.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:41.280288')
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine [cached since 23.12s ago] (1,)
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:41,280 INFO sqlalchemy.engine.Engine [cached since 19.99s ago] (1, 'completed', '2025-09-22 15:15:41.280288')
2025-10-22 16:15:41,287 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:41,288 INFO sqlalchemy.engine.Engine [cached since 19.98s ago] (1,)
2025-10-22 16:15:41,289 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:41,293 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59860 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:15:43,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:43,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:43,295 INFO sqlalchemy.engine.Engine [cached since 25.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:43.294284')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:43,300 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:43,309 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:43,311 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:43,311 INFO sqlalchemy.engine.Engine [cached since 25.16s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:43.306744')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:43,316 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:45,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:45,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:45,294 INFO sqlalchemy.engine.Engine [cached since 27.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:45.289089')
2025-10-22 16:15:45,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:45,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:45,294 INFO sqlalchemy.engine.Engine [cached since 27.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:45.292105')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:45,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:45,326 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:45,326 INFO sqlalchemy.engine.Engine [cached since 27.16s ago] (1,)
2025-10-22 16:15:45,328 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:45,328 INFO sqlalchemy.engine.Engine [cached since 24.02s ago] (1,)
INFO:     127.0.0.1:31352 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:45,328 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:47,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:47,282 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:47,282 INFO sqlalchemy.engine.Engine [cached since 29.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:47.278490')
2025-10-22 16:15:47,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:47,282 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:47,282 INFO sqlalchemy.engine.Engine [cached since 29.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:47.280502')
2025-10-22 16:15:47,284 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:47,284 INFO sqlalchemy.engine.Engine [cached since 25.99s ago] (1, 'completed', '2025-09-22 15:15:47.284974')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:47,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:47,287 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:31352 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:15:48,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:48,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:48,296 INFO sqlalchemy.engine.Engine [cached since 30.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:48.295830')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:48,300 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:48,305 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:48,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:48,305 INFO sqlalchemy.engine.Engine [cached since 30.16s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:48.304300')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:48,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:50,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:50,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:50,280 INFO sqlalchemy.engine.Engine [cached since 32.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:50.280200')
2025-10-22 16:15:50,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:50,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:50,280 INFO sqlalchemy.engine.Engine [cached since 32.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:50.280200')
2025-10-22 16:15:50,289 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:50,289 INFO sqlalchemy.engine.Engine [cached since 29s ago] (1, 'completed', '2025-09-22 15:15:50.287723')
2025-10-22 16:15:50,289 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:50,289 INFO sqlalchemy.engine.Engine [cached since 32.13s ago] (1,)
2025-10-22 16:15:50,292 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:50,294 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:50,294 INFO sqlalchemy.engine.Engine [cached since 28.98s ago] (1,)
INFO:     127.0.0.1:36827 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:50,305 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:52,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:52,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:52,296 INFO sqlalchemy.engine.Engine [cached since 34.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:52.296996')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:52,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:52,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:52,306 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:52,306 INFO sqlalchemy.engine.Engine [cached since 34.16s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:52.304112')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:52,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:54,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:54,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:54,294 INFO sqlalchemy.engine.Engine [cached since 36.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:54.292791')
2025-10-22 16:15:54,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:54,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:54,294 INFO sqlalchemy.engine.Engine [cached since 36.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:54.294803')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:54,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:54,302 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:15:54,302 INFO sqlalchemy.engine.Engine [cached since 36.14s ago] (1,)
2025-10-22 16:15:54,305 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:15:54,305 INFO sqlalchemy.engine.Engine [cached since 32.99s ago] (1,)
INFO:     127.0.0.1:60628 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:15:54,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:56,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:56,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:56,287 INFO sqlalchemy.engine.Engine [cached since 38.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:56.280647')
2025-10-22 16:15:56,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:56,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:56,287 INFO sqlalchemy.engine.Engine [cached since 38.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:56.280647')
2025-10-22 16:15:56,292 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:15:56,293 INFO sqlalchemy.engine.Engine [cached since 35s ago] (1, 'completed', '2025-09-22 15:15:56.290294')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:15:56,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:56,297 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:60628 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
WARNING:  WatchFiles detected changes in 'services\analytics_service.py'. Reloading...
2025-10-22 16:15:58,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:58,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:58,280 INFO sqlalchemy.engine.Engine [cached since 40.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:58.280666')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:15:58,285 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:15:58,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:15:58,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:15:58,291 INFO sqlalchemy.engine.Engine [cached since 40.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:15:58.288424')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:15:58,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:00,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:00,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:00,297 INFO sqlalchemy.engine.Engine [cached since 42.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:00.295032')
2025-10-22 16:16:00,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:00,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:00,297 INFO sqlalchemy.engine.Engine [cached since 42.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:00.297150')
2025-10-22 16:16:00,301 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:00,301 INFO sqlalchemy.engine.Engine [cached since 39.01s ago] (1, 'completed', '2025-09-22 15:16:00.301648')
2025-10-22 16:16:00,304 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:00,304 INFO sqlalchemy.engine.Engine [cached since 42.14s ago] (1,)
2025-10-22 16:16:00,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:00,304 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:00,304 INFO sqlalchemy.engine.Engine [cached since 38.99s ago] (1,)
INFO:     127.0.0.1:15198 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:00,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:02,283 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:02,283 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:02,283 INFO sqlalchemy.engine.Engine [cached since 44.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:02.280357')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:02,283 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:02,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:02,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:02,289 INFO sqlalchemy.engine.Engine [cached since 44.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:02.289124')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:16:02,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:04,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:04,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:04,281 INFO sqlalchemy.engine.Engine [cached since 46.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:04.281120')
2025-10-22 16:16:04,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:04,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:04,281 INFO sqlalchemy.engine.Engine [cached since 46.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:04.281120')
2025-10-22 16:16:04,289 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:04,289 INFO sqlalchemy.engine.Engine [cached since 46.13s ago] (1,)
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:04,291 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:04,293 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:04,293 INFO sqlalchemy.engine.Engine [cached since 42.98s ago] (1,)
INFO:     127.0.0.1:29293 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:04,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:06,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:06,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:06,281 INFO sqlalchemy.engine.Engine [cached since 48.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:06.281076')
2025-10-22 16:16:06,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:06,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:06,281 INFO sqlalchemy.engine.Engine [cached since 48.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:06.281076')
2025-10-22 16:16:06,287 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:06,287 INFO sqlalchemy.engine.Engine [cached since 45s ago] (1, 'completed', '2025-09-22 15:16:06.287969')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:06,290 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:06,293 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29293 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:08,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:08,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:08,281 INFO sqlalchemy.engine.Engine [cached since 50.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:08.281739')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:16:08,284 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:08,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:08,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:08,290 INFO sqlalchemy.engine.Engine [cached since 50.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:08.287753')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:08,292 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:10,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:10,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:10,287 INFO sqlalchemy.engine.Engine [cached since 52.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:10.282022')
2025-10-22 16:16:10,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:10,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:10,288 INFO sqlalchemy.engine.Engine [cached since 52.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:10.285206')
2025-10-22 16:16:10,308 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:10,308 INFO sqlalchemy.engine.Engine [cached since 52.14s ago] (1,)
2025-10-22 16:16:10,311 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:10,311 INFO sqlalchemy.engine.Engine [cached since 49.02s ago] (1, 'completed', '2025-09-22 15:16:10.309507')
2025-10-22 16:16:10,324 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:10,324 INFO sqlalchemy.engine.Engine [cached since 49.01s ago] (1,)
2025-10-22 16:16:10,324 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:65081 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:10,332 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:12,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:12,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:12,288 INFO sqlalchemy.engine.Engine [cached since 54.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:12.284937')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:12,293 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:12,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:12,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:12,299 INFO sqlalchemy.engine.Engine [cached since 54.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:12.296335')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:16:12,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:14,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:14,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:14,284 INFO sqlalchemy.engine.Engine [cached since 56.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:14.280863')
2025-10-22 16:16:14,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:14,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:14,284 INFO sqlalchemy.engine.Engine [cached since 56.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:14.281753')
2025-10-22 16:16:14,306 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:14,307 INFO sqlalchemy.engine.Engine [cached since 56.14s ago] (1,)
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:14,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:14,312 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:14,312 INFO sqlalchemy.engine.Engine [cached since 53s ago] (1,)
INFO:     127.0.0.1:58896 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:14,314 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:16,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:16,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:16,295 INFO sqlalchemy.engine.Engine [cached since 58.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:16.295052')
2025-10-22 16:16:16,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:16,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:16,295 INFO sqlalchemy.engine.Engine [cached since 58.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:16.292544')
2025-10-22 16:16:16,309 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:16,309 INFO sqlalchemy.engine.Engine [cached since 55.02s ago] (1, 'completed', '2025-09-22 15:16:16.309649')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:16,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:16,309 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:58896 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:18,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:18,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:18,284 INFO sqlalchemy.engine.Engine [cached since 60.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:18.282673')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:16:18,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:18,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:18,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:18,293 INFO sqlalchemy.engine.Engine [cached since 60.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:18.291845')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:18,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:20,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:20,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:20,297 INFO sqlalchemy.engine.Engine [cached since 62.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:20.295452')
2025-10-22 16:16:20,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:20,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:20,297 INFO sqlalchemy.engine.Engine [cached since 62.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:20.297620')
2025-10-22 16:16:20,302 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:20,302 INFO sqlalchemy.engine.Engine [cached since 62.14s ago] (1,)
2025-10-22 16:16:20,304 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:20,304 INFO sqlalchemy.engine.Engine [cached since 59.01s ago] (1, 'completed', '2025-09-22 15:16:20.304734')
2025-10-22 16:16:20,308 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:20,310 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:20,310 INFO sqlalchemy.engine.Engine [cached since 59s ago] (1,)
INFO:     127.0.0.1:1480 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:20,321 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:22,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:22,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:22,291 INFO sqlalchemy.engine.Engine [cached since 64.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:22.289638')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:22,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:22,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:22,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:22,298 INFO sqlalchemy.engine.Engine [cached since 64.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:22.298921')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:16:22,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine [cached since 66.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:24.292923')
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine [cached since 66.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:24.294932')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:24,294 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:24,301 INFO sqlalchemy.engine.Engine [cached since 66.14s ago] (1,)
2025-10-22 16:16:24,304 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:24,304 INFO sqlalchemy.engine.Engine [cached since 62.99s ago] (1,)
INFO:     127.0.0.1:19237 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:24,306 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:26,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:26,282 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:26,282 INFO sqlalchemy.engine.Engine [cached since 68.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:26.276907')
2025-10-22 16:16:26,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:26,282 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:26,282 INFO sqlalchemy.engine.Engine [cached since 68.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:26.282817')
2025-10-22 16:16:26,287 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:26,287 INFO sqlalchemy.engine.Engine [cached since 65s ago] (1, 'completed', '2025-09-22 15:16:26.282817')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:26,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:26,294 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:19237 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:28,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:28,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:28,291 INFO sqlalchemy.engine.Engine [cached since 70.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:28.291279')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:16:28,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:28,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:28,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:28,302 INFO sqlalchemy.engine.Engine [cached since 70.16s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:28.300295')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:28,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:30,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:30,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:30,292 INFO sqlalchemy.engine.Engine [cached since 72.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:30.290200')
2025-10-22 16:16:30,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:30,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:30,294 INFO sqlalchemy.engine.Engine [cached since 72.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:30.292210')
2025-10-22 16:16:30,295 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:30,295 INFO sqlalchemy.engine.Engine [cached since 72.13s ago] (1,)
2025-10-22 16:16:30,296 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:30,296 INFO sqlalchemy.engine.Engine [cached since 69s ago] (1, 'completed', '2025-09-22 15:16:30.296822')
2025-10-22 16:16:30,296 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:30,298 INFO sqlalchemy.engine.Engine [cached since 68.99s ago] (1,)
2025-10-22 16:16:30,298 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:30,300 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63658 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:32,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:32,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:32,296 INFO sqlalchemy.engine.Engine [cached since 74.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:32.294980')
INFO:     127.0.0.1:12830 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:32,354 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:32,358 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:32,359 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:32,359 INFO sqlalchemy.engine.Engine [cached since 74.21s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:32.358476')
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:16:32,359 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:34,393 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:34,393 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:34,393 INFO sqlalchemy.engine.Engine [cached since 76.25s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:34.391128')
INFO:     127.0.0.1:12830 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:34,397 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:34,424 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:34,425 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:34,425 INFO sqlalchemy.engine.Engine [cached since 76.28s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:34.421591')
2025-10-22 16:16:34,427 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:34,427 INFO sqlalchemy.engine.Engine [cached since 76.26s ago] (1,)
2025-10-22 16:16:34,427 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:34,427 INFO sqlalchemy.engine.Engine [cached since 73.12s ago] (1,)
INFO:     127.0.0.1:12830 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:34,427 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:36,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:36,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:36,284 INFO sqlalchemy.engine.Engine [cached since 78.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:36.275533')
2025-10-22 16:16:36,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:36,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:36,284 INFO sqlalchemy.engine.Engine [cached since 78.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:36.282716')
2025-10-22 16:16:36,288 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:36,288 INFO sqlalchemy.engine.Engine [cached since 75s ago] (1, 'completed', '2025-09-22 15:16:36.284243')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:36,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:36,292 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:12830 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:38,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:38,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:38,295 INFO sqlalchemy.engine.Engine [cached since 80.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:38.291584')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:16:38,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:38,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:38,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:38,304 INFO sqlalchemy.engine.Engine [cached since 80.16s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:38.301695')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:38,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:40,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:40,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:40,290 INFO sqlalchemy.engine.Engine [cached since 82.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:40.283196')
2025-10-22 16:16:40,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:40,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:40,291 INFO sqlalchemy.engine.Engine [cached since 82.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:40.283196')
2025-10-22 16:16:40,293 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:40,293 INFO sqlalchemy.engine.Engine [cached since 82.13s ago] (1,)
2025-10-22 16:16:40,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:40,295 INFO sqlalchemy.engine.Engine [cached since 79s ago] (1, 'completed', '2025-09-22 15:16:40.295275')
2025-10-22 16:16:40,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:40,295 INFO sqlalchemy.engine.Engine [cached since 78.98s ago] (1,)
2025-10-22 16:16:40,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:40,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13273 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:42,283 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:42,283 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:42,283 INFO sqlalchemy.engine.Engine [cached since 84.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:42.283642')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:42,291 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:42,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:42,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:42,295 INFO sqlalchemy.engine.Engine [cached since 84.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:42.295011')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:16:42,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:44,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:44,282 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:44,282 INFO sqlalchemy.engine.Engine [cached since 86.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:44.282542')
2025-10-22 16:16:44,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:44,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:44,287 INFO sqlalchemy.engine.Engine [cached since 86.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:44.282542')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:44,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:44,309 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:44,311 INFO sqlalchemy.engine.Engine [cached since 86.15s ago] (1,)
2025-10-22 16:16:44,312 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:44,312 INFO sqlalchemy.engine.Engine [cached since 83s ago] (1,)
INFO:     127.0.0.1:4456 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:44,312 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:46,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:46,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:46,295 INFO sqlalchemy.engine.Engine [cached since 88.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:46.293658')
2025-10-22 16:16:46,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:46,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:46,295 INFO sqlalchemy.engine.Engine [cached since 88.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:46.295166')
2025-10-22 16:16:46,301 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:46,301 INFO sqlalchemy.engine.Engine [cached since 85.01s ago] (1, 'completed', '2025-09-22 15:16:46.300889')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:46,305 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:46,306 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:4456 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:48,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:48,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:48,281 INFO sqlalchemy.engine.Engine [cached since 90.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:48.279260')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:16:48,281 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:48,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:48,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:48,290 INFO sqlalchemy.engine.Engine [cached since 90.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:48.288099')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:48,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:50,279 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:50,279 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:50,279 INFO sqlalchemy.engine.Engine [cached since 92.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:50.279944')
2025-10-22 16:16:50,286 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:50,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:50,287 INFO sqlalchemy.engine.Engine [cached since 92.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:50.279944')
2025-10-22 16:16:50,289 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:50,289 INFO sqlalchemy.engine.Engine [cached since 92.13s ago] (1,)
2025-10-22 16:16:50,292 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:50,292 INFO sqlalchemy.engine.Engine [cached since 89s ago] (1, 'completed', '2025-09-22 15:16:50.289656')
2025-10-22 16:16:50,292 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:50,295 INFO sqlalchemy.engine.Engine [cached since 88.98s ago] (1,)
2025-10-22 16:16:50,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:22865 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:50,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:52,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:52,282 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:52,282 INFO sqlalchemy.engine.Engine [cached since 94.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:52.280207')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:52,284 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:52,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:52,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:52,291 INFO sqlalchemy.engine.Engine [cached since 94.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:52.289748')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:16:52,293 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:54,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:54,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:54,289 INFO sqlalchemy.engine.Engine [cached since 96.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:54.284762')
2025-10-22 16:16:54,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:54,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:54,289 INFO sqlalchemy.engine.Engine [cached since 96.14s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:54.284762')
2025-10-22 16:16:54,291 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:16:54,291 INFO sqlalchemy.engine.Engine [cached since 96.13s ago] (1,)
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:54,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:54,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:16:54,295 INFO sqlalchemy.engine.Engine [cached since 92.98s ago] (1,)
INFO:     127.0.0.1:35733 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:16:54,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine [cached since 98.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:56.292813')
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine [cached since 98.15s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:56.292813')
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine [cached since 95.01s ago] (1, 'completed', '2025-09-22 15:16:56.295629')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:16:56,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:56,302 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:35733 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:16:58,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:58,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:58,295 INFO sqlalchemy.engine.Engine [cached since 100.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:58.294331')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:16:58,300 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:16:58,323 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:16:58,323 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:16:58,323 INFO sqlalchemy.engine.Engine [cached since 100.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:16:58.306794')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:16:58,327 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:00,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:00,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:00,287 INFO sqlalchemy.engine.Engine [cached since 102.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:00.283778')
2025-10-22 16:17:00,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:00,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:00,289 INFO sqlalchemy.engine.Engine [cached since 102.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:00.283778')
2025-10-22 16:17:00,291 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:00,291 INFO sqlalchemy.engine.Engine [cached since 99s ago] (1, 'completed', '2025-09-22 15:17:00.291304')
2025-10-22 16:17:00,291 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:00,291 INFO sqlalchemy.engine.Engine [cached since 102.1s ago] (1,)
2025-10-22 16:17:00,294 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:00,294 INFO sqlalchemy.engine.Engine [cached since 98.98s ago] (1,)
2025-10-22 16:17:00,294 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:37068 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:00,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:02,277 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:02,277 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:02,277 INFO sqlalchemy.engine.Engine [cached since 104.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:02.277856')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:02,290 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:02,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:02,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:02,295 INFO sqlalchemy.engine.Engine [cached since 104.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:02.292799')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:02,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:04,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:04,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:04,296 INFO sqlalchemy.engine.Engine [cached since 106.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:04.293969')
2025-10-22 16:17:04,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:04,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:04,298 INFO sqlalchemy.engine.Engine [cached since 106.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:04.298808')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:04,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:04,306 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:04,306 INFO sqlalchemy.engine.Engine [cached since 106.1s ago] (1,)
2025-10-22 16:17:04,308 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:04,309 INFO sqlalchemy.engine.Engine [cached since 103s ago] (1,)
INFO:     127.0.0.1:8974 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:04,310 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:06,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:06,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:06,288 INFO sqlalchemy.engine.Engine [cached since 108.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:06.281541')
2025-10-22 16:17:06,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:06,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:06,290 INFO sqlalchemy.engine.Engine [cached since 108.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:06.287568')
2025-10-22 16:17:06,306 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:06,306 INFO sqlalchemy.engine.Engine [cached since 105s ago] (1, 'completed', '2025-09-22 15:17:06.305694')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:06,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:06,311 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:8974 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:17:08,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:08,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:08,295 INFO sqlalchemy.engine.Engine [cached since 110.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:08.292539')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:08,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:08,299 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:08,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:08,302 INFO sqlalchemy.engine.Engine [cached since 110.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:08.299764')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:08,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:10,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:10,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:10,302 INFO sqlalchemy.engine.Engine [cached since 112.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:10.295991')
2025-10-22 16:17:10,305 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:10,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:10,305 INFO sqlalchemy.engine.Engine [cached since 112.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:10.298009')
2025-10-22 16:17:10,309 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:10,309 INFO sqlalchemy.engine.Engine [cached since 112.1s ago] (1,)
2025-10-22 16:17:10,314 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:10,314 INFO sqlalchemy.engine.Engine [cached since 109s ago] (1, 'completed', '2025-09-22 15:17:10.312870')
2025-10-22 16:17:10,319 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:10,319 INFO sqlalchemy.engine.Engine [cached since 109s ago] (1,)
2025-10-22 16:17:10,321 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:10,326 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52673 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:17:12,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:12,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:12,288 INFO sqlalchemy.engine.Engine [cached since 114.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:12.288716')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:12,293 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:12,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:12,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:12,296 INFO sqlalchemy.engine.Engine [cached since 114.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:12.296505')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:12,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:14,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:14,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:14,295 INFO sqlalchemy.engine.Engine [cached since 116.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:14.293763')
2025-10-22 16:17:14,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:14,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:14,295 INFO sqlalchemy.engine.Engine [cached since 116.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:14.295271')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:14,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:14,301 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:14,301 INFO sqlalchemy.engine.Engine [cached since 116.1s ago] (1,)
2025-10-22 16:17:14,305 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:14,305 INFO sqlalchemy.engine.Engine [cached since 113s ago] (1,)
INFO:     127.0.0.1:61525 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:14,308 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:16,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:16,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:16,280 INFO sqlalchemy.engine.Engine [cached since 118.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:16.280767')
2025-10-22 16:17:16,280 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:16,280 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:16,280 INFO sqlalchemy.engine.Engine [cached since 118.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:16.280767')
2025-10-22 16:17:16,288 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:16,288 INFO sqlalchemy.engine.Engine [cached since 115s ago] (1, 'completed', '2025-09-22 15:17:16.288085')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:16,291 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:16,293 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:61525 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:17:18,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:18,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:18,295 INFO sqlalchemy.engine.Engine [cached since 120.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:18.295394')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:18,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:18,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:18,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:18,302 INFO sqlalchemy.engine.Engine [cached since 120.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:18.295914')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:18,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:20,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:20,303 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:20,303 INFO sqlalchemy.engine.Engine [cached since 122.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:20.289570')
2025-10-22 16:17:20,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:20,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:20,305 INFO sqlalchemy.engine.Engine [cached since 122.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:20.289570')
2025-10-22 16:17:20,305 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:20,305 INFO sqlalchemy.engine.Engine [cached since 122.1s ago] (1,)
2025-10-22 16:17:20,305 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:20,305 INFO sqlalchemy.engine.Engine [cached since 119s ago] (1, 'completed', '2025-09-22 15:17:20.305130')
2025-10-22 16:17:20,309 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:20,309 INFO sqlalchemy.engine.Engine [cached since 119s ago] (1,)
2025-10-22 16:17:20,309 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:11608 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:20,320 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:22,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:22,300 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:22,300 INFO sqlalchemy.engine.Engine [cached since 124.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:22.298804')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:22,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:22,309 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:22,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:22,309 INFO sqlalchemy.engine.Engine [cached since 124.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:22.307619')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:22,314 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:24,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:24,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:24,295 INFO sqlalchemy.engine.Engine [cached since 126.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:24.293242')
2025-10-22 16:17:24,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:24,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:24,295 INFO sqlalchemy.engine.Engine [cached since 126.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:24.293242')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:24,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:24,318 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:24,318 INFO sqlalchemy.engine.Engine [cached since 126.2s ago] (1,)
2025-10-22 16:17:24,322 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:24,322 INFO sqlalchemy.engine.Engine [cached since 123s ago] (1,)
INFO:     127.0.0.1:49668 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:24,325 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:26,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:26,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:26,293 INFO sqlalchemy.engine.Engine [cached since 128.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:26.289788')
2025-10-22 16:17:26,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:26,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:26,295 INFO sqlalchemy.engine.Engine [cached since 128.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:26.291800')
2025-10-22 16:17:26,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:26,295 INFO sqlalchemy.engine.Engine [cached since 125s ago] (1, 'completed', '2025-09-22 15:17:26.295135')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:26,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:26,302 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:49668 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:17:28,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:28,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:28,287 INFO sqlalchemy.engine.Engine [cached since 130.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:28.287635')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:28,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:28,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:28,300 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:28,300 INFO sqlalchemy.engine.Engine [cached since 130.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:28.298339')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:28,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:30,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine [cached since 132.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:30.281971')
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine [cached since 132.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:30.281971')
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine [cached since 132.1s ago] (1,)
2025-10-22 16:17:30,289 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:30,295 INFO sqlalchemy.engine.Engine [cached since 129s ago] (1, 'completed', '2025-09-22 15:17:30.289006')
2025-10-22 16:17:30,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:30,295 INFO sqlalchemy.engine.Engine [cached since 129s ago] (1,)
2025-10-22 16:17:30,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:30,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:4609 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:17:32,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:32,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:32,298 INFO sqlalchemy.engine.Engine [cached since 134.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:32.298215')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:32,305 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:32,309 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:32,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:32,309 INFO sqlalchemy.engine.Engine [cached since 134.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:32.309558')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:32,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:34,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:34,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:34,294 INFO sqlalchemy.engine.Engine [cached since 136.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:34.289069')
2025-10-22 16:17:34,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:34,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:34,294 INFO sqlalchemy.engine.Engine [cached since 136.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:34.294804')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:34,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:34,302 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:34,302 INFO sqlalchemy.engine.Engine [cached since 136.1s ago] (1,)
2025-10-22 16:17:34,305 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:34,305 INFO sqlalchemy.engine.Engine [cached since 133s ago] (1,)
INFO:     127.0.0.1:3646 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:34,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine [cached since 138.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:36.295783')
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine [cached since 138.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:36.296848')
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:36,298 INFO sqlalchemy.engine.Engine [cached since 135s ago] (1, 'completed', '2025-09-22 15:17:36.298928')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:36,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:36,306 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:3646 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:17:38,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:38,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:38,295 INFO sqlalchemy.engine.Engine [cached since 140.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:38.289001')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:38,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:38,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:38,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:38,304 INFO sqlalchemy.engine.Engine [cached since 140.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:38.302805')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:38,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:40,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:40,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:40,291 INFO sqlalchemy.engine.Engine [cached since 142.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:40.279996')
2025-10-22 16:17:40,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:40,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:40,291 INFO sqlalchemy.engine.Engine [cached since 142.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:40.288033')
2025-10-22 16:17:40,297 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:40,297 INFO sqlalchemy.engine.Engine [cached since 142.1s ago] (1,)
2025-10-22 16:17:40,300 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:40,301 INFO sqlalchemy.engine.Engine [cached since 139s ago] (1, 'completed', '2025-09-22 15:17:40.297661')
2025-10-22 16:17:40,305 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:40,305 INFO sqlalchemy.engine.Engine [cached since 139s ago] (1,)
2025-10-22 16:17:40,320 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:10517 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:40,344 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:42,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:42,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:42,293 INFO sqlalchemy.engine.Engine [cached since 144.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:42.289962')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:42,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:42,309 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:42,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:42,309 INFO sqlalchemy.engine.Engine [cached since 144.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:42.305382')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:17:42,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:44,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:44,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:44,298 INFO sqlalchemy.engine.Engine [cached since 146.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:44.292387')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:44,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:44,312 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:44,312 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:44,314 INFO sqlalchemy.engine.Engine [cached since 146.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:44.307420')
2025-10-22 16:17:44,321 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:44,321 INFO sqlalchemy.engine.Engine [cached since 146.2s ago] (1,)
2025-10-22 16:17:44,324 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:44,326 INFO sqlalchemy.engine.Engine [cached since 143s ago] (1,)
INFO:     127.0.0.1:64920 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:44,332 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:46,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:46,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:46,298 INFO sqlalchemy.engine.Engine [cached since 148.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:46.292336')
2025-10-22 16:17:46,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:46,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:46,299 INFO sqlalchemy.engine.Engine [cached since 148.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:46.295095')
2025-10-22 16:17:46,315 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:46,317 INFO sqlalchemy.engine.Engine [cached since 145s ago] (1, 'completed', '2025-09-22 15:17:46.315187')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:46,324 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:46,326 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:64920 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:17:47,463 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:47,463 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:47,463 INFO sqlalchemy.engine.Engine [cached since 149.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:47.450425')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:17:47,476 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:47,497 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:47,497 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:47,499 INFO sqlalchemy.engine.Engine [cached since 149.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:47.495406')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:47,513 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:49,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:49,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:49,302 INFO sqlalchemy.engine.Engine [cached since 151.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:49.297786')
2025-10-22 16:17:49,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:49,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:49,305 INFO sqlalchemy.engine.Engine [cached since 151.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:49.294963')
2025-10-22 16:17:49,305 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:49,305 INFO sqlalchemy.engine.Engine [cached since 148s ago] (1, 'completed', '2025-09-22 15:17:49.305049')
2025-10-22 16:17:49,309 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:49,309 INFO sqlalchemy.engine.Engine [cached since 151.1s ago] (1,)
2025-10-22 16:17:49,332 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:49,336 INFO sqlalchemy.engine.Engine [cached since 148s ago] (1,)
2025-10-22 16:17:49,336 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:43719 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:49,358 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:51,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:51,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:51,295 INFO sqlalchemy.engine.Engine [cached since 153.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:51.292276')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:51,300 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:51,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:51,310 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:51,310 INFO sqlalchemy.engine.Engine [cached since 153.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:51.307180')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:17:51,320 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:53,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:53,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:53,292 INFO sqlalchemy.engine.Engine [cached since 155.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:53.289976')
2025-10-22 16:17:53,312 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:53,312 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:53,312 INFO sqlalchemy.engine.Engine [cached since 155.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:53.294788')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:53,319 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:53,324 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:53,324 INFO sqlalchemy.engine.Engine [cached since 155.2s ago] (1,)
2025-10-22 16:17:53,328 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:53,328 INFO sqlalchemy.engine.Engine [cached since 152s ago] (1,)
INFO:     127.0.0.1:37335 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:53,335 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:55,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:55,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:55,295 INFO sqlalchemy.engine.Engine [cached since 157.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:55.291277')
2025-10-22 16:17:55,302 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:55,302 INFO sqlalchemy.engine.Engine [cached since 154s ago] (1, 'completed', '2025-09-22 15:17:55.299350')
2025-10-22 16:17:55,313 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:55,314 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:55,315 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:55,315 INFO sqlalchemy.engine.Engine [cached since 157.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:55.309337')
INFO:     127.0.0.1:37335 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:17:55,347 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:57,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:57,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:57,290 INFO sqlalchemy.engine.Engine [cached since 159.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:57.286012')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:17:57,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:57,306 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:57,308 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:57,309 INFO sqlalchemy.engine.Engine [cached since 159.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:57.304432')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:17:57,315 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:17:59,300 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:59,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:59,303 INFO sqlalchemy.engine.Engine [cached since 161.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:59.294139')
2025-10-22 16:17:59,303 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:17:59,303 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:17:59,305 INFO sqlalchemy.engine.Engine [cached since 161.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:17:59.295166')
2025-10-22 16:17:59,305 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:17:59,305 INFO sqlalchemy.engine.Engine [cached since 161.1s ago] (1,)
2025-10-22 16:17:59,310 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:17:59,310 INFO sqlalchemy.engine.Engine [cached since 158s ago] (1, 'completed', '2025-09-22 15:17:59.310350')
2025-10-22 16:17:59,315 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:17:59,315 INFO sqlalchemy.engine.Engine [cached since 158s ago] (1,)
2025-10-22 16:17:59,320 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:17:59,320 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:40149 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:01,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:01,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:01,295 INFO sqlalchemy.engine.Engine [cached since 163.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:01.289989')
INFO:     127.0.0.1:52644 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:01,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:01,307 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:01,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:01,309 INFO sqlalchemy.engine.Engine [cached since 163.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:01.305371')
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:01,316 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:03,303 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:03,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:03,305 INFO sqlalchemy.engine.Engine [cached since 165.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:03.298961')
INFO:     127.0.0.1:52644 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:03,315 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:03,346 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:03,346 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:03,346 INFO sqlalchemy.engine.Engine [cached since 165.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:03.343670')
2025-10-22 16:18:03,353 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:03,353 INFO sqlalchemy.engine.Engine [cached since 165.2s ago] (1,)
2025-10-22 16:18:03,362 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:03,362 INFO sqlalchemy.engine.Engine [cached since 162.1s ago] (1,)
INFO:     127.0.0.1:52644 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:03,389 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:05,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:05,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:05,302 INFO sqlalchemy.engine.Engine [cached since 167.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:05.297652')
2025-10-22 16:18:05,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:05,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:05,305 INFO sqlalchemy.engine.Engine [cached since 167.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:05.296862')
2025-10-22 16:18:05,309 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:05,309 INFO sqlalchemy.engine.Engine [cached since 164s ago] (1, 'completed', '2025-09-22 15:18:05.305180')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:05,313 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:05,320 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52644 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:07,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:07,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:07,294 INFO sqlalchemy.engine.Engine [cached since 169.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:07.288214')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:07,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:07,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:07,312 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:07,312 INFO sqlalchemy.engine.Engine [cached since 169.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:07.306599')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:07,320 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:09,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:09,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:09,296 INFO sqlalchemy.engine.Engine [cached since 171.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:09.290795')
2025-10-22 16:18:09,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:09,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:09,302 INFO sqlalchemy.engine.Engine [cached since 171.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:09.296726')
2025-10-22 16:18:09,304 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:09,304 INFO sqlalchemy.engine.Engine [cached since 171.1s ago] (1,)
2025-10-22 16:18:09,312 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:09,312 INFO sqlalchemy.engine.Engine [cached since 168s ago] (1, 'completed', '2025-09-22 15:18:09.309421')
2025-10-22 16:18:09,312 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:09,312 INFO sqlalchemy.engine.Engine [cached since 168s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:09,324 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:09,328 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:14241 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:11,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:11,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:11,288 INFO sqlalchemy.engine.Engine [cached since 173.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:11.288048')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:11,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:11,305 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:11,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:11,308 INFO sqlalchemy.engine.Engine [cached since 173.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:11.305126')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:11,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:13,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:13,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:13,295 INFO sqlalchemy.engine.Engine [cached since 175.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:13.289036')
2025-10-22 16:18:13,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:13,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:13,295 INFO sqlalchemy.engine.Engine [cached since 175.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:13.290230')
2025-10-22 16:18:13,311 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:13,311 INFO sqlalchemy.engine.Engine [cached since 175.2s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:13,320 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:13,342 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:13,344 INFO sqlalchemy.engine.Engine [cached since 172s ago] (1,)
INFO:     127.0.0.1:42919 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:13,348 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:15,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:15,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:15,296 INFO sqlalchemy.engine.Engine [cached since 177.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:15.287971')
2025-10-22 16:18:15,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:15,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:15,304 INFO sqlalchemy.engine.Engine [cached since 177.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:15.296582')
2025-10-22 16:18:15,308 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:15,308 INFO sqlalchemy.engine.Engine [cached since 174s ago] (1, 'completed', '2025-09-22 15:18:15.306914')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:15,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:15,319 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:42919 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:17,325 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:17,330 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:17,330 INFO sqlalchemy.engine.Engine [cached since 179.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:17.325113')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:17,340 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:17,347 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:17,351 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:17,351 INFO sqlalchemy.engine.Engine [cached since 179.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:17.347391')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:17,356 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:19,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:19,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:19,303 INFO sqlalchemy.engine.Engine [cached since 181.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:19.294236')
2025-10-22 16:18:19,315 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:19,315 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:19,315 INFO sqlalchemy.engine.Engine [cached since 181.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:19.299811')
2025-10-22 16:18:19,320 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:19,320 INFO sqlalchemy.engine.Engine [cached since 181.2s ago] (1,)
2025-10-22 16:18:19,327 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:19,327 INFO sqlalchemy.engine.Engine [cached since 178s ago] (1, 'completed', '2025-09-22 15:18:19.325123')
2025-10-22 16:18:19,327 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:19,330 INFO sqlalchemy.engine.Engine [cached since 178s ago] (1,)
2025-10-22 16:18:19,334 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:19,335 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:45430 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:21,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:21,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:21,295 INFO sqlalchemy.engine.Engine [cached since 183.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:21.291934')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:21,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:21,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:21,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:21,304 INFO sqlalchemy.engine.Engine [cached since 183.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:21.300692')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:21,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:23,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:23,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:23,295 INFO sqlalchemy.engine.Engine [cached since 185.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:23.291771')
2025-10-22 16:18:23,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:23,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:23,297 INFO sqlalchemy.engine.Engine [cached since 185.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:23.291771')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:23,300 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:23,303 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:23,303 INFO sqlalchemy.engine.Engine [cached since 185.1s ago] (1,)
2025-10-22 16:18:23,306 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:23,306 INFO sqlalchemy.engine.Engine [cached since 182s ago] (1,)
INFO:     127.0.0.1:56876 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:23,306 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:25,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:25,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:25,290 INFO sqlalchemy.engine.Engine [cached since 187.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:25.287964')
2025-10-22 16:18:25,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:25,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:25,290 INFO sqlalchemy.engine.Engine [cached since 187.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:25.290660')
2025-10-22 16:18:25,294 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:25,294 INFO sqlalchemy.engine.Engine [cached since 184s ago] (1, 'completed', '2025-09-22 15:18:25.294893')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:25,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:25,299 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:56876 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:27,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:27,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:27,295 INFO sqlalchemy.engine.Engine [cached since 189.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:27.289979')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:27,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:27,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:27,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:27,304 INFO sqlalchemy.engine.Engine [cached since 189.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:27.304250')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:27,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:29,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:29,285 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:29,285 INFO sqlalchemy.engine.Engine [cached since 191.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:29.280185')
2025-10-22 16:18:29,285 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:29,285 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:29,285 INFO sqlalchemy.engine.Engine [cached since 191.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:29.280185')
2025-10-22 16:18:29,287 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:29,287 INFO sqlalchemy.engine.Engine [cached since 188s ago] (1, 'completed', '2025-09-22 15:18:29.287675')
2025-10-22 16:18:29,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:29,287 INFO sqlalchemy.engine.Engine [cached since 191.1s ago] (1,)
2025-10-22 16:18:29,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:29,287 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:29,287 INFO sqlalchemy.engine.Engine [cached since 188s ago] (1,)
INFO:     127.0.0.1:30816 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:29,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:31,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:31,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:31,295 INFO sqlalchemy.engine.Engine [cached since 193.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:31.292673')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:31,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:31,307 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:31,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:31,309 INFO sqlalchemy.engine.Engine [cached since 193.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:31.306970')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:31,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:33,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:33,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:33,288 INFO sqlalchemy.engine.Engine [cached since 195.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:33.288608')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:33,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:33,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:33,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:33,295 INFO sqlalchemy.engine.Engine [cached since 195.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:33.292254')
2025-10-22 16:18:33,299 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:33,300 INFO sqlalchemy.engine.Engine [cached since 195.1s ago] (1,)
2025-10-22 16:18:33,302 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:33,302 INFO sqlalchemy.engine.Engine [cached since 192s ago] (1,)
INFO:     127.0.0.1:54573 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:33,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:35,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:35,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:35,295 INFO sqlalchemy.engine.Engine [cached since 197.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:35.291967')
2025-10-22 16:18:35,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:35,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:35,295 INFO sqlalchemy.engine.Engine [cached since 197.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:35.291967')
2025-10-22 16:18:35,297 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:35,297 INFO sqlalchemy.engine.Engine [cached since 194s ago] (1, 'completed', '2025-09-22 15:18:35.295036')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:35,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:35,318 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:54573 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:37,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:37,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:37,292 INFO sqlalchemy.engine.Engine [cached since 199.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:37.288041')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:37,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:37,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:37,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:37,302 INFO sqlalchemy.engine.Engine [cached since 199.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:37.298992')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:37,305 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine [cached since 201.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:39.286321')
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine [cached since 201.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:39.287852')
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:39,287 INFO sqlalchemy.engine.Engine [cached since 201.1s ago] (1,)
2025-10-22 16:18:39,293 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:39,293 INFO sqlalchemy.engine.Engine [cached since 198s ago] (1, 'completed', '2025-09-22 15:18:39.287852')
2025-10-22 16:18:39,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:39,295 INFO sqlalchemy.engine.Engine [cached since 198s ago] (1,)
2025-10-22 16:18:39,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:43944 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:39,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:41,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:41,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:41,290 INFO sqlalchemy.engine.Engine [cached since 203.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:41.288099')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:41,293 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:41,299 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:41,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:41,299 INFO sqlalchemy.engine.Engine [cached since 203.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:41.297462')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:41,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:43,299 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:43,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:43,299 INFO sqlalchemy.engine.Engine [cached since 205.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:43.297148')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:43,306 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:43,307 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:43,307 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:43,307 INFO sqlalchemy.engine.Engine [cached since 205.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:43.302220')
2025-10-22 16:18:43,309 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:43,309 INFO sqlalchemy.engine.Engine [cached since 205.1s ago] (1,)
2025-10-22 16:18:43,312 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:43,312 INFO sqlalchemy.engine.Engine [cached since 202s ago] (1,)
INFO:     127.0.0.1:59516 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:43,316 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:45,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:45,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:45,288 INFO sqlalchemy.engine.Engine [cached since 207.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:45.286212')
2025-10-22 16:18:45,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:45,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:45,288 INFO sqlalchemy.engine.Engine [cached since 207.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:45.288251')
2025-10-22 16:18:45,293 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:45,293 INFO sqlalchemy.engine.Engine [cached since 204s ago] (1, 'completed', '2025-09-22 15:18:45.293108')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:45,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:45,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59516 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:47,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:47,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:47,287 INFO sqlalchemy.engine.Engine [cached since 209.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:47.287850')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:47,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:47,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:47,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:47,304 INFO sqlalchemy.engine.Engine [cached since 209.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:47.301841')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:47,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:49,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:49,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:49,287 INFO sqlalchemy.engine.Engine [cached since 211.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:49.287966')
2025-10-22 16:18:49,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:49,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:49,287 INFO sqlalchemy.engine.Engine [cached since 211.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:49.287966')
2025-10-22 16:18:49,294 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:49,294 INFO sqlalchemy.engine.Engine [cached since 211.1s ago] (1,)
2025-10-22 16:18:49,296 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:49,296 INFO sqlalchemy.engine.Engine [cached since 208s ago] (1, 'completed', '2025-09-22 15:18:49.294669')
2025-10-22 16:18:49,299 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:49,299 INFO sqlalchemy.engine.Engine [cached since 208s ago] (1,)
2025-10-22 16:18:49,301 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:44837 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:49,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:51,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:51,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:51,287 INFO sqlalchemy.engine.Engine [cached since 213.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:51.286475')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:51,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:51,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:51,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:51,294 INFO sqlalchemy.engine.Engine [cached since 213.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:51.294866')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:51,300 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:53,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:53,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:53,292 INFO sqlalchemy.engine.Engine [cached since 215.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:53.284689')
2025-10-22 16:18:53,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:53,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:53,292 INFO sqlalchemy.engine.Engine [cached since 215.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:53.288143')
2025-10-22 16:18:53,294 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:53,294 INFO sqlalchemy.engine.Engine [cached since 215.1s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:53,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:53,296 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:53,296 INFO sqlalchemy.engine.Engine [cached since 212s ago] (1,)
INFO:     127.0.0.1:28919 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:53,319 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:55,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:55,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:55,294 INFO sqlalchemy.engine.Engine [cached since 217.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:55.294895')
2025-10-22 16:18:55,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:55,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:55,294 INFO sqlalchemy.engine.Engine [cached since 217.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:55.292890')
2025-10-22 16:18:55,301 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:55,301 INFO sqlalchemy.engine.Engine [cached since 214s ago] (1, 'completed', '2025-09-22 15:18:55.299939')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:18:55,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:55,306 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:28919 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:18:57,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:57,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:57,289 INFO sqlalchemy.engine.Engine [cached since 219.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:57.289286')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:18:57,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:57,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:57,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:57,302 INFO sqlalchemy.engine.Engine [cached since 219.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:57.301140')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:18:57,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:59,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:59,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:59,293 INFO sqlalchemy.engine.Engine [cached since 221.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:59.291156')
2025-10-22 16:18:59,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:18:59,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:18:59,295 INFO sqlalchemy.engine.Engine [cached since 221.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:18:59.291156')
2025-10-22 16:18:59,295 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:18:59,295 INFO sqlalchemy.engine.Engine [cached since 221.1s ago] (1,)
2025-10-22 16:18:59,299 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:18:59,300 INFO sqlalchemy.engine.Engine [cached since 218s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:18:59,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:18:59,311 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:18:59,311 INFO sqlalchemy.engine.Engine [cached since 218s ago] (1, 'completed', '2025-09-22 15:18:59.311825')
2025-10-22 16:18:59,316 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13612 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:01,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:01,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:01,290 INFO sqlalchemy.engine.Engine [cached since 223.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:01.290067')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:01,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:01,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:01,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:01,301 INFO sqlalchemy.engine.Engine [cached since 223.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:01.299397')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:01,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine [cached since 225.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:03.287860')
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine [cached since 225.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:03.286622')
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:03,287 INFO sqlalchemy.engine.Engine [cached since 225.1s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:03,293 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:03,296 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:03,296 INFO sqlalchemy.engine.Engine [cached since 222s ago] (1,)
INFO:     127.0.0.1:13733 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:03,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:05,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:05,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:05,281 INFO sqlalchemy.engine.Engine [cached since 227.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:05.281875')
2025-10-22 16:19:05,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:05,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:05,281 INFO sqlalchemy.engine.Engine [cached since 227.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:05.281875')
2025-10-22 16:19:05,304 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:05,304 INFO sqlalchemy.engine.Engine [cached since 224s ago] (1, 'completed', '2025-09-22 15:19:05.304240')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:05,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:05,304 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13733 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:07,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:07,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:07,287 INFO sqlalchemy.engine.Engine [cached since 229.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:07.287943')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:07,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:07,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:07,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:07,302 INFO sqlalchemy.engine.Engine [cached since 229.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:07.297257')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:07,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:09,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:09,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:09,291 INFO sqlalchemy.engine.Engine [cached since 231.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:09.287829')
2025-10-22 16:19:09,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:09,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:09,291 INFO sqlalchemy.engine.Engine [cached since 231.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:09.291471')
2025-10-22 16:19:09,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:09,295 INFO sqlalchemy.engine.Engine [cached since 228s ago] (1, 'completed', '2025-09-22 15:19:09.291471')
2025-10-22 16:19:09,296 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:09,296 INFO sqlalchemy.engine.Engine [cached since 231.1s ago] (1,)
2025-10-22 16:19:09,313 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:09,313 INFO sqlalchemy.engine.Engine [cached since 228s ago] (1,)
2025-10-22 16:19:09,313 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:15829 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:09,324 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:11,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:11,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:11,287 INFO sqlalchemy.engine.Engine [cached since 233.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:11.284491')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:11,290 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:11,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:11,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:11,294 INFO sqlalchemy.engine.Engine [cached since 233.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:11.294236')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:11,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:13,316 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:13,316 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:13,316 INFO sqlalchemy.engine.Engine [cached since 235.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:13.289574')
2025-10-22 16:19:13,316 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:13,316 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:13,316 INFO sqlalchemy.engine.Engine [cached since 235.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:13.288086')
2025-10-22 16:19:13,319 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:13,319 INFO sqlalchemy.engine.Engine [cached since 235.2s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:13,319 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:13,319 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:13,319 INFO sqlalchemy.engine.Engine [cached since 232s ago] (1,)
INFO:     127.0.0.1:25261 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:13,338 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:15,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:15,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:15,289 INFO sqlalchemy.engine.Engine [cached since 237.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:15.289642')
2025-10-22 16:19:15,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:15,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:15,289 INFO sqlalchemy.engine.Engine [cached since 237.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:15.289642')
2025-10-22 16:19:15,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:15,295 INFO sqlalchemy.engine.Engine [cached since 234s ago] (1, 'completed', '2025-09-22 15:19:15.289642')
2025-10-22 16:19:15,298 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:15,300 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:25261 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:17,285 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:17,285 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:17,285 INFO sqlalchemy.engine.Engine [cached since 239.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:17.283709')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:17,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:17,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:17,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:17,294 INFO sqlalchemy.engine.Engine [cached since 239.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:17.292361')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:17,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine [cached since 241.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:19.284883')
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine [cached since 241.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:19.288112')
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:19,288 INFO sqlalchemy.engine.Engine [cached since 241.1s ago] (1,)
2025-10-22 16:19:19,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:19,295 INFO sqlalchemy.engine.Engine [cached since 238s ago] (1, 'completed', '2025-09-22 15:19:19.295242')
2025-10-22 16:19:19,303 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:19,303 INFO sqlalchemy.engine.Engine [cached since 238s ago] (1,)
2025-10-22 16:19:19,304 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:19,304 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:11058 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:21,286 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:21,286 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:21,286 INFO sqlalchemy.engine.Engine [cached since 243.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:21.284400')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:21,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:21,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:21,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:21,294 INFO sqlalchemy.engine.Engine [cached since 243.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:21.293448')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:21,300 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:23,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:23,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:23,291 INFO sqlalchemy.engine.Engine [cached since 245.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:23.287818')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:23,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:23,300 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:23,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:23,301 INFO sqlalchemy.engine.Engine [cached since 245.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:23.294961')
2025-10-22 16:19:23,304 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:23,304 INFO sqlalchemy.engine.Engine [cached since 245.1s ago] (1,)
2025-10-22 16:19:23,304 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:23,304 INFO sqlalchemy.engine.Engine [cached since 242s ago] (1,)
INFO:     127.0.0.1:5337 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:23,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:25,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:25,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:25,287 INFO sqlalchemy.engine.Engine [cached since 247.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:25.282837')
2025-10-22 16:19:25,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:25,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:25,287 INFO sqlalchemy.engine.Engine [cached since 247.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:25.282837')
2025-10-22 16:19:25,292 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:25,292 INFO sqlalchemy.engine.Engine [cached since 244s ago] (1, 'completed', '2025-09-22 15:19:25.287667')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:25,292 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:25,298 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:5337 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:27,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:27,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:27,288 INFO sqlalchemy.engine.Engine [cached since 249.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:27.285008')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:27,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:27,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:27,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:27,295 INFO sqlalchemy.engine.Engine [cached since 249.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:27.293462')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:27,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:29,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:29,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:29,292 INFO sqlalchemy.engine.Engine [cached since 251.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:29.288120')
2025-10-22 16:19:29,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:29,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:29,292 INFO sqlalchemy.engine.Engine [cached since 251.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:29.290126')
2025-10-22 16:19:29,294 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:29,294 INFO sqlalchemy.engine.Engine [cached since 251.1s ago] (1,)
2025-10-22 16:19:29,296 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:29,296 INFO sqlalchemy.engine.Engine [cached since 248s ago] (1, 'completed', '2025-09-22 15:19:29.295464')
2025-10-22 16:19:29,299 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:29,299 INFO sqlalchemy.engine.Engine [cached since 248s ago] (1,)
2025-10-22 16:19:29,300 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:29,303 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:32992 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:31,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:31,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:31,291 INFO sqlalchemy.engine.Engine [cached since 253.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:31.287928')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:31,291 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:31,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:31,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:31,301 INFO sqlalchemy.engine.Engine [cached since 253.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:31.301786')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:31,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:33,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:33,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:33,288 INFO sqlalchemy.engine.Engine [cached since 255.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:33.286183')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:33,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:33,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:33,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:33,288 INFO sqlalchemy.engine.Engine [cached since 255.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:33.288008')
2025-10-22 16:19:33,296 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:33,296 INFO sqlalchemy.engine.Engine [cached since 255.1s ago] (1,)
2025-10-22 16:19:33,298 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:33,298 INFO sqlalchemy.engine.Engine [cached since 252s ago] (1,)
INFO:     127.0.0.1:52582 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:33,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:35,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:35,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:35,290 INFO sqlalchemy.engine.Engine [cached since 257.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:35.290069')
2025-10-22 16:19:35,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:35,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:35,293 INFO sqlalchemy.engine.Engine [cached since 257.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:35.287788')
2025-10-22 16:19:35,297 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:35,297 INFO sqlalchemy.engine.Engine [cached since 254s ago] (1, 'completed', '2025-09-22 15:19:35.295164')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:35,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:35,304 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52582 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:37,286 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:37,286 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:37,288 INFO sqlalchemy.engine.Engine [cached since 259.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:37.284642')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:37,291 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:37,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:37,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:37,297 INFO sqlalchemy.engine.Engine [cached since 259.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:37.294989')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:37,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:39,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:39,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:39,288 INFO sqlalchemy.engine.Engine [cached since 261.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:39.288095')
2025-10-22 16:19:39,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:39,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:39,288 INFO sqlalchemy.engine.Engine [cached since 261.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:39.286581')
2025-10-22 16:19:39,292 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:39,292 INFO sqlalchemy.engine.Engine [cached since 258s ago] (1, 'completed', '2025-09-22 15:19:39.288095')
2025-10-22 16:19:39,293 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:39,293 INFO sqlalchemy.engine.Engine [cached since 261.1s ago] (1,)
2025-10-22 16:19:39,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:39,297 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:39,297 INFO sqlalchemy.engine.Engine [cached since 258s ago] (1,)
INFO:     127.0.0.1:34538 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:39,319 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:41,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:41,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:41,290 INFO sqlalchemy.engine.Engine [cached since 263.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:41.290549')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:41,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:41,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:41,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:41,302 INFO sqlalchemy.engine.Engine [cached since 263.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:41.301854')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:41,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:43,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:43,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:43,299 INFO sqlalchemy.engine.Engine [cached since 265.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:43.289217')
2025-10-22 16:19:43,299 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:43,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:43,301 INFO sqlalchemy.engine.Engine [cached since 265.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:43.297215')
2025-10-22 16:19:43,316 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:43,316 INFO sqlalchemy.engine.Engine [cached since 265.2s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:43,319 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:43,321 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:43,321 INFO sqlalchemy.engine.Engine [cached since 262s ago] (1,)
INFO:     127.0.0.1:29490 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:43,324 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:45,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:45,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:45,284 INFO sqlalchemy.engine.Engine [cached since 267.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:45.284649')
2025-10-22 16:19:45,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:45,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:45,288 INFO sqlalchemy.engine.Engine [cached since 267.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:45.284649')
2025-10-22 16:19:45,290 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:45,290 INFO sqlalchemy.engine.Engine [cached since 264s ago] (1, 'completed', '2025-09-22 15:19:45.290615')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:45,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:45,296 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29490 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    forecast=[RevenueForecastData(**item) for item in forecast_data],
              ^^^^^^^^^^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:47,276 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:47,276 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:47,276 INFO sqlalchemy.engine.Engine [cached since 269.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:47.276855')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:47,284 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:47,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:47,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:47,287 INFO sqlalchemy.engine.Engine [cached since 269.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:47.287912')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:47,292 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:49,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:49,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:49,288 INFO sqlalchemy.engine.Engine [cached since 271.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:49.288736')
2025-10-22 16:19:49,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:49,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:49,294 INFO sqlalchemy.engine.Engine [cached since 271.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:49.288736')
2025-10-22 16:19:49,296 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:49,296 INFO sqlalchemy.engine.Engine [cached since 268s ago] (1, 'completed', '2025-09-22 15:19:49.296874')
2025-10-22 16:19:49,296 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:49,296 INFO sqlalchemy.engine.Engine [cached since 271.1s ago] (1,)
2025-10-22 16:19:49,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:49,302 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:49,302 INFO sqlalchemy.engine.Engine [cached since 268s ago] (1,)
INFO:     127.0.0.1:54182 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:49,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:51,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:51,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:51,288 INFO sqlalchemy.engine.Engine [cached since 273.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:51.288658')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:51,293 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:51,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:51,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:51,298 INFO sqlalchemy.engine.Engine [cached since 273.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:51.298226')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:51,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:53,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:53,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:53,288 INFO sqlalchemy.engine.Engine [cached since 275.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:53.288822')
2025-10-22 16:19:53,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:53,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:53,293 INFO sqlalchemy.engine.Engine [cached since 275.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:53.288822')
2025-10-22 16:19:53,296 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:53,297 INFO sqlalchemy.engine.Engine [cached since 275.1s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:53,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:53,302 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:53,302 INFO sqlalchemy.engine.Engine [cached since 272s ago] (1,)
INFO:     127.0.0.1:10517 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:53,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine [cached since 277.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:55.281358')
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine [cached since 277.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:55.287847')
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine [cached since 274s ago] (1, 'completed', '2025-09-22 15:19:55.287847')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:19:55,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:55,297 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:10517 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:19:57,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:57,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:57,287 INFO sqlalchemy.engine.Engine [cached since 279.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:57.286282')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:19:57,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:57,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:57,300 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:57,300 INFO sqlalchemy.engine.Engine [cached since 279.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:57.298207')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:19:57,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:19:59,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:59,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:59,287 INFO sqlalchemy.engine.Engine [cached since 281.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:59.281290')
2025-10-22 16:19:59,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:19:59,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:19:59,287 INFO sqlalchemy.engine.Engine [cached since 281.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:19:59.281290')
2025-10-22 16:19:59,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:19:59,287 INFO sqlalchemy.engine.Engine [cached since 281.1s ago] (1,)
2025-10-22 16:19:59,291 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:19:59,291 INFO sqlalchemy.engine.Engine [cached since 278s ago] (1, 'completed', '2025-09-22 15:19:59.291087')
2025-10-22 16:19:59,291 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:19:59,291 INFO sqlalchemy.engine.Engine [cached since 278s ago] (1,)
2025-10-22 16:19:59,291 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:51155 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:19:59,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:01,276 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:01,276 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:01,276 INFO sqlalchemy.engine.Engine [cached since 283.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:01.276603')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:01,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:01,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:01,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:01,295 INFO sqlalchemy.engine.Engine [cached since 283.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:01.292509')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:01,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:03,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:03,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:03,287 INFO sqlalchemy.engine.Engine [cached since 285.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:03.284250')
2025-10-22 16:20:03,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:03,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:03,287 INFO sqlalchemy.engine.Engine [cached since 285.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:03.287944')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:03,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:03,295 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:03,296 INFO sqlalchemy.engine.Engine [cached since 285.1s ago] (1,)
2025-10-22 16:20:03,300 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:03,300 INFO sqlalchemy.engine.Engine [cached since 282s ago] (1,)
INFO:     127.0.0.1:17069 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:03,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:05,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:05,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:05,290 INFO sqlalchemy.engine.Engine [cached since 287.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:05.285945')
2025-10-22 16:20:05,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:05,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:05,290 INFO sqlalchemy.engine.Engine [cached since 287.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:05.287994')
2025-10-22 16:20:05,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:05,295 INFO sqlalchemy.engine.Engine [cached since 284s ago] (1, 'completed', '2025-09-22 15:20:05.294955')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:05,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:05,301 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:17069 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:07,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:07,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:07,287 INFO sqlalchemy.engine.Engine [cached since 289.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:07.281195')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:07,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:07,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:07,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:07,296 INFO sqlalchemy.engine.Engine [cached since 289.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:07.293367')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:07,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:09,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:09,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:09,295 INFO sqlalchemy.engine.Engine [cached since 291.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:09.287997')
2025-10-22 16:20:09,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:09,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:09,296 INFO sqlalchemy.engine.Engine [cached since 291.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:09.287997')
2025-10-22 16:20:09,296 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:09,296 INFO sqlalchemy.engine.Engine [cached since 291.1s ago] (1,)
2025-10-22 16:20:09,299 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:09,299 INFO sqlalchemy.engine.Engine [cached since 288s ago] (1, 'completed', '2025-09-22 15:20:09.299072')
2025-10-22 16:20:09,299 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:09,302 INFO sqlalchemy.engine.Engine [cached since 288s ago] (1,)
2025-10-22 16:20:09,302 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:17321 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:09,312 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:11,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:11,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:11,288 INFO sqlalchemy.engine.Engine [cached since 293.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:11.285609')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:11,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:11,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:11,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:11,294 INFO sqlalchemy.engine.Engine [cached since 293.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:11.294691')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:11,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine [cached since 295.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:13.284295')
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine [cached since 295.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:13.286115')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:13,287 INFO sqlalchemy.engine.Engine [cached since 295.1s ago] (1,)
2025-10-22 16:20:13,297 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:13,297 INFO sqlalchemy.engine.Engine [cached since 292s ago] (1,)
INFO:     127.0.0.1:35883 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:13,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:15,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:15,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:15,288 INFO sqlalchemy.engine.Engine [cached since 297.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:15.282791')
2025-10-22 16:20:15,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:15,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:15,291 INFO sqlalchemy.engine.Engine [cached since 297.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:15.288202')
2025-10-22 16:20:15,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:15,295 INFO sqlalchemy.engine.Engine [cached since 294s ago] (1, 'completed', '2025-09-22 15:20:15.292121')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:15,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:15,299 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:35883 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:17,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:17,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:17,290 INFO sqlalchemy.engine.Engine [cached since 299.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:17.290609')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:17,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:17,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:17,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:17,301 INFO sqlalchemy.engine.Engine [cached since 299.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:17.300397')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:17,306 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:19,319 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:19,319 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:19,319 INFO sqlalchemy.engine.Engine [cached since 301.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:19.294373')
2025-10-22 16:20:19,322 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:19,324 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:19,324 INFO sqlalchemy.engine.Engine [cached since 301.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:19.298411')
2025-10-22 16:20:19,330 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:19,330 INFO sqlalchemy.engine.Engine [cached since 301.2s ago] (1,)
2025-10-22 16:20:19,330 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:19,330 INFO sqlalchemy.engine.Engine [cached since 298s ago] (1, 'completed', '2025-09-22 15:20:19.330861')
2025-10-22 16:20:19,347 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:19,347 INFO sqlalchemy.engine.Engine [cached since 298s ago] (1,)
2025-10-22 16:20:19,347 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:42864 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:19,369 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:21,283 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:21,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:21,288 INFO sqlalchemy.engine.Engine [cached since 303.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:21.283796')
2025-10-22 16:20:21,294 INFO sqlalchemy.engine.Engine SELECT sum(payments.amount) AS sum_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ?
2025-10-22 16:20:21,294 INFO sqlalchemy.engine.Engine [cached since 303.1s ago] (1, 'completed')
2025-10-22 16:20:21,298 INFO sqlalchemy.engine.Engine SELECT count(payments.id) AS count_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ?
2025-10-22 16:20:21,298 INFO sqlalchemy.engine.Engine [cached since 303.1s ago] (1, 'completed')
2025-10-22 16:20:21,302 INFO sqlalchemy.engine.Engine SELECT count(paywalls.id) AS count_1 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:20:21,302 INFO sqlalchemy.engine.Engine [cached since 303.1s ago] (1,)
2025-10-22 16:20:21,304 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:21,304 INFO sqlalchemy.engine.Engine [cached since 303.1s ago] (1,)
2025-10-22 16:20:21,311 INFO sqlalchemy.engine.Engine SELECT count(payments.id) AS count_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ?
2025-10-22 16:20:21,313 INFO sqlalchemy.engine.Engine [cached since 303.1s ago] (1, 'completed', '2025-10-15 15:20:21.311696')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:21,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:21,324 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:21,324 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:21,324 INFO sqlalchemy.engine.Engine [cached since 303.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:21.321975')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:21,331 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:23,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:23,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:23,293 INFO sqlalchemy.engine.Engine [cached since 305.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:23.283277')
2025-10-22 16:20:23,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:23,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:23,294 INFO sqlalchemy.engine.Engine [cached since 305.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:23.289412')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:23,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:23,304 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:23,304 INFO sqlalchemy.engine.Engine [cached since 305.1s ago] (1,)
2025-10-22 16:20:23,323 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:23,324 INFO sqlalchemy.engine.Engine [cached since 302s ago] (1,)
INFO:     127.0.0.1:9233 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:23,330 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:25,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:25,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:25,295 INFO sqlalchemy.engine.Engine [cached since 307.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:25.288817')
2025-10-22 16:20:25,300 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:25,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:25,301 INFO sqlalchemy.engine.Engine [cached since 307.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:25.290826')
2025-10-22 16:20:25,317 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:25,317 INFO sqlalchemy.engine.Engine [cached since 304s ago] (1, 'completed', '2025-09-22 15:20:25.316158')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:25,321 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:25,323 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:9233 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:27,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:27,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:27,288 INFO sqlalchemy.engine.Engine [cached since 309.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:27.288097')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:27,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:27,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:27,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:27,301 INFO sqlalchemy.engine.Engine [cached since 309.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:27.298616')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:27,305 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:29,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:29,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:29,294 INFO sqlalchemy.engine.Engine [cached since 311.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:29.285331')
2025-10-22 16:20:29,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:29,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:29,295 INFO sqlalchemy.engine.Engine [cached since 311.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:29.290010')
2025-10-22 16:20:29,297 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:29,297 INFO sqlalchemy.engine.Engine [cached since 311.1s ago] (1,)
2025-10-22 16:20:29,300 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:29,300 INFO sqlalchemy.engine.Engine [cached since 308s ago] (1, 'completed', '2025-09-22 15:20:29.299092')
2025-10-22 16:20:29,302 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:29,302 INFO sqlalchemy.engine.Engine [cached since 308s ago] (1,)
2025-10-22 16:20:29,304 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:29,309 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:19059 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:31,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:31,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:31,294 INFO sqlalchemy.engine.Engine [cached since 313.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:31.293818')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:31,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:31,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:31,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:31,304 INFO sqlalchemy.engine.Engine [cached since 313.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:31.302190')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:31,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:33,299 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:33,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:33,299 INFO sqlalchemy.engine.Engine [cached since 315.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:33.294781')
2025-10-22 16:20:33,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:33,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:33,304 INFO sqlalchemy.engine.Engine [cached since 315.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:33.299576')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:33,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:33,315 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:33,315 INFO sqlalchemy.engine.Engine [cached since 315.2s ago] (1,)
2025-10-22 16:20:33,334 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:33,334 INFO sqlalchemy.engine.Engine [cached since 312s ago] (1,)
INFO:     127.0.0.1:13065 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:33,344 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:35,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:35,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:35,295 INFO sqlalchemy.engine.Engine [cached since 317.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:35.292467')
2025-10-22 16:20:35,304 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:35,304 INFO sqlalchemy.engine.Engine [cached since 314s ago] (1, 'completed', '2025-09-22 15:20:35.302258')
2025-10-22 16:20:35,305 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:35,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:35,305 INFO sqlalchemy.engine.Engine [cached since 317.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:35.297572')
2025-10-22 16:20:35,310 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:35,310 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13065 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:37,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:37,301 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:37,302 INFO sqlalchemy.engine.Engine [cached since 319.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:37.296933')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:37,308 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:37,317 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:37,317 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:37,317 INFO sqlalchemy.engine.Engine [cached since 319.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:37.314376')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:37,326 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:39,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:39,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:39,293 INFO sqlalchemy.engine.Engine [cached since 321.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:39.284999')
2025-10-22 16:20:39,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:39,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:39,295 INFO sqlalchemy.engine.Engine [cached since 321.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:39.288798')
2025-10-22 16:20:39,297 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:39,297 INFO sqlalchemy.engine.Engine [cached since 321.1s ago] (1,)
2025-10-22 16:20:39,300 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:39,301 INFO sqlalchemy.engine.Engine [cached since 318s ago] (1, 'completed', '2025-09-22 15:20:39.297561')
2025-10-22 16:20:39,304 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:39,305 INFO sqlalchemy.engine.Engine [cached since 318s ago] (1,)
2025-10-22 16:20:39,309 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:39,314 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:45596 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:41,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:41,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:41,290 INFO sqlalchemy.engine.Engine [cached since 323.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:41.280899')
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:41,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:41,327 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:41,327 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:41,327 INFO sqlalchemy.engine.Engine [cached since 323.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:41.324258')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:41,331 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:43,328 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:43,330 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:43,330 INFO sqlalchemy.engine.Engine [cached since 325.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:43.320324')
2025-10-22 16:20:43,332 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:43,332 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:43,332 INFO sqlalchemy.engine.Engine [cached since 325.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:43.322375')
2025-10-22 16:20:43,344 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:43,345 INFO sqlalchemy.engine.Engine [cached since 325.2s ago] (1,)
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:43,347 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:43,350 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:43,350 INFO sqlalchemy.engine.Engine [cached since 322s ago] (1,)
INFO:     127.0.0.1:64994 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:43,362 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:45,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:45,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:45,293 INFO sqlalchemy.engine.Engine [cached since 327.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:45.284904')
2025-10-22 16:20:45,306 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:45,307 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:45,307 INFO sqlalchemy.engine.Engine [cached since 327.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:45.288242')
2025-10-22 16:20:45,311 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:45,311 INFO sqlalchemy.engine.Engine [cached since 324s ago] (1, 'completed', '2025-09-22 15:20:45.309911')
2025-10-22 16:20:45,319 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24480 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:45,322 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:64994 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:47,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:47,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:47,304 INFO sqlalchemy.engine.Engine [cached since 329.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:47.303151')
INFO:     127.0.0.1:24480 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:47,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:47,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:47,312 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:47,312 INFO sqlalchemy.engine.Engine [cached since 329.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:47.309343')
INFO:     127.0.0.1:24480 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:47,316 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:49,595 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:49,595 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:49,595 INFO sqlalchemy.engine.Engine [cached since 331.5s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:49.595809')
2025-10-22 16:20:49,595 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:49,601 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:49,601 INFO sqlalchemy.engine.Engine [cached since 331.5s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:49.595809')
2025-10-22 16:20:49,601 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:49,601 INFO sqlalchemy.engine.Engine [cached since 331.4s ago] (1,)
2025-10-22 16:20:49,604 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:49,604 INFO sqlalchemy.engine.Engine [cached since 328.3s ago] (1, 'completed', '2025-09-22 15:20:49.604286')
2025-10-22 16:20:49,604 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:49,604 INFO sqlalchemy.engine.Engine [cached since 328.3s ago] (1,)
2025-10-22 16:20:49,604 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63470 - "GET /api/analytics/customers HTTP/1.1" 200 OK
INFO:     127.0.0.1:6336 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:49,619 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:51,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:51,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:51,281 INFO sqlalchemy.engine.Engine [cached since 333.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:51.281680')
2025-10-22 16:20:51,281 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:51,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:51,281 INFO sqlalchemy.engine.Engine [cached since 333.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:51.281680')
INFO:     127.0.0.1:5451 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
INFO:     127.0.0.1:63470 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:51,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:51,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:53,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:53,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:53,287 INFO sqlalchemy.engine.Engine [cached since 335.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:53.282297')
2025-10-22 16:20:53,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:53,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:53,287 INFO sqlalchemy.engine.Engine [cached since 335.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:53.282297')
2025-10-22 16:20:53,292 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:53,292 INFO sqlalchemy.engine.Engine [cached since 335.1s ago] (1,)
INFO:     127.0.0.1:63470 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:53,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:53,297 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:53,297 INFO sqlalchemy.engine.Engine [cached since 332s ago] (1,)
INFO:     127.0.0.1:5451 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:53,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine [cached since 337.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:55.279472')
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine [cached since 337.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:55.282306')
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:55,284 INFO sqlalchemy.engine.Engine [cached since 334s ago] (1, 'completed', '2025-09-22 15:20:55.284188')
2025-10-22 16:20:55,289 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63470 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:55,291 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:5451 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:57,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:57,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:57,287 INFO sqlalchemy.engine.Engine [cached since 339.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:57.284497')
INFO:     127.0.0.1:63470 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:57,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:57,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:57,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:57,295 INFO sqlalchemy.engine.Engine [cached since 339.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:57.295807')
INFO:     127.0.0.1:63470 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:20:57,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:58,754 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:58,756 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:58,756 INFO sqlalchemy.engine.Engine [cached since 340.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:58.752608')
2025-10-22 16:20:58,765 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:20:58,767 INFO sqlalchemy.engine.Engine [cached since 340.6s ago] (1,)
2025-10-22 16:20:58,771 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:20:58,773 INFO sqlalchemy.engine.Engine [cached since 337.5s ago] (1,)
INFO:     127.0.0.1:63470 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:20:58,781 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:58,795 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:58,795 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:58,795 INFO sqlalchemy.engine.Engine [cached since 340.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:58.776418')
2025-10-22 16:20:58,797 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:20:58,797 INFO sqlalchemy.engine.Engine [cached since 337.5s ago] (1, 'completed', '2025-09-22 15:20:58.797447')
2025-10-22 16:20:58,797 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59770 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:20:59,781 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:59,781 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:59,781 INFO sqlalchemy.engine.Engine [cached since 341.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:59.781760')
INFO:     127.0.0.1:63470 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:20:59,792 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:20:59,797 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:20:59,797 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:20:59,797 INFO sqlalchemy.engine.Engine [cached since 341.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:20:59.797491')
INFO:     127.0.0.1:63470 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:20:59,804 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:00,798 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:00,798 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:00,798 INFO sqlalchemy.engine.Engine [cached since 342.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:00.798385')
2025-10-22 16:21:00,802 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:00,802 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:00,802 INFO sqlalchemy.engine.Engine [cached since 342.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:00.798385')
2025-10-22 16:21:00,802 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:21:00,804 INFO sqlalchemy.engine.Engine [cached since 342.6s ago] (1,)
2025-10-22 16:21:00,809 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:21:00,809 INFO sqlalchemy.engine.Engine [cached since 339.5s ago] (1,)
INFO:     127.0.0.1:63470 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:00,811 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:6423 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:21:00,814 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1635 - "OPTIONS /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:40,633 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:40,633 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:40,633 INFO sqlalchemy.engine.Engine [cached since 382.5s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:40.629062')
2025-10-22 16:21:40,633 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:21:40,642 INFO sqlalchemy.engine.Engine [generated in 0.00401s] (1,)
2025-10-22 16:21:40,649 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:21:40,649 INFO sqlalchemy.engine.Engine [generated in 0.00034s] (1, 20, 0)
INFO:     127.0.0.1:38502 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:40,659 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1635 - "OPTIONS /api/content HTTP/1.1" 200 OK
INFO:     127.0.0.1:63999 - "OPTIONS /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:21:42,108 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:42,109 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:42,109 INFO sqlalchemy.engine.Engine [cached since 384s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:42.101806')
2025-10-22 16:21:42,115 INFO sqlalchemy.engine.Engine SELECT content.id 
FROM content 
WHERE content.owner_id = ?
2025-10-22 16:21:42,115 INFO sqlalchemy.engine.Engine [generated in 0.00054s] (1,)
2025-10-22 16:21:42,129 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:42,129 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:42,129 INFO sqlalchemy.engine.Engine [cached since 384s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:42.112202')
2025-10-22 16:21:42,132 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:38502 - "GET /api/content HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\content.py", line 22, in get_content
    content_items, total = await content_service.get_content_by_owner(db, current_user.id, pagination)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\content_service.py", line 34, in get_content_by_owner
    .order_by(Content.created_at.desc())
              ^^^^^^^^^^^^^^^^^^
AttributeError: type object 'Content' has no attribute 'created_at'
INFO:     127.0.0.1:23175 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:21:42,151 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63999 - "OPTIONS /api/analytics/revenue HTTP/1.1" 200 OK
INFO:     127.0.0.1:1635 - "OPTIONS /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:43,118 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:43,118 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:43,118 INFO sqlalchemy.engine.Engine [cached since 385s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:43.111891')
INFO:     127.0.0.1:23175 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:21:43,126 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:43,134 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:43,134 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:43,134 INFO sqlalchemy.engine.Engine [cached since 385s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:43.134121')
INFO:     127.0.0.1:23175 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:43,145 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1635 - "OPTIONS /api/analytics/customers HTTP/1.1" 200 OK
INFO:     127.0.0.1:63999 - "OPTIONS /api/analytics/revenue-forecast HTTP/1.1" 200 OK
2025-10-22 16:21:44,112 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:44,112 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:44,118 INFO sqlalchemy.engine.Engine [cached since 386s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:44.109439')
2025-10-22 16:21:44,119 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:44,119 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:44,120 INFO sqlalchemy.engine.Engine [cached since 386s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:44.112750')
2025-10-22 16:21:44,124 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:21:44,124 INFO sqlalchemy.engine.Engine [cached since 382.8s ago] (1, 'completed', '2025-09-22 15:21:44.124244')
2025-10-22 16:21:44,129 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:21:44,129 INFO sqlalchemy.engine.Engine [cached since 386s ago] (1,)
2025-10-22 16:21:44,129 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:44,134 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:21:44,134 INFO sqlalchemy.engine.Engine [cached since 382.8s ago] (1,)
INFO:     127.0.0.1:44981 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:23175 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:21:44,158 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63999 - "OPTIONS /api/payments/recent?limit=5 HTTP/1.1" 200 OK
INFO:     127.0.0.1:1635 - "OPTIONS /api/customers HTTP/1.1" 200 OK
2025-10-22 16:21:45,119 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:45,119 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:45,119 INFO sqlalchemy.engine.Engine [cached since 387s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:45.110165')
2025-10-22 16:21:45,131 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:21:45,131 INFO sqlalchemy.engine.Engine [generated in 0.00058s] ('recent',)
2025-10-22 16:21:45,135 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:23175 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:21:45,148 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:45,148 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:45,148 INFO sqlalchemy.engine.Engine [cached since 387s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:45.144846')
2025-10-22 16:21:45,156 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:21:45,158 INFO sqlalchemy.engine.Engine [generated in 0.00042s] (1,)
INFO:     127.0.0.1:23175 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:21:45,163 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1635 - "OPTIONS /api/user/preferences HTTP/1.1" 200 OK
INFO:     127.0.0.1:46041 - "GET /api/user/preferences HTTP/1.1" 404 Not Found
2025-10-22 16:21:46,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:46,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:46,300 INFO sqlalchemy.engine.Engine [cached since 388.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:46.289766')
2025-10-22 16:21:46,304 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:21:46,304 INFO sqlalchemy.engine.Engine [cached since 5.667s ago] (1,)
2025-10-22 16:21:46,309 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:21:46,309 INFO sqlalchemy.engine.Engine [cached since 5.659s ago] (1, 20, 0)
INFO:     127.0.0.1:23175 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:46,316 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:47,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:47,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:47,299 INFO sqlalchemy.engine.Engine [cached since 389.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:47.292606')
2025-10-22 16:21:47,301 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:47,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:47,302 INFO sqlalchemy.engine.Engine [cached since 389.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:47.295119')
2025-10-22 16:21:47,311 INFO sqlalchemy.engine.Engine SELECT content.id 
FROM content 
WHERE content.owner_id = ?
2025-10-22 16:21:47,311 INFO sqlalchemy.engine.Engine [cached since 5.196s ago] (1,)
INFO:     127.0.0.1:46041 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:21:47,315 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:47,317 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:23175 - "GET /api/content HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\content.py", line 22, in get_content
    content_items, total = await content_service.get_content_by_owner(db, current_user.id, pagination)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\content_service.py", line 34, in get_content_by_owner
    .order_by(Content.created_at.desc())
              ^^^^^^^^^^^^^^^^^^
AttributeError: type object 'Content' has no attribute 'created_at'
2025-10-22 16:21:48,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:48,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:48,302 INFO sqlalchemy.engine.Engine [cached since 390.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:48.298248')
INFO:     127.0.0.1:46041 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:21:48,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:48,313 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:48,318 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:48,319 INFO sqlalchemy.engine.Engine [cached since 390.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:48.313368')
INFO:     127.0.0.1:46041 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:48,324 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:50,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:50,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:50,290 INFO sqlalchemy.engine.Engine [cached since 392.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:50.285733')
2025-10-22 16:21:50,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:50,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:50,295 INFO sqlalchemy.engine.Engine [cached since 392.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:50.290816')
2025-10-22 16:21:50,295 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:21:50,295 INFO sqlalchemy.engine.Engine [cached since 392.1s ago] (1,)
2025-10-22 16:21:50,305 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:21:50,306 INFO sqlalchemy.engine.Engine [cached since 389s ago] (1, 'completed', '2025-09-22 15:21:50.302033')
2025-10-22 16:21:50,309 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:21:50,309 INFO sqlalchemy.engine.Engine [cached since 389s ago] (1,)
2025-10-22 16:21:50,309 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:23447 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:46041 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:21:50,342 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:51,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:51,311 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:51,311 INFO sqlalchemy.engine.Engine [cached since 393.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:51.309673')
2025-10-22 16:21:51,314 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:21:51,314 INFO sqlalchemy.engine.Engine [cached since 6.185s ago] ('recent',)
2025-10-22 16:21:51,314 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:46041 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:21:51,323 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:51,324 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:51,324 INFO sqlalchemy.engine.Engine [cached since 393.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:51.322330')
2025-10-22 16:21:51,331 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:21:51,331 INFO sqlalchemy.engine.Engine [cached since 6.174s ago] (1,)
INFO:     127.0.0.1:46041 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:21:51,333 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:46041 - "GET /api/user/preferences HTTP/1.1" 404 Not Found
2025-10-22 16:21:53,283 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:53,283 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:53,283 INFO sqlalchemy.engine.Engine [cached since 395.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:53.281883')
INFO:     127.0.0.1:46041 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:21:53,289 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:55,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:55,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:55,302 INFO sqlalchemy.engine.Engine [cached since 397.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:55.295071')
INFO:     127.0.0.1:46041 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:21:55,306 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1790 - "OPTIONS /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:21:55,615 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:55,615 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:55,615 INFO sqlalchemy.engine.Engine [cached since 397.5s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:55.613973')
INFO:     127.0.0.1:46041 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:21:55,619 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:57,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:57,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:57,288 INFO sqlalchemy.engine.Engine [cached since 399.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:57.279464')
2025-10-22 16:21:57,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:57,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:57,288 INFO sqlalchemy.engine.Engine [cached since 399.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:57.279464')
2025-10-22 16:21:57,291 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:21:57,291 INFO sqlalchemy.engine.Engine [cached since 399.1s ago] (1,)
2025-10-22 16:21:57,291 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:21:57,291 INFO sqlalchemy.engine.Engine [cached since 396s ago] (1, 'completed', '2025-09-22 15:21:57.291652')
2025-10-22 16:21:57,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:21:57,295 INFO sqlalchemy.engine.Engine [cached since 396s ago] (1,)
2025-10-22 16:21:57,295 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52969 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:46041 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:21:57,306 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:21:59,283 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:59,283 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:59,283 INFO sqlalchemy.engine.Engine [cached since 401.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:59.280892')
2025-10-22 16:21:59,287 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:21:59,288 INFO sqlalchemy.engine.Engine [cached since 14.16s ago] ('recent',)
2025-10-22 16:21:59,288 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:46041 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:21:59,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:21:59,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:21:59,298 INFO sqlalchemy.engine.Engine [cached since 401.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:21:59.294945')
INFO:     127.0.0.1:46041 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:21:59,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:01,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:01,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:01,295 INFO sqlalchemy.engine.Engine [cached since 403.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:01.292381')
2025-10-22 16:22:01,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:01,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:01,295 INFO sqlalchemy.engine.Engine [cached since 403.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:01.295212')
INFO:     127.0.0.1:46041 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:22:01,299 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:18299 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:01,303 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:02,299 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:02,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:02,302 INFO sqlalchemy.engine.Engine [cached since 404.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:02.299511')
2025-10-22 16:22:02,302 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:02,302 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:02,302 INFO sqlalchemy.engine.Engine [cached since 404.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:02.299511')
2025-10-22 16:22:02,311 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:02,311 INFO sqlalchemy.engine.Engine [cached since 404.1s ago] (1,)
2025-10-22 16:22:02,313 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:02,313 INFO sqlalchemy.engine.Engine [cached since 401s ago] (1, 'completed', '2025-09-22 15:22:02.311631')
2025-10-22 16:22:02,313 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:02,315 INFO sqlalchemy.engine.Engine [cached since 401s ago] (1,)
2025-10-22 16:22:02,315 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:18299 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:02,318 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:46041 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:03,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:03,311 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:03,311 INFO sqlalchemy.engine.Engine [cached since 405.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:03.310608')
2025-10-22 16:22:03,313 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:22:03,313 INFO sqlalchemy.engine.Engine [cached since 18.18s ago] ('recent',)
2025-10-22 16:22:03,313 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:18299 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:22:03,321 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:03,321 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:03,321 INFO sqlalchemy.engine.Engine [cached since 405.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:03.319324')
INFO:     127.0.0.1:18299 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:03,324 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:04,801 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:04,801 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:04,804 INFO sqlalchemy.engine.Engine [cached since 406.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:04.800616')
2025-10-22 16:22:04,805 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:04,805 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:04,805 INFO sqlalchemy.engine.Engine [cached since 406.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:04.801629')
INFO:     127.0.0.1:18299 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:04,810 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:04,812 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:06,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:06,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:06,295 INFO sqlalchemy.engine.Engine [cached since 408.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:06.295406')
2025-10-22 16:22:06,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:06,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:06,298 INFO sqlalchemy.engine.Engine [cached since 408.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:06.293382')
2025-10-22 16:22:06,300 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:06,300 INFO sqlalchemy.engine.Engine [cached since 405s ago] (1, 'completed', '2025-09-22 15:22:06.298899')
2025-10-22 16:22:06,301 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:06,301 INFO sqlalchemy.engine.Engine [cached since 408.1s ago] (1,)
2025-10-22 16:22:06,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:06,301 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:06,304 INFO sqlalchemy.engine.Engine [cached since 405s ago] (1,)
INFO:     127.0.0.1:18299 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:06,316 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:08,279 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:08,279 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:08,279 INFO sqlalchemy.engine.Engine [cached since 410.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:08.279285')
2025-10-22 16:22:08,279 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:22:08,279 INFO sqlalchemy.engine.Engine [cached since 27.65s ago] (1,)
2025-10-22 16:22:08,279 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:22:08,279 INFO sqlalchemy.engine.Engine [cached since 27.63s ago] (1, 20, 0)
INFO:     127.0.0.1:2810 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:08,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:08,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:08,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:08,291 INFO sqlalchemy.engine.Engine [cached since 410.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:08.291244')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:08,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:09,491 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:09,491 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:09,491 INFO sqlalchemy.engine.Engine [cached since 411.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:09.463115')
2025-10-22 16:22:09,491 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:09,491 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:09,491 INFO sqlalchemy.engine.Engine [cached since 411.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:09.465140')
INFO:     127.0.0.1:51767 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:09,498 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:09,498 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine [cached since 412.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:10.461775')
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine [cached since 412.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:10.464488')
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:10,480 INFO sqlalchemy.engine.Engine [cached since 412.3s ago] (1,)
2025-10-22 16:22:10,485 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:10,485 INFO sqlalchemy.engine.Engine [cached since 409.2s ago] (1, 'completed', '2025-09-22 15:22:10.485383')
2025-10-22 16:22:10,487 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:10,489 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:10,489 INFO sqlalchemy.engine.Engine [cached since 409.2s ago] (1,)
INFO:     127.0.0.1:51767 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:10,502 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:11,481 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:11,481 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:11,481 INFO sqlalchemy.engine.Engine [cached since 413.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:11.481275')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:11,481 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:11,488 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:11,491 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:11,491 INFO sqlalchemy.engine.Engine [cached since 413.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:11.488613')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:11,491 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:12,476 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:12,476 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:12,476 INFO sqlalchemy.engine.Engine [cached since 414.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:12.476801')
2025-10-22 16:22:12,476 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:12,476 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:12,476 INFO sqlalchemy.engine.Engine [cached since 414.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:12.476801')
2025-10-22 16:22:12,484 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:12,484 INFO sqlalchemy.engine.Engine [cached since 414.3s ago] (1,)
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:12,484 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:12,488 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:12,488 INFO sqlalchemy.engine.Engine [cached since 411.2s ago] (1,)
INFO:     127.0.0.1:21767 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:12,494 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:14,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:14,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:14,288 INFO sqlalchemy.engine.Engine [cached since 416.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:14.286040')
2025-10-22 16:22:14,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:14,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:14,288 INFO sqlalchemy.engine.Engine [cached since 416.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:14.288272')
2025-10-22 16:22:14,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:14,295 INFO sqlalchemy.engine.Engine [cached since 413s ago] (1, 'completed', '2025-09-22 15:22:14.288272')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:14,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:14,297 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21767 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:16,278 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:16,278 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:16,278 INFO sqlalchemy.engine.Engine [cached since 418.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:16.274122')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:16,282 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:16,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:16,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:16,289 INFO sqlalchemy.engine.Engine [cached since 418.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:16.289066')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:16,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:18,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:18,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:18,297 INFO sqlalchemy.engine.Engine [cached since 420.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:18.292837')
2025-10-22 16:22:18,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:18,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:18,297 INFO sqlalchemy.engine.Engine [cached since 420.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:18.294847')
2025-10-22 16:22:18,300 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:18,301 INFO sqlalchemy.engine.Engine [cached since 420.1s ago] (1,)
2025-10-22 16:22:18,304 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:18,304 INFO sqlalchemy.engine.Engine [cached since 417s ago] (1, 'completed', '2025-09-22 15:22:18.302692')
2025-10-22 16:22:18,318 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:18,318 INFO sqlalchemy.engine.Engine [cached since 417s ago] (1,)
2025-10-22 16:22:18,318 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:3143 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:18,331 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:20,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:20,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:20,294 INFO sqlalchemy.engine.Engine [cached since 422.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:20.285651')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:20,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:20,308 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:20,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:20,309 INFO sqlalchemy.engine.Engine [cached since 422.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:20.306676')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:20,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:21,334 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:21,334 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:21,334 INFO sqlalchemy.engine.Engine [cached since 423.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:21.320326')
2025-10-22 16:22:21,334 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:21,334 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:21,334 INFO sqlalchemy.engine.Engine [cached since 423.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:21.324085')
2025-10-22 16:22:21,351 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:21,351 INFO sqlalchemy.engine.Engine [cached since 423.2s ago] (1,)
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:21,357 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:21,365 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:21,365 INFO sqlalchemy.engine.Engine [cached since 420.1s ago] (1,)
INFO:     127.0.0.1:25913 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:21,369 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine [cached since 424.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:22.292295')
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine [cached since 424.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:22.296491')
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:22:22,296 INFO sqlalchemy.engine.Engine [cached since 41.66s ago] (1,)
2025-10-22 16:22:22,301 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:22,301 INFO sqlalchemy.engine.Engine [cached since 421s ago] (1, 'completed', '2025-09-22 15:22:22.301900')
2025-10-22 16:22:22,306 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:22:22,306 INFO sqlalchemy.engine.Engine [cached since 41.66s ago] (1, 20, 0)
2025-10-22 16:22:22,306 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:25913 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:22,321 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:23,305 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:23,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:23,305 INFO sqlalchemy.engine.Engine [cached since 425.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:23.301969')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:23,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:23,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:23,311 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:23,311 INFO sqlalchemy.engine.Engine [cached since 425.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:23.311865')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:23,314 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:24,312 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:24,313 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:24,313 INFO sqlalchemy.engine.Engine [cached since 426.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:24.309566')
2025-10-22 16:22:24,313 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:24,313 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:24,313 INFO sqlalchemy.engine.Engine [cached since 426.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:24.309566')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:24,313 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:24,318 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:24,318 INFO sqlalchemy.engine.Engine [cached since 426.2s ago] (1,)
2025-10-22 16:22:24,321 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:24,321 INFO sqlalchemy.engine.Engine [cached since 423s ago] (1,)
INFO:     127.0.0.1:6528 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:24,324 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:25,351 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:25,354 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:25,354 INFO sqlalchemy.engine.Engine [cached since 427.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:25.325064')
2025-10-22 16:22:25,355 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:25,355 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:25,355 INFO sqlalchemy.engine.Engine [cached since 427.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:25.325064')
2025-10-22 16:22:25,360 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:25,360 INFO sqlalchemy.engine.Engine [cached since 424.1s ago] (1, 'completed', '2025-09-22 15:22:25.360841')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:25,368 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:25,371 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:6528 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:26,328 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:26,331 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:26,331 INFO sqlalchemy.engine.Engine [cached since 428.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:26.328488')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:26,336 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:26,341 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:26,341 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:26,341 INFO sqlalchemy.engine.Engine [cached since 428.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:26.339709')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:26,348 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:27,337 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:27,337 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:27,337 INFO sqlalchemy.engine.Engine [cached since 429.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:27.334961')
2025-10-22 16:22:27,337 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:27,337 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:27,337 INFO sqlalchemy.engine.Engine [cached since 429.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:27.328499')
2025-10-22 16:22:27,347 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:27,347 INFO sqlalchemy.engine.Engine [cached since 426.1s ago] (1, 'completed', '2025-09-22 15:22:27.345183')
2025-10-22 16:22:27,350 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:27,350 INFO sqlalchemy.engine.Engine [cached since 429.2s ago] (1,)
2025-10-22 16:22:27,354 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:27,356 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:27,356 INFO sqlalchemy.engine.Engine [cached since 426s ago] (1,)
INFO:     127.0.0.1:42458 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:27,372 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:28,341 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:28,342 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:28,342 INFO sqlalchemy.engine.Engine [cached since 430.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:28.339245')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:28,345 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:28,355 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:28,355 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:28,355 INFO sqlalchemy.engine.Engine [cached since 430.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:28.353969')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:28,361 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:29,355 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:29,355 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:29,355 INFO sqlalchemy.engine.Engine [cached since 431.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:29.352483')
2025-10-22 16:22:29,357 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:29,357 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:29,357 INFO sqlalchemy.engine.Engine [cached since 431.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:29.349693')
2025-10-22 16:22:29,360 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:29,360 INFO sqlalchemy.engine.Engine [cached since 431.2s ago] (1,)
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:29,364 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:29,367 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:29,367 INFO sqlalchemy.engine.Engine [cached since 428.1s ago] (1,)
INFO:     127.0.0.1:14177 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:29,374 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:30,360 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:30,360 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:30,360 INFO sqlalchemy.engine.Engine [cached since 432.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:30.357265')
2025-10-22 16:22:30,362 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:30,362 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:30,362 INFO sqlalchemy.engine.Engine [cached since 432.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:30.354507')
2025-10-22 16:22:30,370 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:30,372 INFO sqlalchemy.engine.Engine [cached since 429.1s ago] (1, 'completed', '2025-09-22 15:22:30.368771')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:30,379 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:30,380 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:14177 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:31,365 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:31,370 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:31,370 INFO sqlalchemy.engine.Engine [cached since 433.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:31.361366')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:22:31,374 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:31,376 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:31,376 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:31,376 INFO sqlalchemy.engine.Engine [cached since 433.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:31.376545')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:31,389 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:32,379 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:32,379 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:32,379 INFO sqlalchemy.engine.Engine [cached since 434.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:32.377843')
2025-10-22 16:22:32,379 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:32,386 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:32,386 INFO sqlalchemy.engine.Engine [cached since 434.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:32.379356')
2025-10-22 16:22:32,390 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:32,390 INFO sqlalchemy.engine.Engine [cached since 431.1s ago] (1, 'completed', '2025-09-22 15:22:32.390203')
2025-10-22 16:22:32,394 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:32,394 INFO sqlalchemy.engine.Engine [cached since 434.2s ago] (1,)
2025-10-22 16:22:32,395 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:32,398 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:32,398 INFO sqlalchemy.engine.Engine [cached since 431.1s ago] (1,)
INFO:     127.0.0.1:43194 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:32,421 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:33,388 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:33,388 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:33,388 INFO sqlalchemy.engine.Engine [cached since 435.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:33.388961')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:33,398 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:33,404 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:33,404 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:33,404 INFO sqlalchemy.engine.Engine [cached since 435.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:33.401971')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:22:33,410 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:34,404 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:34,404 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:34,404 INFO sqlalchemy.engine.Engine [cached since 436.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:34.394841')
2025-10-22 16:22:34,404 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:34,404 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:34,404 INFO sqlalchemy.engine.Engine [cached since 436.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:34.402381')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:34,422 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:34,425 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:34,425 INFO sqlalchemy.engine.Engine [cached since 436.3s ago] (1,)
2025-10-22 16:22:34,436 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:34,436 INFO sqlalchemy.engine.Engine [cached since 433.1s ago] (1,)
INFO:     127.0.0.1:2916 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:34,442 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:35,419 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:35,419 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:35,421 INFO sqlalchemy.engine.Engine [cached since 437.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:35.400636')
2025-10-22 16:22:35,421 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:35,421 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:35,421 INFO sqlalchemy.engine.Engine [cached since 437.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:35.395780')
2025-10-22 16:22:35,428 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:35,428 INFO sqlalchemy.engine.Engine [cached since 434.1s ago] (1, 'completed', '2025-09-22 15:22:35.428127')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:35,432 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:35,442 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:2916 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:36,409 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:36,412 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:36,412 INFO sqlalchemy.engine.Engine [cached since 438.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:36.407099')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:22:36,418 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:36,424 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:36,427 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:36,427 INFO sqlalchemy.engine.Engine [cached since 438.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:36.424437')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:36,429 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:37,433 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:37,433 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:37,433 INFO sqlalchemy.engine.Engine [cached since 439.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:37.425040')
2025-10-22 16:22:37,433 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:37,433 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:37,433 INFO sqlalchemy.engine.Engine [cached since 439.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:37.425040')
2025-10-22 16:22:37,451 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:37,452 INFO sqlalchemy.engine.Engine [cached since 439.3s ago] (1,)
2025-10-22 16:22:37,456 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:37,456 INFO sqlalchemy.engine.Engine [cached since 436.2s ago] (1, 'completed', '2025-09-22 15:22:37.454524')
2025-10-22 16:22:37,460 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:37,460 INFO sqlalchemy.engine.Engine [cached since 436.1s ago] (1,)
2025-10-22 16:22:37,460 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29193 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:37,484 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:38,428 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:38,428 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:38,428 INFO sqlalchemy.engine.Engine [cached since 440.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:38.428876')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:38,437 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:38,445 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:38,445 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:38,445 INFO sqlalchemy.engine.Engine [cached since 440.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:38.439485')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:22:38,451 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:39,440 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:39,440 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:39,441 INFO sqlalchemy.engine.Engine [cached since 441.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:39.429613')
2025-10-22 16:22:39,441 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:39,441 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:39,441 INFO sqlalchemy.engine.Engine [cached since 441.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:39.437226')
2025-10-22 16:22:39,444 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:39,444 INFO sqlalchemy.engine.Engine [cached since 441.3s ago] (1,)
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:39,455 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:39,461 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:39,461 INFO sqlalchemy.engine.Engine [cached since 438.1s ago] (1,)
INFO:     127.0.0.1:60634 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:39,461 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:40,453 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:40,456 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:40,456 INFO sqlalchemy.engine.Engine [cached since 442.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:40.444968')
2025-10-22 16:22:40,456 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:40,456 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:40,456 INFO sqlalchemy.engine.Engine [cached since 442.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:40.444968')
2025-10-22 16:22:40,463 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:40,463 INFO sqlalchemy.engine.Engine [cached since 439.2s ago] (1, 'completed', '2025-09-22 15:22:40.460757')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:40,472 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:40,474 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:60634 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:41,459 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:41,459 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:41,459 INFO sqlalchemy.engine.Engine [cached since 443.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:41.459434')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:22:41,469 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:41,474 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:41,474 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:41,474 INFO sqlalchemy.engine.Engine [cached since 443.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:41.474385')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:41,485 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:42,470 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:42,471 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:42,471 INFO sqlalchemy.engine.Engine [cached since 444.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:42.459952')
2025-10-22 16:22:42,471 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:42,471 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:42,471 INFO sqlalchemy.engine.Engine [cached since 444.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:42.466308')
2025-10-22 16:22:42,474 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:42,474 INFO sqlalchemy.engine.Engine [cached since 444.3s ago] (1,)
2025-10-22 16:22:42,478 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:42,478 INFO sqlalchemy.engine.Engine [cached since 441.2s ago] (1, 'completed', '2025-09-22 15:22:42.476290')
2025-10-22 16:22:42,478 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:42,478 INFO sqlalchemy.engine.Engine [cached since 441.2s ago] (1,)
2025-10-22 16:22:42,478 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:36395 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:42,503 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:43,474 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:43,474 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:43,474 INFO sqlalchemy.engine.Engine [cached since 445.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:43.470357')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:43,480 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:43,491 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:43,491 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:43,491 INFO sqlalchemy.engine.Engine [cached since 445.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:43.486990')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:43,495 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:44,480 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:44,480 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:44,480 INFO sqlalchemy.engine.Engine [cached since 446.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:44.475285')
2025-10-22 16:22:44,480 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:44,480 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:44,480 INFO sqlalchemy.engine.Engine [cached since 446.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:44.475285')
2025-10-22 16:22:44,504 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:44,504 INFO sqlalchemy.engine.Engine [cached since 446.3s ago] (1,)
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:44,509 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:44,515 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:44,515 INFO sqlalchemy.engine.Engine [cached since 443.2s ago] (1,)
INFO:     127.0.0.1:21331 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:44,521 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:45,496 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:45,496 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:45,496 INFO sqlalchemy.engine.Engine [cached since 447.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:45.476603')
2025-10-22 16:22:45,498 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:45,499 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:45,499 INFO sqlalchemy.engine.Engine [cached since 447.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:45.478630')
2025-10-22 16:22:45,519 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:45,519 INFO sqlalchemy.engine.Engine [cached since 444.2s ago] (1, 'completed', '2025-09-22 15:22:45.516180')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:45,524 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:45,525 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21331 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:46,480 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:46,480 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:46,480 INFO sqlalchemy.engine.Engine [cached since 448.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:46.480434')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:46,490 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:46,495 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:46,495 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:46,495 INFO sqlalchemy.engine.Engine [cached since 448.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:46.495191')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:46,505 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:47,491 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:47,491 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:47,491 INFO sqlalchemy.engine.Engine [cached since 449.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:47.488920')
2025-10-22 16:22:47,495 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:47,495 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:47,495 INFO sqlalchemy.engine.Engine [cached since 449.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:47.488920')
2025-10-22 16:22:47,512 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:47,512 INFO sqlalchemy.engine.Engine [cached since 449.3s ago] (1,)
2025-10-22 16:22:47,512 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:47,512 INFO sqlalchemy.engine.Engine [cached since 446.2s ago] (1, 'completed', '2025-09-22 15:22:47.512301')
2025-10-22 16:22:47,532 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:47,532 INFO sqlalchemy.engine.Engine [cached since 446.2s ago] (1,)
2025-10-22 16:22:47,537 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:53735 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:47,554 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:48,490 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:48,491 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:48,491 INFO sqlalchemy.engine.Engine [cached since 450.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:48.489363')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:48,497 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:48,507 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:48,507 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:48,507 INFO sqlalchemy.engine.Engine [cached since 450.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:48.505290')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:48,513 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:49,495 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:49,495 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:49,499 INFO sqlalchemy.engine.Engine [cached since 451.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:49.489563')
2025-10-22 16:22:49,499 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:49,500 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:49,500 INFO sqlalchemy.engine.Engine [cached since 451.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:49.495255')
2025-10-22 16:22:49,510 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:49,510 INFO sqlalchemy.engine.Engine [cached since 451.3s ago] (1,)
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:49,510 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:49,522 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:49,522 INFO sqlalchemy.engine.Engine [cached since 448.2s ago] (1,)
INFO:     127.0.0.1:38304 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:49,539 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:50,499 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:50,502 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:50,503 INFO sqlalchemy.engine.Engine [cached since 452.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:50.494934')
2025-10-22 16:22:50,504 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:50,504 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:50,504 INFO sqlalchemy.engine.Engine [cached since 452.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:50.499386')
2025-10-22 16:22:50,507 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:50,507 INFO sqlalchemy.engine.Engine [cached since 449.2s ago] (1, 'completed', '2025-09-22 15:22:50.504232')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:50,514 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:50,516 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:38304 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:51,507 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:51,509 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:51,509 INFO sqlalchemy.engine.Engine [cached since 453.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:51.505674')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:51,515 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:51,520 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:51,523 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:51,523 INFO sqlalchemy.engine.Engine [cached since 453.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:51.519957')
INFO:     127.0.0.1:2810 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:51,529 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:52,534 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:52,536 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:52,536 INFO sqlalchemy.engine.Engine [cached since 454.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:52.513002')
2025-10-22 16:22:52,536 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:52,538 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:52,538 INFO sqlalchemy.engine.Engine [cached since 454.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:52.513002')
2025-10-22 16:22:52,554 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:52,554 INFO sqlalchemy.engine.Engine [cached since 454.4s ago] (1,)
2025-10-22 16:22:52,556 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:52,558 INFO sqlalchemy.engine.Engine [cached since 451.3s ago] (1, 'completed', '2025-09-22 15:22:52.556420')
2025-10-22 16:22:52,569 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:52,570 INFO sqlalchemy.engine.Engine [cached since 451.3s ago] (1,)
2025-10-22 16:22:52,572 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:2810 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:52,587 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24842 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:22:54,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:54,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:54,294 INFO sqlalchemy.engine.Engine [cached since 456.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:54.289805')
2025-10-22 16:22:54,299 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:22:54,299 INFO sqlalchemy.engine.Engine [cached since 73.66s ago] (1,)
2025-10-22 16:22:54,302 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:22:54,302 INFO sqlalchemy.engine.Engine [cached since 73.65s ago] (1, 20, 0)
INFO:     127.0.0.1:2810 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:54,304 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:54,322 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:54,324 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:54,325 INFO sqlalchemy.engine.Engine [cached since 456.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:54.315637')
INFO:     127.0.0.1:2810 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:22:54,342 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:56,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:56,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:56,295 INFO sqlalchemy.engine.Engine [cached since 458.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:56.286087')
2025-10-22 16:22:56,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:56,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:56,295 INFO sqlalchemy.engine.Engine [cached since 458.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:56.288111')
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:22:56,304 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:22:56,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:22:58,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:58,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:58,297 INFO sqlalchemy.engine.Engine [cached since 460.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:58.292617')
2025-10-22 16:22:58,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:22:58,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:22:58,297 INFO sqlalchemy.engine.Engine [cached since 460.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:22:58.295151')
2025-10-22 16:22:58,297 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:22:58,299 INFO sqlalchemy.engine.Engine [cached since 460.1s ago] (1,)
2025-10-22 16:22:58,303 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:22:58,303 INFO sqlalchemy.engine.Engine [cached since 457s ago] (1, 'completed', '2025-09-22 15:22:58.300607')
2025-10-22 16:22:58,303 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:22:58,303 INFO sqlalchemy.engine.Engine [cached since 457s ago] (1,)
2025-10-22 16:22:58,306 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:22:58,309 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:2810 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:00,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:00,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:00,292 INFO sqlalchemy.engine.Engine [cached since 462.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:00.288519')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:00,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:00,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:00,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:00,298 INFO sqlalchemy.engine.Engine [cached since 462.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:00.295867')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:00,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:02,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:02,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:02,295 INFO sqlalchemy.engine.Engine [cached since 464.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:02.289082')
2025-10-22 16:23:02,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:02,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:02,295 INFO sqlalchemy.engine.Engine [cached since 464.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:02.295267')
2025-10-22 16:23:02,301 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:02,301 INFO sqlalchemy.engine.Engine [cached since 464.1s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:02,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:02,305 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:02,305 INFO sqlalchemy.engine.Engine [cached since 461s ago] (1,)
INFO:     127.0.0.1:1306 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:02,305 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:04,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:04,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:04,292 INFO sqlalchemy.engine.Engine [cached since 466.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:04.289980')
2025-10-22 16:23:04,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:04,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:04,292 INFO sqlalchemy.engine.Engine [cached since 466.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:04.289980')
2025-10-22 16:23:04,295 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:04,295 INFO sqlalchemy.engine.Engine [cached since 463s ago] (1, 'completed', '2025-09-22 15:23:04.295002')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:04,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:04,298 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1306 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:05,729 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:05,729 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:05,729 INFO sqlalchemy.engine.Engine [cached since 467.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:05.727740')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:05,735 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:05,744 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:05,746 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:05,746 INFO sqlalchemy.engine.Engine [cached since 467.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:05.742366')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:05,746 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:06,732 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:06,733 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:06,733 INFO sqlalchemy.engine.Engine [cached since 468.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:06.725307')
2025-10-22 16:23:06,734 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:06,734 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:06,734 INFO sqlalchemy.engine.Engine [cached since 468.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:06.725307')
2025-10-22 16:23:06,737 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:06,737 INFO sqlalchemy.engine.Engine [cached since 468.6s ago] (1,)
2025-10-22 16:23:06,737 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:06,737 INFO sqlalchemy.engine.Engine [cached since 465.4s ago] (1, 'completed', '2025-09-22 15:23:06.737303')
2025-10-22 16:23:06,737 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:06,737 INFO sqlalchemy.engine.Engine [cached since 465.4s ago] (1,)
2025-10-22 16:23:06,737 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:40837 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:06,755 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:07,744 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:07,744 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:07,744 INFO sqlalchemy.engine.Engine [cached since 469.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:07.740200')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:07,744 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:07,754 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:07,754 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:07,754 INFO sqlalchemy.engine.Engine [cached since 469.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:07.752433')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:07,754 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:08,756 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:08,759 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:08,759 INFO sqlalchemy.engine.Engine [cached since 470.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:08.756240')
2025-10-22 16:23:08,759 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:08,759 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:08,759 INFO sqlalchemy.engine.Engine [cached since 470.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:08.756240')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:08,759 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:08,764 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:08,764 INFO sqlalchemy.engine.Engine [cached since 470.6s ago] (1,)
2025-10-22 16:23:08,765 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:08,765 INFO sqlalchemy.engine.Engine [cached since 467.5s ago] (1,)
INFO:     127.0.0.1:33872 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:08,769 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine [cached since 471.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:09.756975')
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine [cached since 471.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:09.759591')
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:09,759 INFO sqlalchemy.engine.Engine [cached since 468.5s ago] (1, 'completed', '2025-09-22 15:23:09.759591')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:09,766 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:09,770 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:33872 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:10,770 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:10,772 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:10,772 INFO sqlalchemy.engine.Engine [cached since 472.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:10.764951')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:10,777 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:10,780 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:10,785 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:10,786 INFO sqlalchemy.engine.Engine [cached since 472.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:10.780131')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:10,791 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:11,774 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:11,774 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:11,774 INFO sqlalchemy.engine.Engine [cached since 473.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:11.768874')
2025-10-22 16:23:11,774 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:11,774 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:11,777 INFO sqlalchemy.engine.Engine [cached since 473.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:11.763682')
2025-10-22 16:23:11,794 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:11,794 INFO sqlalchemy.engine.Engine [cached since 470.5s ago] (1, 'completed', '2025-09-22 15:23:11.794790')
2025-10-22 16:23:11,803 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:11,803 INFO sqlalchemy.engine.Engine [cached since 473.6s ago] (1,)
2025-10-22 16:23:11,805 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:11,805 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:11,805 INFO sqlalchemy.engine.Engine [cached since 470.5s ago] (1,)
INFO:     127.0.0.1:29922 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:11,825 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:12,776 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:12,776 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:12,776 INFO sqlalchemy.engine.Engine [cached since 474.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:12.776468')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:12,786 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:12,791 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:12,794 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:12,794 INFO sqlalchemy.engine.Engine [cached since 474.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:12.791933')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:12,803 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:13,795 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:13,795 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:13,795 INFO sqlalchemy.engine.Engine [cached since 475.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:13.786875')
2025-10-22 16:23:13,795 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:13,795 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:13,795 INFO sqlalchemy.engine.Engine [cached since 475.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:13.789906')
2025-10-22 16:23:13,800 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:13,802 INFO sqlalchemy.engine.Engine [cached since 475.6s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:13,804 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:13,809 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:13,809 INFO sqlalchemy.engine.Engine [cached since 472.5s ago] (1,)
INFO:     127.0.0.1:55472 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:13,814 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:14,795 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:14,795 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:14,795 INFO sqlalchemy.engine.Engine [cached since 476.6s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:14.790064')
2025-10-22 16:23:14,795 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:14,795 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:14,795 INFO sqlalchemy.engine.Engine [cached since 476.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:14.793035')
2025-10-22 16:23:14,802 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:14,802 INFO sqlalchemy.engine.Engine [cached since 473.5s ago] (1, 'completed', '2025-09-22 15:23:14.800704')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:14,807 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:14,809 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:55472 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:15,796 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:15,797 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:15,797 INFO sqlalchemy.engine.Engine [cached since 477.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:15.793996')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:15,804 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:15,809 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:15,809 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:15,809 INFO sqlalchemy.engine.Engine [cached since 477.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:15.807458')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:15,819 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:16,809 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:16,809 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:16,809 INFO sqlalchemy.engine.Engine [cached since 478.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:16.805989')
2025-10-22 16:23:16,814 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:16,815 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:16,815 INFO sqlalchemy.engine.Engine [cached since 478.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:16.809869')
2025-10-22 16:23:16,819 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:16,819 INFO sqlalchemy.engine.Engine [cached since 475.5s ago] (1, 'completed', '2025-09-22 15:23:16.815175')
2025-10-22 16:23:16,821 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:16,821 INFO sqlalchemy.engine.Engine [cached since 478.7s ago] (1,)
2025-10-22 16:23:16,824 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:16,825 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:16,825 INFO sqlalchemy.engine.Engine [cached since 475.5s ago] (1,)
INFO:     127.0.0.1:14266 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:16,845 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:17,809 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:17,809 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:17,809 INFO sqlalchemy.engine.Engine [cached since 479.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:17.805329')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:17,819 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:17,824 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:17,824 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:17,824 INFO sqlalchemy.engine.Engine [cached since 479.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:17.824645')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:17,834 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:18,832 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:18,832 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:18,832 INFO sqlalchemy.engine.Engine [cached since 480.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:18.815280')
2025-10-22 16:23:18,832 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:18,832 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:18,832 INFO sqlalchemy.engine.Engine [cached since 480.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:18.809896')
2025-10-22 16:23:18,842 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:18,842 INFO sqlalchemy.engine.Engine [cached since 480.7s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:18,845 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:18,845 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:18,848 INFO sqlalchemy.engine.Engine [cached since 477.5s ago] (1,)
INFO:     127.0.0.1:55909 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:18,854 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:19,824 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:19,824 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:19,824 INFO sqlalchemy.engine.Engine [cached since 481.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:19.821482')
2025-10-22 16:23:19,830 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:19,830 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:19,830 INFO sqlalchemy.engine.Engine [cached since 481.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:19.824358')
2025-10-22 16:23:19,836 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:19,836 INFO sqlalchemy.engine.Engine [cached since 478.5s ago] (1, 'completed', '2025-09-22 15:23:19.833730')
2025-10-22 16:23:19,837 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:23:19,837 INFO sqlalchemy.engine.Engine [cached since 99.2s ago] (1,)
2025-10-22 16:23:19,837 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:19,837 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:23:19,837 INFO sqlalchemy.engine.Engine [cached since 99.19s ago] (1, 20, 0)
INFO:     127.0.0.1:55909 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:21953 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:19,863 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:20,829 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:20,829 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:20,829 INFO sqlalchemy.engine.Engine [cached since 482.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:20.824734')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:20,834 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:20,845 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:20,845 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:20,845 INFO sqlalchemy.engine.Engine [cached since 482.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:20.838749')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:20,851 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:21,850 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:21,850 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:21,852 INFO sqlalchemy.engine.Engine [cached since 483.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:21.844994')
2025-10-22 16:23:21,852 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:21,852 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:21,852 INFO sqlalchemy.engine.Engine [cached since 483.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:21.837588')
2025-10-22 16:23:21,854 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:21,854 INFO sqlalchemy.engine.Engine [cached since 483.7s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:21,859 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:21,862 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:21,862 INFO sqlalchemy.engine.Engine [cached since 480.5s ago] (1,)
INFO:     127.0.0.1:57602 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:21,884 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:22,854 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:22,857 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:22,857 INFO sqlalchemy.engine.Engine [cached since 484.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:22.851752')
2025-10-22 16:23:22,859 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:22,859 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:22,859 INFO sqlalchemy.engine.Engine [cached since 484.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:22.854323')
2025-10-22 16:23:22,862 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:22,862 INFO sqlalchemy.engine.Engine [cached since 481.6s ago] (1, 'completed', '2025-09-22 15:23:22.862396')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:22,869 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:22,872 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:57602 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:23,858 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:23,859 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:23,859 INFO sqlalchemy.engine.Engine [cached since 485.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:23.857524')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:23,865 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:23,871 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:23,871 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:23,871 INFO sqlalchemy.engine.Engine [cached since 485.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:23.869614')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:23,877 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:24,880 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:24,880 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:24,880 INFO sqlalchemy.engine.Engine [cached since 486.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:24.874583')
2025-10-22 16:23:24,884 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:24,884 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:24,884 INFO sqlalchemy.engine.Engine [cached since 486.7s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:24.874583')
2025-10-22 16:23:24,889 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:24,889 INFO sqlalchemy.engine.Engine [cached since 486.7s ago] (1,)
2025-10-22 16:23:24,891 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:24,891 INFO sqlalchemy.engine.Engine [cached since 483.6s ago] (1, 'completed', '2025-09-22 15:23:24.891093')
2025-10-22 16:23:24,895 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:24,898 INFO sqlalchemy.engine.Engine [cached since 483.6s ago] (1,)
2025-10-22 16:23:24,898 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:24,906 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:17766 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:26,296 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:26,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:26,296 INFO sqlalchemy.engine.Engine [cached since 488.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:26.294792')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:26,305 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:26,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:26,316 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:26,317 INFO sqlalchemy.engine.Engine [cached since 488.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:26.310248')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:26,323 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:28,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:28,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:28,294 INFO sqlalchemy.engine.Engine [cached since 490.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:28.289928')
2025-10-22 16:23:28,314 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:28,316 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:28,316 INFO sqlalchemy.engine.Engine [cached since 490.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:28.292818')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:28,324 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:28,327 INFO sqlalchemy.engine.Engine [cached since 490.2s ago] (1,)
2025-10-22 16:23:28,327 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:28,331 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:28,331 INFO sqlalchemy.engine.Engine [cached since 487s ago] (1,)
INFO:     127.0.0.1:46551 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:28,331 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:30,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:30,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:30,293 INFO sqlalchemy.engine.Engine [cached since 492.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:30.288815')
2025-10-22 16:23:30,299 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:30,299 INFO sqlalchemy.engine.Engine [cached since 489s ago] (1, 'completed', '2025-09-22 15:23:30.296211')
2025-10-22 16:23:30,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:30,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:30,310 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:30,311 INFO sqlalchemy.engine.Engine [cached since 492.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:30.304053')
INFO:     127.0.0.1:46551 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:30,343 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:32,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:32,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:32,289 INFO sqlalchemy.engine.Engine [cached since 494.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:32.289830')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:23:32,289 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:32,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:32,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:32,297 INFO sqlalchemy.engine.Engine [cached since 494.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:32.296408')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:32,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:34,291 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:34,291 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:34,291 INFO sqlalchemy.engine.Engine [cached since 496.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:34.288590')
2025-10-22 16:23:34,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:34,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:34,294 INFO sqlalchemy.engine.Engine [cached since 496.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:34.291415')
2025-10-22 16:23:34,294 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:34,294 INFO sqlalchemy.engine.Engine [cached since 496.1s ago] (1,)
2025-10-22 16:23:34,297 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:34,297 INFO sqlalchemy.engine.Engine [cached since 493s ago] (1, 'completed', '2025-09-22 15:23:34.297773')
2025-10-22 16:23:34,297 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:34,297 INFO sqlalchemy.engine.Engine [cached since 493s ago] (1,)
2025-10-22 16:23:34,297 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:36507 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:34,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:36,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:36,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:36,287 INFO sqlalchemy.engine.Engine [cached since 498.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:36.284754')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:36,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:36,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:36,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:36,294 INFO sqlalchemy.engine.Engine [cached since 498.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:36.291647')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:23:36,294 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:38,285 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:38,285 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:38,285 INFO sqlalchemy.engine.Engine [cached since 500.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:38.281491')
2025-10-22 16:23:38,285 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:38,285 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:38,285 INFO sqlalchemy.engine.Engine [cached since 500.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:38.279471')
2025-10-22 16:23:38,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:38,287 INFO sqlalchemy.engine.Engine [cached since 500.1s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:38,290 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:38,294 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:38,294 INFO sqlalchemy.engine.Engine [cached since 497s ago] (1,)
INFO:     127.0.0.1:53591 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:38,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:40,308 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:40,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:40,309 INFO sqlalchemy.engine.Engine [cached since 502.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:40.283829')
2025-10-22 16:23:40,310 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:40,310 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:40,310 INFO sqlalchemy.engine.Engine [cached since 502.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:40.287563')
2025-10-22 16:23:40,310 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:40,310 INFO sqlalchemy.engine.Engine [cached since 499s ago] (1, 'completed', '2025-09-22 15:23:40.310057')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:40,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:40,319 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:53591 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:42,279 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:42,279 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:42,279 INFO sqlalchemy.engine.Engine [cached since 504.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:42.277072')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:23:42,283 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:42,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:42,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:42,293 INFO sqlalchemy.engine.Engine [cached since 504.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:42.290595')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:42,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:44,285 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:44,285 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:44,285 INFO sqlalchemy.engine.Engine [cached since 506.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:44.281012')
2025-10-22 16:23:44,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:44,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:44,287 INFO sqlalchemy.engine.Engine [cached since 506.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:44.284304')
2025-10-22 16:23:44,288 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:44,288 INFO sqlalchemy.engine.Engine [cached since 503s ago] (1, 'completed', '2025-09-22 15:23:44.288910')
2025-10-22 16:23:44,288 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:44,288 INFO sqlalchemy.engine.Engine [cached since 506.1s ago] (1,)
2025-10-22 16:23:44,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:44,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:44,295 INFO sqlalchemy.engine.Engine [cached since 503s ago] (1,)
INFO:     127.0.0.1:63385 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:44,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:46,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:46,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:46,284 INFO sqlalchemy.engine.Engine [cached since 508.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:46.280461')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:46,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:46,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:46,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:46,295 INFO sqlalchemy.engine.Engine [cached since 508.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:46.292838')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:23:46,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:48,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:48,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:48,293 INFO sqlalchemy.engine.Engine [cached since 510.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:48.291611')
2025-10-22 16:23:48,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:48,293 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:48,293 INFO sqlalchemy.engine.Engine [cached since 510.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:48.289758')
2025-10-22 16:23:48,309 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:48,309 INFO sqlalchemy.engine.Engine [cached since 510.1s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:48,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:48,315 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:48,315 INFO sqlalchemy.engine.Engine [cached since 507s ago] (1,)
INFO:     127.0.0.1:1156 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:48,320 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:50,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:50,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:50,288 INFO sqlalchemy.engine.Engine [cached since 512.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:50.283489')
2025-10-22 16:23:50,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:50,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:50,289 INFO sqlalchemy.engine.Engine [cached since 512.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:50.285826')
2025-10-22 16:23:50,299 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:50,299 INFO sqlalchemy.engine.Engine [cached since 509s ago] (1, 'completed', '2025-09-22 15:23:50.297357')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:50,320 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:50,320 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1156 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:52,284 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:52,284 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:52,284 INFO sqlalchemy.engine.Engine [cached since 514.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:52.284280')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:23:52,290 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:52,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:52,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:52,295 INFO sqlalchemy.engine.Engine [cached since 514.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:52.295188')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:52,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:54,282 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:54,283 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:54,283 INFO sqlalchemy.engine.Engine [cached since 516.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:54.279088')
2025-10-22 16:23:54,287 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:54,287 INFO sqlalchemy.engine.Engine [cached since 516.1s ago] (1,)
2025-10-22 16:23:54,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:54,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:54,289 INFO sqlalchemy.engine.Engine [cached since 516.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:54.286299')
2025-10-22 16:23:54,289 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:54,289 INFO sqlalchemy.engine.Engine [cached since 513s ago] (1,)
2025-10-22 16:23:54,289 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:23:54,289 INFO sqlalchemy.engine.Engine [cached since 513s ago] (1, 'completed', '2025-09-22 15:23:54.289577')
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:54,295 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:54,296 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:62342 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:23:56,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:56,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:56,289 INFO sqlalchemy.engine.Engine [cached since 518.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:56.287046')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:23:56,289 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:56,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:56,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:56,295 INFO sqlalchemy.engine.Engine [cached since 518.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:56.295290')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:23:56,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:58,313 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:58,313 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:58,313 INFO sqlalchemy.engine.Engine [cached since 520.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:58.290018')
2025-10-22 16:23:58,313 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:23:58,313 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:23:58,313 INFO sqlalchemy.engine.Engine [cached since 520.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:23:58.290018')
2025-10-22 16:23:58,313 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:23:58,318 INFO sqlalchemy.engine.Engine [cached since 520.2s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:23:58,320 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:23:58,329 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:23:58,329 INFO sqlalchemy.engine.Engine [cached since 517s ago] (1,)
INFO:     127.0.0.1:63188 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:23:58,331 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:00,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:00,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:00,305 INFO sqlalchemy.engine.Engine [cached since 522.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:00.278603')
2025-10-22 16:24:00,305 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:00,305 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:00,305 INFO sqlalchemy.engine.Engine [cached since 522.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:00.281952')
2025-10-22 16:24:00,305 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:00,305 INFO sqlalchemy.engine.Engine [cached since 519s ago] (1, 'completed', '2025-09-22 15:24:00.305905')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:24:00,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:00,313 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63188 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:24:02,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:02,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:02,290 INFO sqlalchemy.engine.Engine [cached since 524.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:02.287916')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:24:02,293 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:02,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:02,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:02,297 INFO sqlalchemy.engine.Engine [cached since 524.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:02.296245')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:24:02,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:04,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:04,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:04,288 INFO sqlalchemy.engine.Engine [cached since 526.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:04.282655')
2025-10-22 16:24:04,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:04,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:04,288 INFO sqlalchemy.engine.Engine [cached since 526.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:04.288205')
2025-10-22 16:24:04,292 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:24:04,292 INFO sqlalchemy.engine.Engine [cached since 526.1s ago] (1,)
2025-10-22 16:24:04,292 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:04,292 INFO sqlalchemy.engine.Engine [cached since 523s ago] (1, 'completed', '2025-09-22 15:24:04.292675')
2025-10-22 16:24:04,295 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:24:04,295 INFO sqlalchemy.engine.Engine [cached since 523s ago] (1,)
2025-10-22 16:24:04,297 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:24:04,299 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:4928 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:24:06,445 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:06,447 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:06,447 INFO sqlalchemy.engine.Engine [cached since 528.3s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:06.441690')
INFO:     127.0.0.1:21953 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:24:06,455 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:06,527 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:06,528 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:06,529 INFO sqlalchemy.engine.Engine [cached since 528.4s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:06.521675')
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:24:06,536 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:08,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:08,299 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:08,299 INFO sqlalchemy.engine.Engine [cached since 530.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:08.294331')
INFO:     127.0.0.1:21953 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:24:08,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:08,317 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:08,319 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:08,319 INFO sqlalchemy.engine.Engine [cached since 530.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:08.315903')
2025-10-22 16:24:08,323 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:24:08,323 INFO sqlalchemy.engine.Engine [cached since 530.2s ago] (1,)
2025-10-22 16:24:08,328 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:24:08,328 INFO sqlalchemy.engine.Engine [cached since 527s ago] (1,)
INFO:     127.0.0.1:21953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:24:08,334 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:10,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:10,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:10,288 INFO sqlalchemy.engine.Engine [cached since 532.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:10.287683')
2025-10-22 16:24:10,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:10,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:10,288 INFO sqlalchemy.engine.Engine [cached since 532.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:10.288883')
2025-10-22 16:24:10,297 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:10,297 INFO sqlalchemy.engine.Engine [cached since 529s ago] (1, 'completed', '2025-09-22 15:24:10.295660')
INFO:     127.0.0.1:8592 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:24:10,298 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:10,301 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21953 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:24:12,290 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:12,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:12,292 INFO sqlalchemy.engine.Engine [cached since 534.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:12.290594')
INFO:     127.0.0.1:8592 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:24:12,296 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:12,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:12,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:12,304 INFO sqlalchemy.engine.Engine [cached since 534.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:12.301906')
INFO:     127.0.0.1:8592 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:24:12,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:14,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:14,288 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:14,288 INFO sqlalchemy.engine.Engine [cached since 536.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:14.284380')
2025-10-22 16:24:14,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:14,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:14,290 INFO sqlalchemy.engine.Engine [cached since 536.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:14.284380')
2025-10-22 16:24:14,292 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:24:14,292 INFO sqlalchemy.engine.Engine [cached since 536.1s ago] (1,)
2025-10-22 16:24:14,294 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:14,294 INFO sqlalchemy.engine.Engine [cached since 533s ago] (1, 'completed', '2025-09-22 15:24:14.292786')
2025-10-22 16:24:14,294 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:24:14,297 INFO sqlalchemy.engine.Engine [cached since 533s ago] (1,)
2025-10-22 16:24:14,297 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:48633 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:8592 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:24:14,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:16,285 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:16,286 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:16,286 INFO sqlalchemy.engine.Engine [cached since 538.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:16.283628')
INFO:     127.0.0.1:8592 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:24:16,288 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:16,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:16,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:16,294 INFO sqlalchemy.engine.Engine [cached since 538.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:16.293810')
INFO:     127.0.0.1:8592 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:24:16,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:18,285 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:18,285 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:18,285 INFO sqlalchemy.engine.Engine [cached since 540.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:18.283165')
2025-10-22 16:24:18,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:18,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:18,298 INFO sqlalchemy.engine.Engine [cached since 540.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:18.285912')
INFO:     127.0.0.1:8592 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:24:18,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:18,305 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:24:18,305 INFO sqlalchemy.engine.Engine [cached since 540.1s ago] (1,)
2025-10-22 16:24:18,305 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:24:18,305 INFO sqlalchemy.engine.Engine [cached since 537s ago] (1,)
INFO:     127.0.0.1:16179 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:24:18,310 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:20,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:20,289 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:20,289 INFO sqlalchemy.engine.Engine [cached since 542.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:20.285922')
2025-10-22 16:24:20,289 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:20,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:20,292 INFO sqlalchemy.engine.Engine [cached since 542.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:20.289013')
2025-10-22 16:24:20,294 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:20,294 INFO sqlalchemy.engine.Engine [cached since 539s ago] (1, 'completed', '2025-09-22 15:24:20.292535')
2025-10-22 16:24:20,297 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:8592 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:24:20,300 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:16179 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:24:22,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:22,287 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:22,287 INFO sqlalchemy.engine.Engine [cached since 544.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:22.287842')
INFO:     127.0.0.1:8592 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:24:22,292 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:22,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:22,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:22,297 INFO sqlalchemy.engine.Engine [cached since 544.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:22.295588')
INFO:     127.0.0.1:8592 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:24:22,299 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:24,208 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:24,208 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:24,208 INFO sqlalchemy.engine.Engine [cached since 546.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:24.206621')
2025-10-22 16:24:24,208 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:24,211 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:24,211 INFO sqlalchemy.engine.Engine [cached since 546.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:24.206621')
2025-10-22 16:24:24,218 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:24,218 INFO sqlalchemy.engine.Engine [cached since 542.9s ago] (1, 'completed', '2025-09-22 15:24:24.214784')
2025-10-22 16:24:24,230 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:24:24,230 INFO sqlalchemy.engine.Engine [cached since 546.1s ago] (1,)
2025-10-22 16:24:24,233 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:24,233 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:24:24,233 INFO sqlalchemy.engine.Engine [cached since 542.9s ago] (1,)
INFO:     127.0.0.1:16303 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:8592 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:24:24,245 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:25,208 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:25,209 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:25,209 INFO sqlalchemy.engine.Engine [cached since 547.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:25.204144')
INFO:     127.0.0.1:8592 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:24:25,211 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:25,217 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:25,218 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:25,219 INFO sqlalchemy.engine.Engine [cached since 547.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:25.215553')
INFO:     127.0.0.1:8592 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:24:25,221 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:26,219 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:26,219 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:26,219 INFO sqlalchemy.engine.Engine [cached since 548.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:26.219170')
2025-10-22 16:24:26,219 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:26,219 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:26,224 INFO sqlalchemy.engine.Engine [cached since 548.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:26.219170')
INFO:     127.0.0.1:8592 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:24:26,226 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:26,226 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:24:26,226 INFO sqlalchemy.engine.Engine [cached since 548.1s ago] (1,)
2025-10-22 16:24:26,231 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:24:26,231 INFO sqlalchemy.engine.Engine [cached since 544.9s ago] (1,)
INFO:     127.0.0.1:19992 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:24:26,233 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine [cached since 549.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:27.233226')
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine [cached since 549.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:27.234237')
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine [cached since 545.9s ago] (1, 'completed', '2025-09-22 15:24:27.235259')
INFO:     127.0.0.1:8592 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:24:27,235 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:27,243 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:19992 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:24:28,239 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:28,239 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:28,239 INFO sqlalchemy.engine.Engine [cached since 550.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:28.232977')
INFO:     127.0.0.1:8592 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:24:28,241 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:28,249 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:28,251 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:28,251 INFO sqlalchemy.engine.Engine [cached since 550.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:28.247307')
INFO:     127.0.0.1:8592 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:24:28,254 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:24:29,254 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:29,254 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:29,254 INFO sqlalchemy.engine.Engine [cached since 551.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:29.249244')
2025-10-22 16:24:29,254 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:24:29,259 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:24:29,259 INFO sqlalchemy.engine.Engine [cached since 551.1s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:24:29.254361')
2025-10-22 16:24:29,262 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:24:29,262 INFO sqlalchemy.engine.Engine [cached since 551.1s ago] (1,)
2025-10-22 16:24:29,268 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:24:29,268 INFO sqlalchemy.engine.Engine [cached since 548s ago] (1, 'completed', '2025-09-22 15:24:29.264707')
2025-10-22 16:24:29,269 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:24:29,269 INFO sqlalchemy.engine.Engine [cached since 548s ago] (1,)
2025-10-22 16:24:29,274 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:8592 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:24:29,280 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:19363 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:57384 - "GET /api/health HTTP/1.1" 200 OK
INFO:     127.0.0.1:25080 - "GET /api/analytics/revenue-forecast HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/dashboard HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/revenue HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/analytics/top-paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/analytics/customers HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/revenue-forecast HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/payments?limit=5&sort=createdAt:desc HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:60799 - "OPTIONS /api/auth/me HTTP/1.1" 200 OK
2025-10-22 16:27:22,655 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:27:22,655 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:27:22,655 INFO sqlalchemy.engine.Engine [cached since 724.5s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:27:22.648182')
2025-10-22 16:27:22,660 INFO sqlalchemy.engine.Engine SELECT users.id, users.name, users.email, users.hashed_password, users.is_active, users.is_verified, users.mfa_enabled, users.mfa_secret, users.role, users.country, users.currency, users.created_at, users.updated_at, users.last_login, users.username, users.avatar, users.user_type 
FROM users 
WHERE users.email = ?
2025-10-22 16:27:22,660 INFO sqlalchemy.engine.Engine [cached since 724.5s ago] ('admin@example.com',)
INFO:     127.0.0.1:35369 - "GET /api/auth/me HTTP/1.1" 200 OK
2025-10-22 16:27:22,690 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:35369 - "GET /api/analytics/dashboard HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/analytics/revenue HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/analytics/top-paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/customers HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/revenue-forecast HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/payments?limit=5&sort=createdAt:desc HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/dashboard HTTP/1.1" 403 Forbidden
2025-10-22 16:27:26,372 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:27:26,374 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:27:26,374 INFO sqlalchemy.engine.Engine [cached since 728.2s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:27:26.362279')
INFO:     127.0.0.1:59629 - "GET /api/auth/me HTTP/1.1" 200 OK
2025-10-22 16:27:26,378 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59629 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/top-paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/customers HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/analytics/revenue-forecast HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/payments?limit=5&sort=createdAt:desc HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/content HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/customers HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/user/preferences HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:35369 - "GET /api/analytics/dashboard HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/analytics/top-paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/customers HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:35369 - "GET /api/analytics/revenue-forecast HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/payments?limit=5&sort=createdAt:desc HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:59629 - "GET /api/paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:27131 - "GET /api/paywalls HTTP/1.1" 403 Forbidden
INFO:     127.0.0.1:55386 - "OPTIONS /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:22,568 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:22,568 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:22,568 INFO sqlalchemy.engine.Engine [cached since 1204s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:22.563184')
2025-10-22 16:35:22,569 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:35:22,569 INFO sqlalchemy.engine.Engine [cached since 821.9s ago] (1,)
2025-10-22 16:35:22,569 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:35:22,569 INFO sqlalchemy.engine.Engine [cached since 821.9s ago] (1, 20, 0)
INFO:     127.0.0.1:58538 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:22,574 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:55386 - "OPTIONS /api/content HTTP/1.1" 200 OK
INFO:     127.0.0.1:64649 - "OPTIONS /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:23,148 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:23,151 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:23,151 INFO sqlalchemy.engine.Engine [cached since 1205s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:23.145901')
2025-10-22 16:35:23,151 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:23,153 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:23,154 INFO sqlalchemy.engine.Engine [cached since 1205s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:23.148535')
2025-10-22 16:35:23,155 INFO sqlalchemy.engine.Engine SELECT content.id 
FROM content 
WHERE content.owner_id = ?
2025-10-22 16:35:23,155 INFO sqlalchemy.engine.Engine [cached since 821s ago] (1,)
2025-10-22 16:35:23,163 INFO sqlalchemy.engine.Engine SELECT sum(payments.amount) AS sum_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ?
2025-10-22 16:35:23,163 INFO sqlalchemy.engine.Engine [cached since 1205s ago] (1, 'completed')
2025-10-22 16:35:23,180 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:23,180 INFO sqlalchemy.engine.Engine SELECT count(payments.id) AS count_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ?
2025-10-22 16:35:23,180 INFO sqlalchemy.engine.Engine [cached since 1205s ago] (1, 'completed')
INFO:     127.0.0.1:58538 - "GET /api/content HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\content.py", line 22, in get_content
    content_items, total = await content_service.get_content_by_owner(db, current_user.id, pagination)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\content_service.py", line 34, in get_content_by_owner
    .order_by(Content.created_at.desc())
              ^^^^^^^^^^^^^^^^^^
AttributeError: type object 'Content' has no attribute 'created_at'
2025-10-22 16:35:23,196 INFO sqlalchemy.engine.Engine SELECT count(paywalls.id) AS count_1 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:35:23,196 INFO sqlalchemy.engine.Engine [cached since 1205s ago] (1,)
2025-10-22 16:35:23,201 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:23,201 INFO sqlalchemy.engine.Engine [cached since 1205s ago] (1,)
2025-10-22 16:35:23,204 INFO sqlalchemy.engine.Engine SELECT count(payments.id) AS count_1 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ?
2025-10-22 16:35:23,204 INFO sqlalchemy.engine.Engine [cached since 1205s ago] (1, 'completed', '2025-10-15 15:35:23.204719')
INFO:     127.0.0.1:57459 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:23,216 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:64649 - "OPTIONS /api/analytics/revenue HTTP/1.1" 200 OK
INFO:     127.0.0.1:55386 - "OPTIONS /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:23,954 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:23,954 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:23,954 INFO sqlalchemy.engine.Engine [cached since 1206s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:23.951196')
2025-10-22 16:35:23,962 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue, count(payments.id) AS sales 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:23,962 INFO sqlalchemy.engine.Engine [cached since 1205s ago] (1, 'completed', '2025-09-22 15:35:23.959464')
INFO:     127.0.0.1:57459 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:23,965 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:23,975 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:23,975 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:23,975 INFO sqlalchemy.engine.Engine [cached since 1206s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:23.972196')
2025-10-22 16:35:23,982 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, sum(payments.amount) AS revenue, count(payments.id) AS conversions 
FROM paywalls LEFT OUTER JOIN payments ON paywalls.id = payments.paywall_id 
WHERE paywalls.owner_id = ? AND payments.status = ? GROUP BY paywalls.id, paywalls.title ORDER BY sum(payments.amount) DESC
 LIMIT ? OFFSET ?
2025-10-22 16:35:23,983 INFO sqlalchemy.engine.Engine [cached since 1205s ago] (1, 'completed', 5, 0)
INFO:     127.0.0.1:57459 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:23,984 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:55386 - "OPTIONS /api/analytics/customers HTTP/1.1" 200 OK
INFO:     127.0.0.1:64649 - "OPTIONS /api/analytics/revenue-forecast HTTP/1.1" 200 OK
2025-10-22 16:35:24,959 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:24,961 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:24,961 INFO sqlalchemy.engine.Engine [cached since 1207s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:24.953751')
2025-10-22 16:35:24,961 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:24,964 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:24,964 INFO sqlalchemy.engine.Engine [cached since 1207s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:24.956270')
2025-10-22 16:35:24,969 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:24,969 INFO sqlalchemy.engine.Engine [cached since 1204s ago] (1, 'completed', '2025-09-22 15:35:24.964641')
2025-10-22 16:35:24,972 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:24,972 INFO sqlalchemy.engine.Engine [cached since 1207s ago] (1,)
2025-10-22 16:35:24,983 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:24,983 INFO sqlalchemy.engine.Engine [cached since 1204s ago] (1,)
2025-10-22 16:35:24,983 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63134 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:57459 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:25,004 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:64649 - "OPTIONS /api/payments/recent?limit=5 HTTP/1.1" 200 OK
INFO:     127.0.0.1:55386 - "OPTIONS /api/customers HTTP/1.1" 200 OK
2025-10-22 16:35:25,964 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:25,964 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:25,966 INFO sqlalchemy.engine.Engine [cached since 1208s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:25.959463')
2025-10-22 16:35:25,969 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:35:25,969 INFO sqlalchemy.engine.Engine [cached since 820.8s ago] ('recent',)
2025-10-22 16:35:25,974 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:57459 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:35:25,984 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:25,984 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:25,984 INFO sqlalchemy.engine.Engine [cached since 1208s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:25.983981')
2025-10-22 16:35:25,984 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:35:25,984 INFO sqlalchemy.engine.Engine [cached since 820.8s ago] (1,)
INFO:     127.0.0.1:57459 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:35:25,997 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:55386 - "OPTIONS /api/user/preferences HTTP/1.1" 200 OK
INFO:     127.0.0.1:17484 - "GET /api/user/preferences HTTP/1.1" 404 Not Found
2025-10-22 16:35:26,965 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:26,968 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:26,969 INFO sqlalchemy.engine.Engine [cached since 1209s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:26.957279')
2025-10-22 16:35:26,969 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:35:26,969 INFO sqlalchemy.engine.Engine [cached since 826.3s ago] (1,)
2025-10-22 16:35:26,980 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:35:26,980 INFO sqlalchemy.engine.Engine [cached since 826.3s ago] (1, 20, 0)
INFO:     127.0.0.1:57459 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:26,982 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:27,963 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:27,963 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:27,963 INFO sqlalchemy.engine.Engine [cached since 1210s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:27.961204')
2025-10-22 16:35:27,963 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:27,963 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:27,963 INFO sqlalchemy.engine.Engine [cached since 1210s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:27.963803')
2025-10-22 16:35:27,969 INFO sqlalchemy.engine.Engine SELECT content.id 
FROM content 
WHERE content.owner_id = ?
2025-10-22 16:35:27,969 INFO sqlalchemy.engine.Engine [cached since 825.9s ago] (1,)
INFO:     127.0.0.1:17484 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:27,979 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:27,984 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:57459 - "GET /api/content HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\content.py", line 22, in get_content
    content_items, total = await content_service.get_content_by_owner(db, current_user.id, pagination)
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\content_service.py", line 34, in get_content_by_owner
    .order_by(Content.created_at.desc())
              ^^^^^^^^^^^^^^^^^^
AttributeError: type object 'Content' has no attribute 'created_at'
2025-10-22 16:35:28,968 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:28,968 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:28,968 INFO sqlalchemy.engine.Engine [cached since 1211s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:28.961582')
INFO:     127.0.0.1:17484 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:28,974 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:28,979 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:28,979 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:28,979 INFO sqlalchemy.engine.Engine [cached since 1211s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:28.979149')
INFO:     127.0.0.1:17484 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:28,989 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:29,982 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:29,982 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:29,982 INFO sqlalchemy.engine.Engine [cached since 1212s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:29.980258')
2025-10-22 16:35:29,982 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:29,982 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:29,982 INFO sqlalchemy.engine.Engine [cached since 1212s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:29.982604')
2025-10-22 16:35:29,996 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:29,996 INFO sqlalchemy.engine.Engine [cached since 1212s ago] (1,)
2025-10-22 16:35:29,999 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:29,999 INFO sqlalchemy.engine.Engine [cached since 1209s ago] (1, 'completed', '2025-09-22 15:35:29.996056')
2025-10-22 16:35:30,002 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:30,002 INFO sqlalchemy.engine.Engine [cached since 1209s ago] (1,)
2025-10-22 16:35:30,004 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:17484 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:30,012 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:34817 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:35:30,984 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:30,984 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:30,989 INFO sqlalchemy.engine.Engine [cached since 1213s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:30.982792')
2025-10-22 16:35:30,996 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:35:30,996 INFO sqlalchemy.engine.Engine [cached since 825.9s ago] ('recent',)
2025-10-22 16:35:31,006 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:17484 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:35:31,017 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:31,018 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:31,019 INFO sqlalchemy.engine.Engine [cached since 1213s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:31.015938')
2025-10-22 16:35:31,025 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:35:31,025 INFO sqlalchemy.engine.Engine [cached since 825.9s ago] (1,)
INFO:     127.0.0.1:17484 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:35:31,029 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:17484 - "GET /api/user/preferences HTTP/1.1" 404 Not Found
2025-10-22 16:35:32,004 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:32,004 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:32,008 INFO sqlalchemy.engine.Engine [cached since 1214s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:32.000048')
INFO:     127.0.0.1:38987 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:32,016 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:33,003 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:33,004 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:33,004 INFO sqlalchemy.engine.Engine [cached since 1215s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:32.998427')
INFO:     127.0.0.1:38987 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:33,011 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:55129 - "OPTIONS /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:35:33,324 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:33,324 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:33,324 INFO sqlalchemy.engine.Engine [cached since 1215s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:33.322164')
INFO:     127.0.0.1:38987 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:35:33,331 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:34,015 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:34,017 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:34,017 INFO sqlalchemy.engine.Engine [cached since 1216s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:34.006508')
2025-10-22 16:35:34,019 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:34,019 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:34,019 INFO sqlalchemy.engine.Engine [cached since 1216s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:34.012729')
2025-10-22 16:35:34,024 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:34,024 INFO sqlalchemy.engine.Engine [cached since 1216s ago] (1,)
2025-10-22 16:35:34,032 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:34,032 INFO sqlalchemy.engine.Engine [cached since 1213s ago] (1, 'completed', '2025-09-22 15:35:34.029917')
2025-10-22 16:35:34,033 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:34,033 INFO sqlalchemy.engine.Engine [cached since 1213s ago] (1,)
2025-10-22 16:35:34,033 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:38987 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:34,042 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:17484 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:35:35,016 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:35,016 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:35,018 INFO sqlalchemy.engine.Engine [cached since 1217s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:35.014230')
2025-10-22 16:35:35,024 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:35:35,024 INFO sqlalchemy.engine.Engine [cached since 829.9s ago] ('recent',)
2025-10-22 16:35:35,028 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:38987 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:35:35,037 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:35,037 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:35,037 INFO sqlalchemy.engine.Engine [cached since 1217s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:35.034156')
INFO:     127.0.0.1:38987 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:35,042 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:36,022 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:36,022 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:36,022 INFO sqlalchemy.engine.Engine [cached since 1218s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:36.015714')
2025-10-22 16:35:36,024 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:36,024 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:36,024 INFO sqlalchemy.engine.Engine [cached since 1218s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:36.017725')
INFO:     127.0.0.1:38987 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:35:36,036 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:47823 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:36,040 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:37,028 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:37,028 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:37,028 INFO sqlalchemy.engine.Engine [cached since 1219s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:37.020632')
2025-10-22 16:35:37,031 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:37,031 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:37,031 INFO sqlalchemy.engine.Engine [cached since 1219s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:37.020632')
2025-10-22 16:35:37,032 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:37,032 INFO sqlalchemy.engine.Engine [cached since 1219s ago] (1,)
2025-10-22 16:35:37,047 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:37,047 INFO sqlalchemy.engine.Engine [cached since 1216s ago] (1, 'completed', '2025-09-22 15:35:37.047244')
2025-10-22 16:35:37,047 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:37,047 INFO sqlalchemy.engine.Engine [cached since 1216s ago] (1,)
2025-10-22 16:35:37,054 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:47823 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:37,059 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:38987 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:35:38,031 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:38,031 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:38,031 INFO sqlalchemy.engine.Engine [cached since 1220s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:38.027900')
2025-10-22 16:35:38,035 INFO sqlalchemy.engine.Engine SELECT payments.id, payments.amount, payments.currency, payments.status, payments.paywall_id, payments.customer_email, payments.customer_name, payments.reference, payments.payment_method, payments.channel, payments.gateway_response, payments.owner_id, payments.created_at, payments.updated_at 
FROM payments 
WHERE payments.reference = ?
2025-10-22 16:35:38,035 INFO sqlalchemy.engine.Engine [cached since 832.9s ago] ('recent',)
2025-10-22 16:35:38,037 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:47823 - "GET /api/payments/recent?limit=5 HTTP/1.1" 404 Not Found
2025-10-22 16:35:38,052 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:38,053 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:38,053 INFO sqlalchemy.engine.Engine [cached since 1220s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:38.049596')
INFO:     127.0.0.1:47823 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:38,054 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:39,045 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:39,045 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:39,046 INFO sqlalchemy.engine.Engine [cached since 1221s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:39.036549')
2025-10-22 16:35:39,046 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:39,046 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:39,046 INFO sqlalchemy.engine.Engine [cached since 1221s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:39.040505')
INFO:     127.0.0.1:47823 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:39,059 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:39,061 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:40,051 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:40,054 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:40,054 INFO sqlalchemy.engine.Engine [cached since 1222s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:40.048082')
2025-10-22 16:35:40,055 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:40,056 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:40,056 INFO sqlalchemy.engine.Engine [cached since 1222s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:40.046055')
2025-10-22 16:35:40,072 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:40,072 INFO sqlalchemy.engine.Engine [cached since 1222s ago] (1,)
2025-10-22 16:35:40,076 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:40,078 INFO sqlalchemy.engine.Engine [cached since 1219s ago] (1, 'completed', '2025-09-22 15:35:40.074420')
2025-10-22 16:35:40,078 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:40,078 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:40,078 INFO sqlalchemy.engine.Engine [cached since 1219s ago] (1,)
INFO:     127.0.0.1:47823 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:40,104 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:41,055 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:41,059 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:41,059 INFO sqlalchemy.engine.Engine [cached since 1223s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:41.055304')
2025-10-22 16:35:41,064 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:35:41,064 INFO sqlalchemy.engine.Engine [cached since 840.4s ago] (1,)
2025-10-22 16:35:41,069 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:35:41,069 INFO sqlalchemy.engine.Engine [cached since 840.4s ago] (1, 20, 0)
INFO:     127.0.0.1:58785 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:41,078 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:41,082 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:41,082 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:41,082 INFO sqlalchemy.engine.Engine [cached since 1223s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:41.082690')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:41,095 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:42,061 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:42,061 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:42,061 INFO sqlalchemy.engine.Engine [cached since 1224s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:42.054689')
2025-10-22 16:35:42,061 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:42,061 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:42,068 INFO sqlalchemy.engine.Engine [cached since 1224s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:42.061006')
INFO:     127.0.0.1:2661 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:42,077 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:42,080 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:43,076 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:43,076 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:43,076 INFO sqlalchemy.engine.Engine [cached since 1225s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:43.070168')
2025-10-22 16:35:43,080 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:43,080 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:43,080 INFO sqlalchemy.engine.Engine [cached since 1225s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:43.070168')
2025-10-22 16:35:43,098 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:43,098 INFO sqlalchemy.engine.Engine [cached since 1225s ago] (1,)
2025-10-22 16:35:43,102 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:43,102 INFO sqlalchemy.engine.Engine [cached since 1222s ago] (1, 'completed', '2025-09-22 15:35:43.100266')
2025-10-22 16:35:43,107 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:43,107 INFO sqlalchemy.engine.Engine [cached since 1222s ago] (1,)
2025-10-22 16:35:43,111 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:2661 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:43,129 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:44,075 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:44,078 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:44,078 INFO sqlalchemy.engine.Engine [cached since 1226s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:44.068958')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:44,084 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:44,093 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:44,094 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:44,095 INFO sqlalchemy.engine.Engine [cached since 1226s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:44.089660')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:44,099 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:45,084 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:45,084 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:45,084 INFO sqlalchemy.engine.Engine [cached since 1227s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:45.080541')
2025-10-22 16:35:45,084 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:45,084 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:45,084 INFO sqlalchemy.engine.Engine [cached since 1227s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:45.080541')
2025-10-22 16:35:45,089 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:45,090 INFO sqlalchemy.engine.Engine [cached since 1227s ago] (1,)
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:45,095 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:45,097 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:45,097 INFO sqlalchemy.engine.Engine [cached since 1224s ago] (1,)
INFO:     127.0.0.1:52698 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:45,124 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:46,087 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:46,089 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:46,089 INFO sqlalchemy.engine.Engine [cached since 1228s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:46.082936')
2025-10-22 16:35:46,091 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:46,094 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:46,094 INFO sqlalchemy.engine.Engine [cached since 1228s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:46.084684')
2025-10-22 16:35:46,099 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:46,099 INFO sqlalchemy.engine.Engine [cached since 1225s ago] (1, 'completed', '2025-09-22 15:35:46.098299')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:46,102 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:46,131 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52698 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:35:47,090 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:47,092 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:47,092 INFO sqlalchemy.engine.Engine [cached since 1229s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:47.088490')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:47,097 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:47,106 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:47,106 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:47,106 INFO sqlalchemy.engine.Engine [cached since 1229s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:47.102929')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:47,115 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:48,115 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:48,115 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:48,115 INFO sqlalchemy.engine.Engine [cached since 1230s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:48.104862')
2025-10-22 16:35:48,120 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:48,121 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:48,121 INFO sqlalchemy.engine.Engine [cached since 1230s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:48.106886')
2025-10-22 16:35:48,134 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:48,138 INFO sqlalchemy.engine.Engine [cached since 1227s ago] (1, 'completed', '2025-09-22 15:35:48.133597')
2025-10-22 16:35:48,145 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:48,146 INFO sqlalchemy.engine.Engine [cached since 1230s ago] (1,)
2025-10-22 16:35:48,152 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:48,156 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:48,156 INFO sqlalchemy.engine.Engine [cached since 1227s ago] (1,)
INFO:     127.0.0.1:11405 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:48,193 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:49,101 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:49,102 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:49,102 INFO sqlalchemy.engine.Engine [cached since 1231s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:49.094895')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:49,106 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:49,115 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:49,115 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:49,116 INFO sqlalchemy.engine.Engine [cached since 1231s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:49.112369')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:49,119 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:50,349 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:50,349 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:50,349 INFO sqlalchemy.engine.Engine [cached since 1232s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:50.344837')
2025-10-22 16:35:50,349 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:50,351 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:50,351 INFO sqlalchemy.engine.Engine [cached since 1232s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:50.347928')
2025-10-22 16:35:50,355 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:50,355 INFO sqlalchemy.engine.Engine [cached since 1232s ago] (1,)
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:50,360 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:50,363 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:50,363 INFO sqlalchemy.engine.Engine [cached since 1229s ago] (1,)
INFO:     127.0.0.1:50213 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:50,369 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:51,454 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:51,454 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:51,454 INFO sqlalchemy.engine.Engine [cached since 1233s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:51.432115')
2025-10-22 16:35:51,454 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:51,454 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:51,454 INFO sqlalchemy.engine.Engine [cached since 1233s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:51.436098')
2025-10-22 16:35:51,476 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:51,476 INFO sqlalchemy.engine.Engine [cached since 1230s ago] (1, 'completed', '2025-09-22 15:35:51.474052')
2025-10-22 16:35:51,494 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:35:51,494 INFO sqlalchemy.engine.Engine [cached since 850.9s ago] (1,)
2025-10-22 16:35:51,498 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:51,498 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:35:51,498 INFO sqlalchemy.engine.Engine [cached since 850.9s ago] (1, 20, 0)
INFO:     127.0.0.1:50213 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:51,521 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:54,161 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:54,161 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:54,161 INFO sqlalchemy.engine.Engine [cached since 1236s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:54.158211')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:54,168 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:54,174 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:54,174 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:54,174 INFO sqlalchemy.engine.Engine [cached since 1236s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:54.171286')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:54,183 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:55,104 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:55,112 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:55,112 INFO sqlalchemy.engine.Engine [cached since 1237s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:55.101984')
2025-10-22 16:35:55,112 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:55,112 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:55,112 INFO sqlalchemy.engine.Engine [cached since 1237s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:55.104684')
2025-10-22 16:35:55,118 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:55,119 INFO sqlalchemy.engine.Engine [cached since 1237s ago] (1,)
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:55,119 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:55,126 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:55,128 INFO sqlalchemy.engine.Engine [cached since 1234s ago] (1,)
INFO:     127.0.0.1:22951 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:55,147 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:56,109 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:56,110 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:56,110 INFO sqlalchemy.engine.Engine [cached since 1238s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:56.102312')
2025-10-22 16:35:56,112 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:56,113 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:56,113 INFO sqlalchemy.engine.Engine [cached since 1238s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:56.104479')
2025-10-22 16:35:56,114 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:56,114 INFO sqlalchemy.engine.Engine [cached since 1235s ago] (1, 'completed', '2025-09-22 15:35:56.114164')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:56,122 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:56,133 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:22951 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:35:57,110 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:57,111 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:57,111 INFO sqlalchemy.engine.Engine [cached since 1239s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:57.104260')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:57,119 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:57,128 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:57,128 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:57,128 INFO sqlalchemy.engine.Engine [cached since 1239s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:57.125828')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:35:57,133 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:58,127 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:58,127 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:58,127 INFO sqlalchemy.engine.Engine [cached since 1240s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:58.121917')
2025-10-22 16:35:58,127 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:58,127 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:58,127 INFO sqlalchemy.engine.Engine [cached since 1240s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:58.127469')
2025-10-22 16:35:58,137 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:35:58,137 INFO sqlalchemy.engine.Engine [cached since 1240s ago] (1,)
2025-10-22 16:35:58,145 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:35:58,145 INFO sqlalchemy.engine.Engine [cached since 1237s ago] (1, 'completed', '2025-09-22 15:35:58.137007')
2025-10-22 16:35:58,147 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:35:58,147 INFO sqlalchemy.engine.Engine [cached since 1237s ago] (1,)
2025-10-22 16:35:58,152 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:35:58,170 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:60215 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:35:59,119 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:59,119 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:59,124 INFO sqlalchemy.engine.Engine [cached since 1241s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:59.119359')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:35:59,127 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:35:59,136 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:35:59,136 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:35:59,136 INFO sqlalchemy.engine.Engine [cached since 1241s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:35:59.127398')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:35:59,145 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine [cached since 1242s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:00.124016')
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine [cached since 1242s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:00.127045')
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:00,129 INFO sqlalchemy.engine.Engine [cached since 1242s ago] (1,)
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:00,145 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:00,145 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:00,147 INFO sqlalchemy.engine.Engine [cached since 1239s ago] (1,)
INFO:     127.0.0.1:38305 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:00,154 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:01,138 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:01,138 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:01,138 INFO sqlalchemy.engine.Engine [cached since 1243s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:01.130196')
2025-10-22 16:36:01,138 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:01,138 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:01,142 INFO sqlalchemy.engine.Engine [cached since 1243s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:01.134228')
2025-10-22 16:36:01,147 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:01,147 INFO sqlalchemy.engine.Engine [cached since 1240s ago] (1, 'completed', '2025-09-22 15:36:01.147145')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:01,151 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:01,154 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:38305 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:02,138 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:02,138 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:02,138 INFO sqlalchemy.engine.Engine [cached since 1244s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:02.132790')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:36:02,145 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:02,171 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:02,171 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:02,171 INFO sqlalchemy.engine.Engine [cached since 1244s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:02.150944')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:02,178 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:03,160 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:03,160 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:03,160 INFO sqlalchemy.engine.Engine [cached since 1245s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:03.154621')
2025-10-22 16:36:03,160 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:03,160 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:03,160 INFO sqlalchemy.engine.Engine [cached since 1245s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:03.151968')
2025-10-22 16:36:03,179 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:03,179 INFO sqlalchemy.engine.Engine [cached since 1242s ago] (1, 'completed', '2025-09-22 15:36:03.175987')
2025-10-22 16:36:03,179 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:62253 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:03,211 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:03,211 INFO sqlalchemy.engine.Engine [cached since 1245s ago] (1,)
2025-10-22 16:36:03,213 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:03,213 INFO sqlalchemy.engine.Engine [cached since 1242s ago] (1,)
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:03,215 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:04,170 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:04,170 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:04,174 INFO sqlalchemy.engine.Engine [cached since 1246s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:04.170706')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:04,179 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:04,189 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:04,189 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:04,189 INFO sqlalchemy.engine.Engine [cached since 1246s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:04.184896')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:36:04,197 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:05,184 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:05,188 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:05,188 INFO sqlalchemy.engine.Engine [cached since 1247s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:05.181565')
2025-10-22 16:36:05,188 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:05,188 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:05,188 INFO sqlalchemy.engine.Engine [cached since 1247s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:05.184423')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:05,199 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:05,201 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:05,201 INFO sqlalchemy.engine.Engine [cached since 1247s ago] (1,)
2025-10-22 16:36:05,210 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:05,210 INFO sqlalchemy.engine.Engine [cached since 1244s ago] (1,)
INFO:     127.0.0.1:61108 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:05,210 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:06,204 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:06,204 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:06,204 INFO sqlalchemy.engine.Engine [cached since 1248s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:06.197507')
2025-10-22 16:36:06,205 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:06,205 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:06,205 INFO sqlalchemy.engine.Engine [cached since 1248s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:06.200103')
2025-10-22 16:36:06,209 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:06,209 INFO sqlalchemy.engine.Engine [cached since 1245s ago] (1, 'completed', '2025-09-22 15:36:06.209382')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:06,216 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:06,216 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:61108 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:07,593 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:07,595 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:07,595 INFO sqlalchemy.engine.Engine [cached since 1249s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:07.588887')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:36:07,602 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:07,608 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:07,609 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:07,609 INFO sqlalchemy.engine.Engine [cached since 1249s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:07.604262')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:07,613 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:08,226 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:08,228 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:08,228 INFO sqlalchemy.engine.Engine [cached since 1250s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:08.223005')
2025-10-22 16:36:08,228 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:08,228 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:08,228 INFO sqlalchemy.engine.Engine [cached since 1250s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:08.221241')
2025-10-22 16:36:08,232 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:08,232 INFO sqlalchemy.engine.Engine [cached since 1250s ago] (1,)
2025-10-22 16:36:08,232 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:08,232 INFO sqlalchemy.engine.Engine [cached since 1247s ago] (1, 'completed', '2025-09-22 15:36:08.232307')
2025-10-22 16:36:08,237 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:08,243 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:08,243 INFO sqlalchemy.engine.Engine [cached since 1247s ago] (1,)
INFO:     127.0.0.1:27238 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:08,264 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:09,228 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:09,232 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:09,232 INFO sqlalchemy.engine.Engine [cached since 1251s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:09.228055')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:09,237 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:09,245 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:09,245 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:09,245 INFO sqlalchemy.engine.Engine [cached since 1251s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:09.242132')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:36:09,257 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:10,242 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:10,243 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:10,243 INFO sqlalchemy.engine.Engine [cached since 1252s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:10.235248')
2025-10-22 16:36:10,245 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:10,245 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:10,245 INFO sqlalchemy.engine.Engine [cached since 1252s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:10.232845')
2025-10-22 16:36:10,261 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:10,261 INFO sqlalchemy.engine.Engine [cached since 1252s ago] (1,)
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:10,267 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:10,268 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:10,268 INFO sqlalchemy.engine.Engine [cached since 1249s ago] (1,)
INFO:     127.0.0.1:3102 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:10,278 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:11,252 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:11,252 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:11,252 INFO sqlalchemy.engine.Engine [cached since 1253s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:11.247693')
2025-10-22 16:36:11,254 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:11,254 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:11,254 INFO sqlalchemy.engine.Engine [cached since 1253s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:11.247693')
2025-10-22 16:36:11,275 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:11,275 INFO sqlalchemy.engine.Engine [cached since 1250s ago] (1, 'completed', '2025-09-22 15:36:11.271769')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:11,281 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:11,283 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:3102 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:12,253 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:12,254 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:12,254 INFO sqlalchemy.engine.Engine [cached since 1254s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:12.246212')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:36:12,261 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:12,269 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:12,269 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:12,269 INFO sqlalchemy.engine.Engine [cached since 1254s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:12.267554')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:12,275 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:13,274 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:13,275 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:13,275 INFO sqlalchemy.engine.Engine [cached since 1255s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:13.269813')
2025-10-22 16:36:13,276 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:13,276 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:13,276 INFO sqlalchemy.engine.Engine [cached since 1255s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:13.262024')
2025-10-22 16:36:13,281 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:13,281 INFO sqlalchemy.engine.Engine [cached since 1252s ago] (1, 'completed', '2025-09-22 15:36:13.280790')
2025-10-22 16:36:13,284 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:13,284 INFO sqlalchemy.engine.Engine [cached since 1255s ago] (1,)
2025-10-22 16:36:13,289 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:13,289 INFO sqlalchemy.engine.Engine [cached since 1252s ago] (1,)
2025-10-22 16:36:13,289 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:8100 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:13,333 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:14,269 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:14,274 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:14,275 INFO sqlalchemy.engine.Engine [cached since 1256s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:14.269784')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:14,280 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:14,287 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:14,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:14,290 INFO sqlalchemy.engine.Engine [cached since 1256s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:14.283644')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:14,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:15,277 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:15,281 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:15,281 INFO sqlalchemy.engine.Engine [cached since 1257s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:15.272390')
2025-10-22 16:36:15,297 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:15,297 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:15,297 INFO sqlalchemy.engine.Engine [cached since 1257s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:15.277109')
2025-10-22 16:36:15,304 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:15,309 INFO sqlalchemy.engine.Engine [cached since 1257s ago] (1,)
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:15,311 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:15,314 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:15,314 INFO sqlalchemy.engine.Engine [cached since 1254s ago] (1,)
INFO:     127.0.0.1:57910 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:15,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:16,298 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:16,298 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:16,298 INFO sqlalchemy.engine.Engine [cached since 1258s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:16.282183')
2025-10-22 16:36:16,322 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:16,323 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:16,324 INFO sqlalchemy.engine.Engine [cached since 1258s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:16.286213')
2025-10-22 16:36:16,329 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:16,329 INFO sqlalchemy.engine.Engine [cached since 1255s ago] (1, 'completed', '2025-09-22 15:36:16.327432')
2025-10-22 16:36:16,360 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:16,361 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:57910 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:18,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:18,296 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:18,296 INFO sqlalchemy.engine.Engine [cached since 1260s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:18.293288')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:18,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:18,312 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:18,312 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:18,312 INFO sqlalchemy.engine.Engine [cached since 1260s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:18.308136')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:18,318 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:20,288 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:20,290 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:20,290 INFO sqlalchemy.engine.Engine [cached since 1262s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:20.284983')
2025-10-22 16:36:20,292 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:20,292 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:20,292 INFO sqlalchemy.engine.Engine [cached since 1262s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:20.288027')
2025-10-22 16:36:20,300 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:20,300 INFO sqlalchemy.engine.Engine [cached since 1259s ago] (1, 'completed', '2025-09-22 15:36:20.296989')
2025-10-22 16:36:20,302 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:20,302 INFO sqlalchemy.engine.Engine [cached since 1262s ago] (1,)
2025-10-22 16:36:20,309 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:20,312 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:20,312 INFO sqlalchemy.engine.Engine [cached since 1259s ago] (1,)
INFO:     127.0.0.1:35468 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:20,339 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:21,293 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:21,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:21,294 INFO sqlalchemy.engine.Engine [cached since 1263s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:21.290195')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:21,302 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:21,306 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:21,309 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:21,309 INFO sqlalchemy.engine.Engine [cached since 1263s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:21.304721')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:21,314 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:22,325 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:22,326 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:22,326 INFO sqlalchemy.engine.Engine [cached since 1264s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:22.299763')
2025-10-22 16:36:22,327 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:22,329 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:22,329 INFO sqlalchemy.engine.Engine [cached since 1264s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:22.309855')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:22,332 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:22,336 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:22,338 INFO sqlalchemy.engine.Engine [cached since 1264s ago] (1,)
2025-10-22 16:36:22,345 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:22,345 INFO sqlalchemy.engine.Engine [cached since 1261s ago] (1,)
INFO:     127.0.0.1:39361 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:22,349 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:23,318 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:23,320 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:23,320 INFO sqlalchemy.engine.Engine [cached since 1265s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:23.311842')
2025-10-22 16:36:23,320 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:23,324 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:23,324 INFO sqlalchemy.engine.Engine [cached since 1265s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:23.315709')
2025-10-22 16:36:23,329 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:23,329 INFO sqlalchemy.engine.Engine [cached since 1262s ago] (1, 'completed', '2025-09-22 15:36:23.326747')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:23,336 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:23,338 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:39361 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:24,319 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:24,321 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:24,321 INFO sqlalchemy.engine.Engine [cached since 1266s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:24.316911')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:24,327 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:24,332 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:24,332 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:24,332 INFO sqlalchemy.engine.Engine [cached since 1266s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:24.331972')
INFO:     127.0.0.1:58785 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:24,341 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:25,332 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:25,332 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:25,332 INFO sqlalchemy.engine.Engine [cached since 1267s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:25.332077')
2025-10-22 16:36:25,332 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:25,332 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:25,332 INFO sqlalchemy.engine.Engine [cached since 1267s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:25.332077')
2025-10-22 16:36:25,360 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:25,361 INFO sqlalchemy.engine.Engine [cached since 1267s ago] (1,)
2025-10-22 16:36:25,362 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:25,362 INFO sqlalchemy.engine.Engine [cached since 1264s ago] (1, 'completed', '2025-09-22 15:36:25.362910')
2025-10-22 16:36:25,391 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:25,391 INFO sqlalchemy.engine.Engine [cached since 1264s ago] (1,)
2025-10-22 16:36:25,391 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:39300 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:58785 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:25,411 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:26,396 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:26,396 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:26,396 INFO sqlalchemy.engine.Engine [cached since 1268s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:26.395545')
2025-10-22 16:36:26,403 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:36:26,403 INFO sqlalchemy.engine.Engine [cached since 885.8s ago] (1,)
2025-10-22 16:36:26,404 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:36:26,406 INFO sqlalchemy.engine.Engine [cached since 885.8s ago] (1, 20, 0)
INFO:     127.0.0.1:58785 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:26,413 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:26,419 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:26,419 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:26,419 INFO sqlalchemy.engine.Engine [cached since 1268s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:26.419344')
INFO:     127.0.0.1:58785 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:26,427 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:27,442 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:27,442 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:27,442 INFO sqlalchemy.engine.Engine [cached since 1269s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:27.438574')
2025-10-22 16:36:27,442 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:27,442 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:27,442 INFO sqlalchemy.engine.Engine [cached since 1269s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:27.437151')
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:27,448 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:27,451 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:28,354 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:28,355 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:28,356 INFO sqlalchemy.engine.Engine [cached since 1270s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:28.347447')
2025-10-22 16:36:28,359 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:28,359 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:28,359 INFO sqlalchemy.engine.Engine [cached since 1270s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:28.349547')
2025-10-22 16:36:28,363 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:28,363 INFO sqlalchemy.engine.Engine [cached since 1270s ago] (1,)
2025-10-22 16:36:28,366 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:28,366 INFO sqlalchemy.engine.Engine [cached since 1267s ago] (1, 'completed', '2025-09-22 15:36:28.365306')
2025-10-22 16:36:28,368 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:28,368 INFO sqlalchemy.engine.Engine [cached since 1267s ago] (1,)
2025-10-22 16:36:28,368 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:28,377 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:58785 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:29,364 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:29,364 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:29,364 INFO sqlalchemy.engine.Engine [cached since 1271s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:29.359833')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:29,370 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:29,375 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:29,375 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:29,375 INFO sqlalchemy.engine.Engine [cached since 1271s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:29.375444')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:29,381 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:30,374 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:30,374 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:30,377 INFO sqlalchemy.engine.Engine [cached since 1272s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:30.369851')
2025-10-22 16:36:30,378 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:30,378 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:30,378 INFO sqlalchemy.engine.Engine [cached since 1272s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:30.369851')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:30,379 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:30,379 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:30,379 INFO sqlalchemy.engine.Engine [cached since 1272s ago] (1,)
2025-10-22 16:36:30,395 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:30,395 INFO sqlalchemy.engine.Engine [cached since 1269s ago] (1,)
INFO:     127.0.0.1:21502 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:30,402 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:31,380 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:31,380 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:31,380 INFO sqlalchemy.engine.Engine [cached since 1273s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:31.378245')
2025-10-22 16:36:31,386 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:31,386 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:31,386 INFO sqlalchemy.engine.Engine [cached since 1273s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:31.380771')
2025-10-22 16:36:31,393 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:31,393 INFO sqlalchemy.engine.Engine [cached since 1270s ago] (1, 'completed', '2025-09-22 15:36:31.386134')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:31,397 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:31,401 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21502 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:32,383 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:32,383 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:32,383 INFO sqlalchemy.engine.Engine [cached since 1274s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:32.381211')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:32,386 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:32,396 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:32,396 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:32,396 INFO sqlalchemy.engine.Engine [cached since 1274s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:32.391736')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:32,402 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:33,401 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:33,405 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:33,405 INFO sqlalchemy.engine.Engine [cached since 1275s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:33.397087')
2025-10-22 16:36:33,405 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:33,409 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:33,409 INFO sqlalchemy.engine.Engine [cached since 1275s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:33.399118')
2025-10-22 16:36:33,409 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:33,409 INFO sqlalchemy.engine.Engine [cached since 1275s ago] (1,)
2025-10-22 16:36:33,416 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:33,418 INFO sqlalchemy.engine.Engine [cached since 1272s ago] (1, 'completed', '2025-09-22 15:36:33.416295')
2025-10-22 16:36:33,420 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:33,420 INFO sqlalchemy.engine.Engine [cached since 1272s ago] (1,)
2025-10-22 16:36:33,424 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:14428 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:33,447 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:34,404 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:34,405 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:34,405 INFO sqlalchemy.engine.Engine [cached since 1276s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:34.402045')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:34,410 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:34,419 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:34,421 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:34,421 INFO sqlalchemy.engine.Engine [cached since 1276s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:34.417034')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:34,426 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:35,423 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:35,424 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:35,424 INFO sqlalchemy.engine.Engine [cached since 1277s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:35.412909')
2025-10-22 16:36:35,424 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:35,424 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:35,424 INFO sqlalchemy.engine.Engine [cached since 1277s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:35.419555')
2025-10-22 16:36:35,430 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:35,430 INFO sqlalchemy.engine.Engine [cached since 1277s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:35,430 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:35,438 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:35,438 INFO sqlalchemy.engine.Engine [cached since 1274s ago] (1,)
INFO:     127.0.0.1:61228 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:35,445 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:36,430 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:36,436 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:36,436 INFO sqlalchemy.engine.Engine [cached since 1278s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:36.430493')
2025-10-22 16:36:36,436 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:36,436 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:36,436 INFO sqlalchemy.engine.Engine [cached since 1278s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:36.430493')
2025-10-22 16:36:36,443 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:36,445 INFO sqlalchemy.engine.Engine [cached since 1275s ago] (1, 'completed', '2025-09-22 15:36:36.443471')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:36,448 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:36,451 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:61228 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:37,437 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:37,437 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:37,437 INFO sqlalchemy.engine.Engine [cached since 1279s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:37.425335')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:37,443 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:37,448 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:37,448 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:37,452 INFO sqlalchemy.engine.Engine [cached since 1279s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:37.448554')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:37,460 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:38,459 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:38,459 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:38,459 INFO sqlalchemy.engine.Engine [cached since 1280s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:38.457555')
2025-10-22 16:36:38,459 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:38,459 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:38,459 INFO sqlalchemy.engine.Engine [cached since 1280s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:38.446580')
2025-10-22 16:36:38,469 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:38,469 INFO sqlalchemy.engine.Engine [cached since 1277s ago] (1, 'completed', '2025-09-22 15:36:38.468584')
2025-10-22 16:36:38,474 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:38,474 INFO sqlalchemy.engine.Engine [cached since 1280s ago] (1,)
2025-10-22 16:36:38,478 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:38,478 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:38,478 INFO sqlalchemy.engine.Engine [cached since 1277s ago] (1,)
INFO:     127.0.0.1:54636 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:38,498 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:39,469 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:39,469 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:39,469 INFO sqlalchemy.engine.Engine [cached since 1281s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:39.462457')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:39,475 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:39,484 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:39,484 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:39,488 INFO sqlalchemy.engine.Engine [cached since 1281s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:39.480859')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:39,495 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:40,475 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:40,475 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:40,475 INFO sqlalchemy.engine.Engine [cached since 1282s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:40.469245')
2025-10-22 16:36:40,475 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:40,475 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:40,475 INFO sqlalchemy.engine.Engine [cached since 1282s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:40.475924')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:40,492 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:40,492 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:40,492 INFO sqlalchemy.engine.Engine [cached since 1282s ago] (1,)
2025-10-22 16:36:40,502 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:40,502 INFO sqlalchemy.engine.Engine [cached since 1279s ago] (1,)
INFO:     127.0.0.1:64769 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:40,507 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:41,482 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:41,482 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:41,487 INFO sqlalchemy.engine.Engine [cached since 1283s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:41.478417')
2025-10-22 16:36:41,487 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:41,487 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:41,490 INFO sqlalchemy.engine.Engine [cached since 1283s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:41.482155')
2025-10-22 16:36:41,494 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:41,494 INFO sqlalchemy.engine.Engine [cached since 1280s ago] (1, 'completed', '2025-09-22 15:36:41.494941')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:41,504 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:41,507 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:64769 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:42,502 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:42,502 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:42,502 INFO sqlalchemy.engine.Engine [cached since 1284s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:42.500082')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:42,509 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:42,513 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:42,518 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:42,519 INFO sqlalchemy.engine.Engine [cached since 1284s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:42.513526')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:42,526 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:43,526 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:43,529 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:43,529 INFO sqlalchemy.engine.Engine [cached since 1285s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:43.518247')
2025-10-22 16:36:43,529 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:43,529 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:43,529 INFO sqlalchemy.engine.Engine [cached since 1285s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:43.523754')
2025-10-22 16:36:43,536 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:43,536 INFO sqlalchemy.engine.Engine [cached since 1285s ago] (1,)
2025-10-22 16:36:43,540 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:43,540 INFO sqlalchemy.engine.Engine [cached since 1282s ago] (1, 'completed', '2025-09-22 15:36:43.540780')
2025-10-22 16:36:43,545 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:43,545 INFO sqlalchemy.engine.Engine [cached since 1282s ago] (1,)
2025-10-22 16:36:43,545 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:1794 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:43,569 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:44,529 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:44,529 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:44,529 INFO sqlalchemy.engine.Engine [cached since 1286s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:44.529365')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:44,543 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:44,548 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:44,548 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:44,548 INFO sqlalchemy.engine.Engine [cached since 1286s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:44.546285')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:44,558 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:45,554 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:45,554 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:45,554 INFO sqlalchemy.engine.Engine [cached since 1287s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:45.545573')
2025-10-22 16:36:45,556 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:45,557 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:45,557 INFO sqlalchemy.engine.Engine [cached since 1287s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:45.545573')
2025-10-22 16:36:45,559 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:45,559 INFO sqlalchemy.engine.Engine [cached since 1287s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:45,559 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:45,569 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:45,569 INFO sqlalchemy.engine.Engine [cached since 1284s ago] (1,)
INFO:     127.0.0.1:38896 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:45,576 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:46,563 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:46,563 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:46,563 INFO sqlalchemy.engine.Engine [cached since 1288s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:46.557868')
2025-10-22 16:36:46,575 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:46,575 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:46,575 INFO sqlalchemy.engine.Engine [cached since 1288s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:46.561409')
2025-10-22 16:36:46,584 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:46,584 INFO sqlalchemy.engine.Engine [cached since 1285s ago] (1, 'completed', '2025-09-22 15:36:46.575930')
2025-10-22 16:36:46,584 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:36:46,590 INFO sqlalchemy.engine.Engine [cached since 906s ago] (1,)
2025-10-22 16:36:46,594 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:38896 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:46,610 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:36:46,610 INFO sqlalchemy.engine.Engine [cached since 906s ago] (1, 20, 0)
INFO:     127.0.0.1:13410 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:46,618 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:47,567 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:47,567 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:47,568 INFO sqlalchemy.engine.Engine [cached since 1289s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:47.563913')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:47,574 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:47,583 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:47,583 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:47,584 INFO sqlalchemy.engine.Engine [cached since 1289s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:47.579080')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:47,591 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:48,582 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:48,584 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:48,584 INFO sqlalchemy.engine.Engine [cached since 1290s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:48.576181')
2025-10-22 16:36:48,585 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:48,585 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:48,585 INFO sqlalchemy.engine.Engine [cached since 1290s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:48.580707')
2025-10-22 16:36:48,592 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:48,594 INFO sqlalchemy.engine.Engine [cached since 1290s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:48,596 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:48,600 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:48,600 INFO sqlalchemy.engine.Engine [cached since 1287s ago] (1,)
INFO:     127.0.0.1:8969 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:48,606 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:49,583 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:49,583 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:49,583 INFO sqlalchemy.engine.Engine [cached since 1291s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:49.580821')
2025-10-22 16:36:49,590 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:49,590 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:49,590 INFO sqlalchemy.engine.Engine [cached since 1291s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:49.583589')
2025-10-22 16:36:49,598 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:49,598 INFO sqlalchemy.engine.Engine [cached since 1288s ago] (1, 'completed', '2025-09-22 15:36:49.595703')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:49,601 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:49,604 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:8969 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:50,594 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:50,594 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:50,594 INFO sqlalchemy.engine.Engine [cached since 1292s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:50.594816')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:50,608 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:50,611 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:50,611 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:50,611 INFO sqlalchemy.engine.Engine [cached since 1292s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:50.611035')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:50,624 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:51,601 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:51,601 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:51,601 INFO sqlalchemy.engine.Engine [cached since 1293s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:51.595437')
2025-10-22 16:36:51,604 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:51,606 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:51,606 INFO sqlalchemy.engine.Engine [cached since 1293s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:51.598886')
2025-10-22 16:36:51,609 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:51,609 INFO sqlalchemy.engine.Engine [cached since 1293s ago] (1,)
2025-10-22 16:36:51,609 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:51,609 INFO sqlalchemy.engine.Engine [cached since 1290s ago] (1, 'completed', '2025-09-22 15:36:51.609781')
2025-10-22 16:36:51,609 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:51,609 INFO sqlalchemy.engine.Engine [cached since 1290s ago] (1,)
2025-10-22 16:36:51,619 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:32262 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:51,637 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:52,615 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:52,615 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:52,615 INFO sqlalchemy.engine.Engine [cached since 1294s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:52.612356')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:52,624 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:52,631 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:52,631 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:52,631 INFO sqlalchemy.engine.Engine [cached since 1294s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:52.631388')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:52,640 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:53,619 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:53,619 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:53,619 INFO sqlalchemy.engine.Engine [cached since 1295s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:53.610721')
2025-10-22 16:36:53,619 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:53,619 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:53,619 INFO sqlalchemy.engine.Engine [cached since 1295s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:53.610721')
2025-10-22 16:36:53,625 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:53,625 INFO sqlalchemy.engine.Engine [cached since 1295s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:53,631 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:53,633 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:53,633 INFO sqlalchemy.engine.Engine [cached since 1292s ago] (1,)
INFO:     127.0.0.1:11662 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:53,643 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine [cached since 1296s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:54.624421')
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine [cached since 1296s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:54.619698')
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:54,625 INFO sqlalchemy.engine.Engine [cached since 1293s ago] (1, 'completed', '2025-09-22 15:36:54.625217')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:54,641 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:54,645 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:11662 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:36:55,624 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:55,624 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:55,624 INFO sqlalchemy.engine.Engine [cached since 1297s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:55.624528')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:36:55,638 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:55,646 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:55,646 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:55,646 INFO sqlalchemy.engine.Engine [cached since 1298s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:55.642786')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:55,652 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:56,639 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:56,640 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:56,640 INFO sqlalchemy.engine.Engine [cached since 1298s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:56.633105')
2025-10-22 16:36:56,641 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:56,642 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:56,642 INFO sqlalchemy.engine.Engine [cached since 1298s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:56.633105')
2025-10-22 16:36:56,649 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:56,649 INFO sqlalchemy.engine.Engine [cached since 1298s ago] (1,)
2025-10-22 16:36:56,651 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:56,651 INFO sqlalchemy.engine.Engine [cached since 1295s ago] (1, 'completed', '2025-09-22 15:36:56.651941')
2025-10-22 16:36:56,659 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:56,660 INFO sqlalchemy.engine.Engine [cached since 1295s ago] (1,)
2025-10-22 16:36:56,660 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52202 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:56,674 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:57,631 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:57,638 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:57,639 INFO sqlalchemy.engine.Engine [cached since 1299s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:57.631068')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:57,645 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:57,652 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:57,655 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:57,655 INFO sqlalchemy.engine.Engine [cached since 1300s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:57.650661')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:36:57,662 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:58,652 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:58,652 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:58,652 INFO sqlalchemy.engine.Engine [cached since 1301s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:58.645079')
2025-10-22 16:36:58,654 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:58,654 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:58,654 INFO sqlalchemy.engine.Engine [cached since 1301s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:58.649071')
2025-10-22 16:36:58,669 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:36:58,672 INFO sqlalchemy.engine.Engine [cached since 1301s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:36:58,677 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:58,679 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:36:58,679 INFO sqlalchemy.engine.Engine [cached since 1297s ago] (1,)
INFO:     127.0.0.1:2995 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:36:58,690 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:59,669 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:59,669 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:59,669 INFO sqlalchemy.engine.Engine [cached since 1302s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:59.664578')
2025-10-22 16:36:59,669 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:36:59,669 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:36:59,669 INFO sqlalchemy.engine.Engine [cached since 1302s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:36:59.660549')
2025-10-22 16:36:59,677 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:36:59,677 INFO sqlalchemy.engine.Engine [cached since 1298s ago] (1, 'completed', '2025-09-22 15:36:59.674266')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:36:59,680 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:36:59,680 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:2995 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:00,675 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:00,675 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:00,678 INFO sqlalchemy.engine.Engine [cached since 1303s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:00.675632')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:37:00,683 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:00,689 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:00,689 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:00,689 INFO sqlalchemy.engine.Engine [cached since 1303s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:00.689824')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:00,699 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:01,687 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:01,689 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:01,689 INFO sqlalchemy.engine.Engine [cached since 1304s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:01.679331')
2025-10-22 16:37:01,690 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:01,690 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:01,690 INFO sqlalchemy.engine.Engine [cached since 1304s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:01.682586')
2025-10-22 16:37:01,695 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:01,695 INFO sqlalchemy.engine.Engine [cached since 1304s ago] (1,)
2025-10-22 16:37:01,699 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:01,699 INFO sqlalchemy.engine.Engine [cached since 1300s ago] (1, 'completed', '2025-09-22 15:37:01.695518')
2025-10-22 16:37:01,705 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:01,705 INFO sqlalchemy.engine.Engine [cached since 1300s ago] (1,)
2025-10-22 16:37:01,706 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
INFO:     127.0.0.1:11831 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:01,725 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:02,689 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:02,691 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:02,691 INFO sqlalchemy.engine.Engine [cached since 1305s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:02.682517')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:02,695 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:02,704 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:02,707 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:02,707 INFO sqlalchemy.engine.Engine [cached since 1305s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:02.701833')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:37:02,711 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:03,702 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:03,704 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:03,706 INFO sqlalchemy.engine.Engine [cached since 1306s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:03.698217')
2025-10-22 16:37:03,707 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:03,708 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:03,708 INFO sqlalchemy.engine.Engine [cached since 1306s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:03.698999')
2025-10-22 16:37:03,709 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:03,709 INFO sqlalchemy.engine.Engine [cached since 1306s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:03,709 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:03,719 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:03,719 INFO sqlalchemy.engine.Engine [cached since 1302s ago] (1,)
INFO:     127.0.0.1:19664 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:03,726 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:04,730 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:04,731 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:04,731 INFO sqlalchemy.engine.Engine [cached since 1307s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:04.723501')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:04,735 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:04,747 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:04,749 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:04,749 INFO sqlalchemy.engine.Engine [cached since 1307s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:04.715979')
2025-10-22 16:37:04,752 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:04,752 INFO sqlalchemy.engine.Engine [cached since 1303s ago] (1, 'completed', '2025-09-22 15:37:04.752571')
2025-10-22 16:37:04,756 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:19664 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:05,719 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:05,719 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:05,719 INFO sqlalchemy.engine.Engine [cached since 1308s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:05.714018')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue?range=this_month HTTP/1.1" 200 OK
2025-10-22 16:37:05,728 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:05,733 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:05,733 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:05,733 INFO sqlalchemy.engine.Engine [cached since 1308s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:05.733049')
INFO:     127.0.0.1:13410 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:05,740 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:06,739 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:06,741 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:06,741 INFO sqlalchemy.engine.Engine [cached since 1309s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:06.730806')
2025-10-22 16:37:06,743 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:06,743 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:06,743 INFO sqlalchemy.engine.Engine [cached since 1309s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:06.736370')
2025-10-22 16:37:06,746 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:06,746 INFO sqlalchemy.engine.Engine [cached since 1309s ago] (1,)
2025-10-22 16:37:06,746 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:06,746 INFO sqlalchemy.engine.Engine [cached since 1305s ago] (1, 'completed', '2025-09-22 15:37:06.746317')
2025-10-22 16:37:06,755 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:06,755 INFO sqlalchemy.engine.Engine [cached since 1305s ago] (1,)
2025-10-22 16:37:06,756 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:39460 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:06,775 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:07,772 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:07,773 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:07,773 INFO sqlalchemy.engine.Engine [cached since 1310s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:07.769223')
2025-10-22 16:37:07,778 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:37:07,778 INFO sqlalchemy.engine.Engine [cached since 922.6s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:37:07,784 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:07,790 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:07,790 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:07,794 INFO sqlalchemy.engine.Engine [cached since 1310s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:07.790411')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:07,802 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:08,742 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:08,744 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:08,744 INFO sqlalchemy.engine.Engine [cached since 1311s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:08.741294')
2025-10-22 16:37:08,744 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:08,744 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:08,747 INFO sqlalchemy.engine.Engine [cached since 1311s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:08.739282')
INFO:     127.0.0.1:34104 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:08,757 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:08,760 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:09,745 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:09,745 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:09,745 INFO sqlalchemy.engine.Engine [cached since 1312s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:09.742963')
2025-10-22 16:37:09,745 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:09,750 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:09,750 INFO sqlalchemy.engine.Engine [cached since 1312s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:09.742963')
2025-10-22 16:37:09,756 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:09,756 INFO sqlalchemy.engine.Engine [cached since 1308s ago] (1, 'completed', '2025-09-22 15:37:09.751948')
2025-10-22 16:37:09,759 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:09,759 INFO sqlalchemy.engine.Engine [cached since 1312s ago] (1,)
2025-10-22 16:37:09,768 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:09,768 INFO sqlalchemy.engine.Engine [cached since 1308s ago] (1,)
2025-10-22 16:37:09,769 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:13410 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:09,774 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:34104 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:10,748 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:10,748 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:10,752 INFO sqlalchemy.engine.Engine [cached since 1313s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:10.748081')
2025-10-22 16:37:10,756 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:37:10,756 INFO sqlalchemy.engine.Engine [cached since 925.6s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:37:10,762 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:10,769 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:10,772 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:10,772 INFO sqlalchemy.engine.Engine [cached since 1313s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:10.763997')
2025-10-22 16:37:10,774 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:37:10,774 INFO sqlalchemy.engine.Engine [cached since 925.6s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:37:10,774 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:11,754 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:11,754 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:11,754 INFO sqlalchemy.engine.Engine [cached since 1314s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:11.754400')
2025-10-22 16:37:11,764 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:37:11,764 INFO sqlalchemy.engine.Engine [cached since 926.6s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:37:11,769 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:11,780 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:11,781 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:11,781 INFO sqlalchemy.engine.Engine [cached since 1314s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:11.774471')
INFO:     127.0.0.1:13410 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:11,785 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:12,774 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:12,774 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:12,774 INFO sqlalchemy.engine.Engine [cached since 1315s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:12.762697')
2025-10-22 16:37:12,775 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:12,776 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:12,776 INFO sqlalchemy.engine.Engine [cached since 1315s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:12.769777')
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:12,776 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:12,783 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:13,774 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:13,774 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:13,774 INFO sqlalchemy.engine.Engine [cached since 1316s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:13.774491')
2025-10-22 16:37:13,774 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:13,774 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:13,774 INFO sqlalchemy.engine.Engine [cached since 1316s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:13.774491')
2025-10-22 16:37:13,785 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:13,785 INFO sqlalchemy.engine.Engine [cached since 1312s ago] (1, 'completed', '2025-09-22 15:37:13.774491')
2025-10-22 16:37:13,791 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:13,791 INFO sqlalchemy.engine.Engine [cached since 1316s ago] (1,)
2025-10-22 16:37:13,795 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:13,798 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:13,799 INFO sqlalchemy.engine.Engine [cached since 1312s ago] (1,)
INFO:     127.0.0.1:13410 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:13,825 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:14,784 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:14,788 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:14,789 INFO sqlalchemy.engine.Engine [cached since 1317s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:14.784013')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:14,794 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:14,801 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:14,805 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:14,806 INFO sqlalchemy.engine.Engine [cached since 1317s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:14.799970')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:14,810 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:15,819 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:15,819 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:15,819 INFO sqlalchemy.engine.Engine [cached since 1318s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:15.794930')
2025-10-22 16:37:15,820 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:15,820 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:15,820 INFO sqlalchemy.engine.Engine [cached since 1318s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:15.794930')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:15,827 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:15,828 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:15,828 INFO sqlalchemy.engine.Engine [cached since 1318s ago] (1,)
2025-10-22 16:37:15,834 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:15,834 INFO sqlalchemy.engine.Engine [cached since 1315s ago] (1,)
INFO:     127.0.0.1:3182 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:15,834 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:16,819 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:16,821 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:16,821 INFO sqlalchemy.engine.Engine [cached since 1319s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:16.804490')
2025-10-22 16:37:16,821 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:16,824 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:16,824 INFO sqlalchemy.engine.Engine [cached since 1319s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:16.802301')
2025-10-22 16:37:16,829 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:16,829 INFO sqlalchemy.engine.Engine [cached since 1316s ago] (1, 'completed', '2025-09-22 15:37:16.826755')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:16,835 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:16,837 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:3182 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:17,813 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:17,815 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:17,815 INFO sqlalchemy.engine.Engine [cached since 1320s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:17.810386')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:17,824 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:17,830 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:17,830 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:17,830 INFO sqlalchemy.engine.Engine [cached since 1320s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:17.827605')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:17,842 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:18,828 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:18,828 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:18,828 INFO sqlalchemy.engine.Engine [cached since 1321s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:18.825139')
2025-10-22 16:37:18,828 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:18,828 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:18,828 INFO sqlalchemy.engine.Engine [cached since 1321s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:18.828922')
2025-10-22 16:37:18,834 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:18,834 INFO sqlalchemy.engine.Engine [cached since 1321s ago] (1,)
2025-10-22 16:37:18,851 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:18,851 INFO sqlalchemy.engine.Engine [cached since 1318s ago] (1, 'completed', '2025-09-22 15:37:18.850017')
2025-10-22 16:37:18,856 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:18,882 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:18,884 INFO sqlalchemy.engine.Engine [cached since 1318s ago] (1,)
INFO:     127.0.0.1:13489 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:18,910 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:19,832 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:19,832 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:19,832 INFO sqlalchemy.engine.Engine [cached since 1322s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:19.828020')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:19,839 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:19,845 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:19,847 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:19,847 INFO sqlalchemy.engine.Engine [cached since 1322s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:19.842843')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:19,851 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:20,832 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:20,838 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:20,838 INFO sqlalchemy.engine.Engine [cached since 1323s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:20.829172')
2025-10-22 16:37:20,838 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:20,840 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:20,840 INFO sqlalchemy.engine.Engine [cached since 1323s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:20.832918')
2025-10-22 16:37:20,845 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:20,845 INFO sqlalchemy.engine.Engine [cached since 1323s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:20,852 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:20,857 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:20,857 INFO sqlalchemy.engine.Engine [cached since 1320s ago] (1,)
INFO:     127.0.0.1:58322 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:20,861 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:21,841 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:21,841 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:21,843 INFO sqlalchemy.engine.Engine [cached since 1324s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:21.839579')
2025-10-22 16:37:21,843 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:21,843 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:21,843 INFO sqlalchemy.engine.Engine [cached since 1324s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:21.830509')
2025-10-22 16:37:21,845 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:21,845 INFO sqlalchemy.engine.Engine [cached since 1321s ago] (1, 'completed', '2025-09-22 15:37:21.845411')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:21,856 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:21,860 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:58322 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:22,846 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:22,846 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:22,846 INFO sqlalchemy.engine.Engine [cached since 1325s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:22.844860')
2025-10-22 16:37:22,854 INFO sqlalchemy.engine.Engine SELECT users.id, users.name, users.email, users.hashed_password, users.is_active, users.is_verified, users.mfa_enabled, users.mfa_secret, users.role, users.country, users.currency, users.created_at, users.updated_at, users.last_login, users.username, users.avatar, users.user_type 
FROM users 
WHERE users.email = ?
2025-10-22 16:37:22,856 INFO sqlalchemy.engine.Engine [cached since 1325s ago] ('admin@example.com',)
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:22,860 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:22,860 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:22,869 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:22,869 INFO sqlalchemy.engine.Engine [cached since 1325s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:22.860741')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:22,874 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:23,874 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:23,874 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:23,874 INFO sqlalchemy.engine.Engine [cached since 1326s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:23.844750')
2025-10-22 16:37:23,874 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:23,874 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:23,874 INFO sqlalchemy.engine.Engine [cached since 1326s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:23.851995')
2025-10-22 16:37:23,879 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:23,879 INFO sqlalchemy.engine.Engine [cached since 1326s ago] (1,)
2025-10-22 16:37:23,879 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:23,889 INFO sqlalchemy.engine.Engine [cached since 1323s ago] (1, 'completed', '2025-09-22 15:37:23.879397')
2025-10-22 16:37:23,910 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:23,910 INFO sqlalchemy.engine.Engine [cached since 1323s ago] (1,)
2025-10-22 16:37:23,915 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:34102 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:23,939 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:24,867 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:24,868 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:24,868 INFO sqlalchemy.engine.Engine [cached since 1327s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:24.864935')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:24,877 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:24,886 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:24,888 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:24,888 INFO sqlalchemy.engine.Engine [cached since 1327s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:24.883084')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:24,895 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:25,876 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:25,876 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:25,876 INFO sqlalchemy.engine.Engine [cached since 1328s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:25.874157')
2025-10-22 16:37:25,876 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:25,881 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:25,882 INFO sqlalchemy.engine.Engine [cached since 1328s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:25.876691')
2025-10-22 16:37:25,889 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:25,889 INFO sqlalchemy.engine.Engine [cached since 1328s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:25,896 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:25,898 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:25,898 INFO sqlalchemy.engine.Engine [cached since 1325s ago] (1,)
INFO:     127.0.0.1:16577 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:25,905 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:26,879 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:26,879 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:26,879 INFO sqlalchemy.engine.Engine [cached since 1329s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:26.874245')
2025-10-22 16:37:26,885 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:26,885 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:26,885 INFO sqlalchemy.engine.Engine [cached since 1329s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:26.879224')
2025-10-22 16:37:26,889 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:26,889 INFO sqlalchemy.engine.Engine [cached since 1326s ago] (1, 'completed', '2025-09-22 15:37:26.889459')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:26,898 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:26,902 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:16577 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:27,894 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:27,894 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:27,894 INFO sqlalchemy.engine.Engine [cached since 1330s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:27.892762')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:27,905 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:27,911 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:27,911 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:27,911 INFO sqlalchemy.engine.Engine [cached since 1330s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:27.909762')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:27,918 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:28,902 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:28,905 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:28,905 INFO sqlalchemy.engine.Engine [cached since 1331s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:28.895632')
2025-10-22 16:37:28,905 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:28,905 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:28,905 INFO sqlalchemy.engine.Engine [cached since 1331s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:28.895632')
2025-10-22 16:37:28,911 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:28,911 INFO sqlalchemy.engine.Engine [cached since 1328s ago] (1, 'completed', '2025-09-22 15:37:28.910798')
2025-10-22 16:37:28,911 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:28,911 INFO sqlalchemy.engine.Engine [cached since 1331s ago] (1,)
2025-10-22 16:37:28,919 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:28,922 INFO sqlalchemy.engine.Engine [cached since 1328s ago] (1,)
2025-10-22 16:37:28,922 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:24510 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:28,944 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:29,909 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:29,909 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:29,909 INFO sqlalchemy.engine.Engine [cached since 1332s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:29.909707')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:29,923 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:29,925 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:29,933 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:29,933 INFO sqlalchemy.engine.Engine [cached since 1332s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:29.925174')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:29,938 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:30,915 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:30,915 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:30,918 INFO sqlalchemy.engine.Engine [cached since 1333s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:30.911788')
2025-10-22 16:37:30,918 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:30,919 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:30,919 INFO sqlalchemy.engine.Engine [cached since 1333s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:30.909718')
2025-10-22 16:37:30,925 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:30,925 INFO sqlalchemy.engine.Engine [cached since 1333s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:30,932 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:30,936 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:30,936 INFO sqlalchemy.engine.Engine [cached since 1330s ago] (1,)
INFO:     127.0.0.1:42444 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:30,944 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:31,924 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:31,924 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:31,924 INFO sqlalchemy.engine.Engine [cached since 1334s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:31.922613')
2025-10-22 16:37:31,924 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:31,924 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:31,924 INFO sqlalchemy.engine.Engine [cached since 1334s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:31.919862')
2025-10-22 16:37:31,938 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:31,940 INFO sqlalchemy.engine.Engine [cached since 1331s ago] (1, 'completed', '2025-09-22 15:37:31.930164')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:31,940 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:31,945 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:42444 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:32,933 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:32,938 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:32,939 INFO sqlalchemy.engine.Engine [cached since 1335s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:32.933897')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:32,945 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:32,952 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:32,952 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:32,952 INFO sqlalchemy.engine.Engine [cached since 1335s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:32.949729')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:32,960 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:33,942 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:33,942 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:33,945 INFO sqlalchemy.engine.Engine [cached since 1336s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:33.938515')
2025-10-22 16:37:33,945 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:33,945 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:33,945 INFO sqlalchemy.engine.Engine [cached since 1336s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:33.939556')
2025-10-22 16:37:33,960 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:33,960 INFO sqlalchemy.engine.Engine [cached since 1336s ago] (1,)
2025-10-22 16:37:33,971 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:33,973 INFO sqlalchemy.engine.Engine [cached since 1333s ago] (1, 'completed', '2025-09-22 15:37:33.968650')
2025-10-22 16:37:33,976 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:33,976 INFO sqlalchemy.engine.Engine [cached since 1333s ago] (1,)
2025-10-22 16:37:33,988 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:33,993 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:32971 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:34,947 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:34,947 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:34,947 INFO sqlalchemy.engine.Engine [cached since 1337s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:34.945726')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:34,959 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:34,968 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:34,969 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:34,969 INFO sqlalchemy.engine.Engine [cached since 1337s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:34.959707')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:34,974 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:35,969 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:35,971 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:35,971 INFO sqlalchemy.engine.Engine [cached since 1338s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:35.961966')
2025-10-22 16:37:35,972 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:35,972 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:35,972 INFO sqlalchemy.engine.Engine [cached since 1338s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:35.965345')
2025-10-22 16:37:35,974 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:35,974 INFO sqlalchemy.engine.Engine [cached since 1338s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:35,974 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:35,985 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:35,985 INFO sqlalchemy.engine.Engine [cached since 1335s ago] (1,)
INFO:     127.0.0.1:10401 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:35,987 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:36,976 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:36,976 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:36,976 INFO sqlalchemy.engine.Engine [cached since 1339s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:36.974537')
2025-10-22 16:37:36,976 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:36,979 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:36,979 INFO sqlalchemy.engine.Engine [cached since 1339s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:36.971205')
2025-10-22 16:37:36,988 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:36,988 INFO sqlalchemy.engine.Engine [cached since 1336s ago] (1, 'completed', '2025-09-22 15:37:36.979918')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:36,994 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:36,996 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:10401 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:37,977 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:37,977 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:37,977 INFO sqlalchemy.engine.Engine [cached since 1340s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:37.977028')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:37,989 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:37,994 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:37,994 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:37,994 INFO sqlalchemy.engine.Engine [cached since 1340s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:37.994998')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:38,004 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:38,988 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:38,988 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:38,988 INFO sqlalchemy.engine.Engine [cached since 1341s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:38.981549')
2025-10-22 16:37:38,988 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:38,988 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:38,988 INFO sqlalchemy.engine.Engine [cached since 1341s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:38.985683')
2025-10-22 16:37:38,995 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:38,995 INFO sqlalchemy.engine.Engine [cached since 1341s ago] (1,)
2025-10-22 16:37:39,000 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:39,002 INFO sqlalchemy.engine.Engine [cached since 1338s ago] (1, 'completed', '2025-09-22 15:37:38.995301')
2025-10-22 16:37:39,007 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:39,007 INFO sqlalchemy.engine.Engine [cached since 1338s ago] (1,)
2025-10-22 16:37:39,010 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:42753 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:39,028 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:39,992 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:39,992 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:39,992 INFO sqlalchemy.engine.Engine [cached since 1342s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:39.990756')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:39,999 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:40,006 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:40,008 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:40,008 INFO sqlalchemy.engine.Engine [cached since 1342s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:40.004555')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:40,015 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:40,999 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:41,001 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:41,001 INFO sqlalchemy.engine.Engine [cached since 1343s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:40.989269')
2025-10-22 16:37:41,004 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:41,004 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:41,004 INFO sqlalchemy.engine.Engine [cached since 1343s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:40.995160')
2025-10-22 16:37:41,010 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:41,010 INFO sqlalchemy.engine.Engine [cached since 1343s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:41,015 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:41,018 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:41,018 INFO sqlalchemy.engine.Engine [cached since 1340s ago] (1,)
INFO:     127.0.0.1:22655 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:41,026 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:42,001 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:42,004 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:42,004 INFO sqlalchemy.engine.Engine [cached since 1344s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:41.995173')
2025-10-22 16:37:42,004 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:42,004 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:42,004 INFO sqlalchemy.engine.Engine [cached since 1344s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:41.995173')
2025-10-22 16:37:42,004 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:42,010 INFO sqlalchemy.engine.Engine [cached since 1341s ago] (1, 'completed', '2025-09-22 15:37:42.004814')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:42,016 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:42,018 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:22655 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:43,010 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:43,010 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:43,010 INFO sqlalchemy.engine.Engine [cached since 1345s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:43.009006')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:43,018 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:43,024 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:43,024 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:43,024 INFO sqlalchemy.engine.Engine [cached since 1345s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:43.024173')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:43,032 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:44,018 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:44,019 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:44,021 INFO sqlalchemy.engine.Engine [cached since 1346s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:44.013830')
2025-10-22 16:37:44,021 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:44,021 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:44,021 INFO sqlalchemy.engine.Engine [cached since 1346s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:44.009615')
2025-10-22 16:37:44,024 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:44,024 INFO sqlalchemy.engine.Engine [cached since 1346s ago] (1,)
2025-10-22 16:37:44,028 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:44,030 INFO sqlalchemy.engine.Engine [cached since 1343s ago] (1, 'completed', '2025-09-22 15:37:44.028292')
2025-10-22 16:37:44,047 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:44,047 INFO sqlalchemy.engine.Engine [cached since 1343s ago] (1,)
2025-10-22 16:37:44,047 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:36021 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:44,074 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:45,009 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:45,009 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:45,009 INFO sqlalchemy.engine.Engine [cached since 1347s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:45.009932')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:45,024 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:45,028 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:45,028 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:45,028 INFO sqlalchemy.engine.Engine [cached since 1347s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:45.028502')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:45,038 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:46,044 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:46,044 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:46,044 INFO sqlalchemy.engine.Engine [cached since 1348s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:46.017020')
2025-10-22 16:37:46,044 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:46,047 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:46,047 INFO sqlalchemy.engine.Engine [cached since 1348s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:46.021429')
2025-10-22 16:37:46,060 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:46,060 INFO sqlalchemy.engine.Engine [cached since 1348s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:46,070 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:46,075 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:46,075 INFO sqlalchemy.engine.Engine [cached since 1345s ago] (1,)
INFO:     127.0.0.1:36145 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:46,075 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:47,024 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:47,024 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:47,024 INFO sqlalchemy.engine.Engine [cached since 1349s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:47.024525')
2025-10-22 16:37:47,036 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:47,038 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:47,038 INFO sqlalchemy.engine.Engine [cached since 1349s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:47.024525')
2025-10-22 16:37:47,038 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:47,038 INFO sqlalchemy.engine.Engine [cached since 1346s ago] (1, 'completed', '2025-09-22 15:37:47.038148')
2025-10-22 16:37:47,045 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:37:47,045 INFO sqlalchemy.engine.Engine [cached since 966.4s ago] (1,)
2025-10-22 16:37:47,051 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:47,055 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:37:47,055 INFO sqlalchemy.engine.Engine [cached since 966.4s ago] (1, 20, 0)
INFO:     127.0.0.1:36145 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:47,074 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:48,030 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:48,032 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:48,032 INFO sqlalchemy.engine.Engine [cached since 1350s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:48.027627')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:48,041 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:48,051 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:48,054 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:48,054 INFO sqlalchemy.engine.Engine [cached since 1350s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:48.047823')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:48,059 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:49,040 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:49,040 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:49,042 INFO sqlalchemy.engine.Engine [cached since 1351s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:49.029032')
2025-10-22 16:37:49,042 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:49,043 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:49,043 INFO sqlalchemy.engine.Engine [cached since 1351s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:49.037480')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:49,044 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:49,054 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:49,054 INFO sqlalchemy.engine.Engine [cached since 1351s ago] (1,)
2025-10-22 16:37:49,059 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:49,059 INFO sqlalchemy.engine.Engine [cached since 1348s ago] (1,)
INFO:     127.0.0.1:55178 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:49,064 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:50,055 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:50,059 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:50,059 INFO sqlalchemy.engine.Engine [cached since 1352s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:50.040264')
2025-10-22 16:37:50,059 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:50,059 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:50,059 INFO sqlalchemy.engine.Engine [cached since 1352s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:50.040264')
2025-10-22 16:37:50,071 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:50,071 INFO sqlalchemy.engine.Engine [cached since 1349s ago] (1, 'completed', '2025-09-22 15:37:50.068394')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:50,074 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:50,074 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:55178 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:51,045 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:51,045 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:51,045 INFO sqlalchemy.engine.Engine [cached since 1353s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:51.045188')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:51,055 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:51,061 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:51,061 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:51,064 INFO sqlalchemy.engine.Engine [cached since 1353s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:51.059634')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:51,071 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:52,061 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:52,061 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:52,061 INFO sqlalchemy.engine.Engine [cached since 1354s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:52.059522')
2025-10-22 16:37:52,065 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:52,065 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:52,065 INFO sqlalchemy.engine.Engine [cached since 1354s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:52.056202')
2025-10-22 16:37:52,070 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:52,074 INFO sqlalchemy.engine.Engine [cached since 1351s ago] (1, 'completed', '2025-09-22 15:37:52.070847')
2025-10-22 16:37:52,074 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:52,074 INFO sqlalchemy.engine.Engine [cached since 1354s ago] (1,)
2025-10-22 16:37:52,074 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:52,074 INFO sqlalchemy.engine.Engine [cached since 1351s ago] (1,)
2025-10-22 16:37:52,081 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:52800 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:52,104 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:53,074 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:53,074 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:53,074 INFO sqlalchemy.engine.Engine [cached since 1355s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:53.073675')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:53,078 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:53,087 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:53,087 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:53,089 INFO sqlalchemy.engine.Engine [cached since 1355s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:53.083512')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:53,091 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:54,070 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:54,070 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:54,070 INFO sqlalchemy.engine.Engine [cached since 1356s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:54.062469')
2025-10-22 16:37:54,070 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:54,072 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:54,072 INFO sqlalchemy.engine.Engine [cached since 1356s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:54.062469')
2025-10-22 16:37:54,093 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:54,093 INFO sqlalchemy.engine.Engine [cached since 1356s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:54,097 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:54,103 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:54,104 INFO sqlalchemy.engine.Engine [cached since 1353s ago] (1,)
INFO:     127.0.0.1:56201 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:54,124 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:55,084 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:55,084 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:55,084 INFO sqlalchemy.engine.Engine [cached since 1357s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:55.067264')
2025-10-22 16:37:55,087 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:55,089 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:55,089 INFO sqlalchemy.engine.Engine [cached since 1357s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:55.076923')
2025-10-22 16:37:55,098 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:55,098 INFO sqlalchemy.engine.Engine [cached since 1354s ago] (1, 'completed', '2025-09-22 15:37:55.094930')
2025-10-22 16:37:55,112 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:55,123 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:56201 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:37:56,073 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:56,074 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:56,074 INFO sqlalchemy.engine.Engine [cached since 1358s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:56.070497')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:56,079 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:56,087 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:56,087 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:56,087 INFO sqlalchemy.engine.Engine [cached since 1358s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:56.084790')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:56,095 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:57,087 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:57,087 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:57,087 INFO sqlalchemy.engine.Engine [cached since 1359s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:57.075058')
2025-10-22 16:37:57,089 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:57,091 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:57,091 INFO sqlalchemy.engine.Engine [cached since 1359s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:57.082239')
2025-10-22 16:37:57,095 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:57,095 INFO sqlalchemy.engine.Engine [cached since 1359s ago] (1,)
2025-10-22 16:37:57,099 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:37:57,099 INFO sqlalchemy.engine.Engine [cached since 1356s ago] (1, 'completed', '2025-09-22 15:37:57.095012')
2025-10-22 16:37:57,105 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:57,105 INFO sqlalchemy.engine.Engine [cached since 1356s ago] (1,)
2025-10-22 16:37:57,105 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:56889 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:57,125 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:58,087 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:58,088 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:58,088 INFO sqlalchemy.engine.Engine [cached since 1360s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:58.081983')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:37:58,089 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:58,097 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:58,097 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:58,102 INFO sqlalchemy.engine.Engine [cached since 1360s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:58.097114')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:37:58,109 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:59,090 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:59,090 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:59,090 INFO sqlalchemy.engine.Engine [cached since 1361s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:59.083805')
2025-10-22 16:37:59,092 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:37:59,092 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:37:59,092 INFO sqlalchemy.engine.Engine [cached since 1361s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:37:59.088822')
2025-10-22 16:37:59,098 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:37:59,098 INFO sqlalchemy.engine.Engine [cached since 1361s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:37:59,105 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:37:59,107 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:37:59,107 INFO sqlalchemy.engine.Engine [cached since 1358s ago] (1,)
INFO:     127.0.0.1:50228 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:37:59,112 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:00,099 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:00,102 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:00,103 INFO sqlalchemy.engine.Engine [cached since 1362s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:00.093848')
2025-10-22 16:38:00,104 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:00,104 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:00,104 INFO sqlalchemy.engine.Engine [cached since 1362s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:00.097185')
2025-10-22 16:38:00,109 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:00,109 INFO sqlalchemy.engine.Engine [cached since 1359s ago] (1, 'completed', '2025-09-22 15:38:00.104390')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:00,113 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:00,118 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:50228 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:01,092 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:01,092 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:01,092 INFO sqlalchemy.engine.Engine [cached since 1363s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:01.092395')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:01,104 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:01,109 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:01,109 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:01,109 INFO sqlalchemy.engine.Engine [cached since 1363s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:01.108525')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:01,120 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:02,114 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:02,117 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:02,119 INFO sqlalchemy.engine.Engine [cached since 1364s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:02.111609')
2025-10-22 16:38:02,120 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:02,121 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:02,121 INFO sqlalchemy.engine.Engine [cached since 1364s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:02.111609')
2025-10-22 16:38:02,124 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:02,124 INFO sqlalchemy.engine.Engine [cached since 1364s ago] (1,)
2025-10-22 16:38:02,128 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:02,128 INFO sqlalchemy.engine.Engine [cached since 1361s ago] (1, 'completed', '2025-09-22 15:38:02.124313')
2025-10-22 16:38:02,134 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:02,137 INFO sqlalchemy.engine.Engine [cached since 1361s ago] (1,)
2025-10-22 16:38:02,137 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:21782 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:02,157 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:03,116 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:03,116 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:03,116 INFO sqlalchemy.engine.Engine [cached since 1365s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:03.113453')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:03,124 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:03,131 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:03,134 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:03,134 INFO sqlalchemy.engine.Engine [cached since 1365s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:03.124200')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:03,140 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:04,133 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:04,136 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:04,137 INFO sqlalchemy.engine.Engine [cached since 1366s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:04.128954')
2025-10-22 16:38:04,137 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:04,137 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:04,138 INFO sqlalchemy.engine.Engine [cached since 1366s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:04.128954')
2025-10-22 16:38:04,143 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:04,143 INFO sqlalchemy.engine.Engine [cached since 1366s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:04,144 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:04,153 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:04,156 INFO sqlalchemy.engine.Engine [cached since 1363s ago] (1,)
INFO:     127.0.0.1:16627 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:04,161 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:05,137 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:05,137 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:05,137 INFO sqlalchemy.engine.Engine [cached since 1367s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:05.130488')
2025-10-22 16:38:05,139 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:05,141 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:05,141 INFO sqlalchemy.engine.Engine [cached since 1367s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:05.130488')
2025-10-22 16:38:05,145 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:05,145 INFO sqlalchemy.engine.Engine [cached since 1364s ago] (1, 'completed', '2025-09-22 15:38:05.143472')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:05,154 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:05,157 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:16627 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:06,144 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:06,144 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:06,144 INFO sqlalchemy.engine.Engine [cached since 1368s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:06.142469')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:06,154 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:06,163 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:06,163 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:06,163 INFO sqlalchemy.engine.Engine [cached since 1368s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:06.159778')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:06,173 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:07,153 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:07,154 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:07,154 INFO sqlalchemy.engine.Engine [cached since 1369s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:07.145890')
2025-10-22 16:38:07,154 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:07,156 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:07,156 INFO sqlalchemy.engine.Engine [cached since 1369s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:07.145890')
2025-10-22 16:38:07,160 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:07,160 INFO sqlalchemy.engine.Engine [cached since 1369s ago] (1,)
2025-10-22 16:38:07,165 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:07,165 INFO sqlalchemy.engine.Engine [cached since 1366s ago] (1, 'completed', '2025-09-22 15:38:07.160846')
2025-10-22 16:38:07,171 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:07,171 INFO sqlalchemy.engine.Engine [cached since 1366s ago] (1,)
2025-10-22 16:38:07,174 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29715 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:07,195 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:08,146 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:08,146 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:08,146 INFO sqlalchemy.engine.Engine [cached since 1370s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:08.144602')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:08,154 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:08,164 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:08,164 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:08,164 INFO sqlalchemy.engine.Engine [cached since 1370s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:08.162991')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:08,171 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:09,166 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:09,168 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:09,171 INFO sqlalchemy.engine.Engine [cached since 1371s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:09.159718')
2025-10-22 16:38:09,171 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:09,171 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:09,173 INFO sqlalchemy.engine.Engine [cached since 1371s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:09.163934')
2025-10-22 16:38:09,175 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:09,175 INFO sqlalchemy.engine.Engine [cached since 1371s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:09,182 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:09,189 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:09,189 INFO sqlalchemy.engine.Engine [cached since 1368s ago] (1,)
INFO:     127.0.0.1:32539 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:09,195 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:10,169 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:10,169 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:10,169 INFO sqlalchemy.engine.Engine [cached since 1372s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:10.162026')
2025-10-22 16:38:10,185 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:10,185 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:10,185 INFO sqlalchemy.engine.Engine [cached since 1372s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:10.164042')
2025-10-22 16:38:10,190 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:10,190 INFO sqlalchemy.engine.Engine [cached since 1369s ago] (1, 'completed', '2025-09-22 15:38:10.190107')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:10,197 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:10,208 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:32539 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:11,174 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:11,176 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:11,176 INFO sqlalchemy.engine.Engine [cached since 1373s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:11.170890')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:11,176 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:11,190 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:11,192 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:11,192 INFO sqlalchemy.engine.Engine [cached since 1373s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:11.188542')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:11,196 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:12,181 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:12,186 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:12,186 INFO sqlalchemy.engine.Engine [cached since 1374s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:12.177422')
2025-10-22 16:38:12,186 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:12,186 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:12,186 INFO sqlalchemy.engine.Engine [cached since 1374s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:12.179443')
2025-10-22 16:38:12,186 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:12,195 INFO sqlalchemy.engine.Engine [cached since 1371s ago] (1, 'completed', '2025-09-22 15:38:12.186689')
2025-10-22 16:38:12,196 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:12,196 INFO sqlalchemy.engine.Engine [cached since 1374s ago] (1,)
2025-10-22 16:38:12,204 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:12,204 INFO sqlalchemy.engine.Engine [cached since 1371s ago] (1,)
2025-10-22 16:38:12,204 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:44166 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:12,225 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:13,192 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:13,192 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:13,192 INFO sqlalchemy.engine.Engine [cached since 1375s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:13.188604')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:13,205 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:13,210 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:13,210 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:13,210 INFO sqlalchemy.engine.Engine [cached since 1375s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:13.210928')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:13,222 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:14,202 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:14,203 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:14,204 INFO sqlalchemy.engine.Engine [cached since 1376s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:14.190158')
2025-10-22 16:38:14,204 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:14,204 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:14,204 INFO sqlalchemy.engine.Engine [cached since 1376s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:14.195084')
2025-10-22 16:38:14,211 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:14,211 INFO sqlalchemy.engine.Engine [cached since 1376s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:14,211 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:14,220 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:14,220 INFO sqlalchemy.engine.Engine [cached since 1373s ago] (1,)
INFO:     127.0.0.1:57819 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:14,224 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:15,207 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:15,209 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:15,209 INFO sqlalchemy.engine.Engine [cached since 1377s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:15.199768')
2025-10-22 16:38:15,209 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:15,209 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:15,209 INFO sqlalchemy.engine.Engine [cached since 1377s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:15.204520')
2025-10-22 16:38:15,209 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:15,218 INFO sqlalchemy.engine.Engine [cached since 1374s ago] (1, 'completed', '2025-09-22 15:38:15.209393')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:15,224 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:15,228 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:57819 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:16,212 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:16,219 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:16,219 INFO sqlalchemy.engine.Engine [cached since 1378s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:16.212619')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:16,224 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:16,234 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:16,234 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:16,234 INFO sqlalchemy.engine.Engine [cached since 1378s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:16.228962')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:16,234 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:17,224 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:17,224 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:17,224 INFO sqlalchemy.engine.Engine [cached since 1379s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:17.218811')
2025-10-22 16:38:17,224 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:17,229 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:17,229 INFO sqlalchemy.engine.Engine [cached since 1379s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:17.223597')
2025-10-22 16:38:17,234 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:17,236 INFO sqlalchemy.engine.Engine [cached since 1379s ago] (1,)
2025-10-22 16:38:17,238 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:17,238 INFO sqlalchemy.engine.Engine [cached since 1376s ago] (1, 'completed', '2025-09-22 15:38:17.238261')
2025-10-22 16:38:17,238 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:17,245 INFO sqlalchemy.engine.Engine [cached since 1376s ago] (1,)
2025-10-22 16:38:17,245 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:16370 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:17,272 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:18,224 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:18,224 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:18,224 INFO sqlalchemy.engine.Engine [cached since 1380s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:18.219062')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:18,232 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:18,236 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:18,236 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:18,236 INFO sqlalchemy.engine.Engine [cached since 1380s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:18.236652')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:18,247 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:19,246 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:19,257 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:19,257 INFO sqlalchemy.engine.Engine [cached since 1381s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:19.225430')
2025-10-22 16:38:19,257 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:19,257 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:19,259 INFO sqlalchemy.engine.Engine [cached since 1381s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:19.225430')
2025-10-22 16:38:19,266 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:19,266 INFO sqlalchemy.engine.Engine [cached since 1381s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:19,273 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:19,274 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:19,274 INFO sqlalchemy.engine.Engine [cached since 1378s ago] (1,)
INFO:     127.0.0.1:19437 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:19,278 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:20,246 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:20,246 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:20,249 INFO sqlalchemy.engine.Engine [cached since 1382s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:20.238695')
2025-10-22 16:38:20,249 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:20,249 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:20,251 INFO sqlalchemy.engine.Engine [cached since 1382s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:20.243277')
2025-10-22 16:38:20,265 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:20,265 INFO sqlalchemy.engine.Engine [cached since 1379s ago] (1, 'completed', '2025-09-22 15:38:20.262414')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:20,272 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:20,275 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:19437 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:21,252 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:21,253 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:21,253 INFO sqlalchemy.engine.Engine [cached since 1383s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:21.247892')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:21,261 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:21,273 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:21,274 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:21,274 INFO sqlalchemy.engine.Engine [cached since 1383s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:21.269411')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:21,280 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:22,270 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:22,270 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:22,270 INFO sqlalchemy.engine.Engine [cached since 1384s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:22.260432')
2025-10-22 16:38:22,270 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:22,270 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:22,274 INFO sqlalchemy.engine.Engine [cached since 1384s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:22.262476')
2025-10-22 16:38:22,274 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:22,274 INFO sqlalchemy.engine.Engine [cached since 1384s ago] (1,)
2025-10-22 16:38:22,285 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:22,286 INFO sqlalchemy.engine.Engine [cached since 1381s ago] (1, 'completed', '2025-09-22 15:38:22.281568')
2025-10-22 16:38:22,289 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:22,289 INFO sqlalchemy.engine.Engine [cached since 1381s ago] (1,)
2025-10-22 16:38:22,312 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:51597 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:22,339 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:23,262 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:23,262 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:23,262 INFO sqlalchemy.engine.Engine [cached since 1385s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:23.262343')
2025-10-22 16:38:23,268 INFO sqlalchemy.engine.Engine SELECT paywalls.id 
FROM paywalls 
WHERE paywalls.owner_id = ?
2025-10-22 16:38:23,268 INFO sqlalchemy.engine.Engine [cached since 1003s ago] (1,)
2025-10-22 16:38:23,274 INFO sqlalchemy.engine.Engine SELECT paywalls.id, paywalls.title, paywalls.description, paywalls.content_ids, paywalls.price, paywalls.currency, paywalls.duration, paywalls.status, paywalls.success_redirect_url, paywalls.cancel_redirect_url, paywalls.webhook_url, paywalls.views, paywalls.conversions, paywalls.owner_id, paywalls.created_at, paywalls.updated_at 
FROM paywalls 
WHERE paywalls.owner_id = ? ORDER BY paywalls.created_at DESC
 LIMIT ? OFFSET ?
2025-10-22 16:38:23,274 INFO sqlalchemy.engine.Engine [cached since 1003s ago] (1, 20, 0)
INFO:     127.0.0.1:29570 - "GET /api/paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:23,282 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:23,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:23,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:23,295 INFO sqlalchemy.engine.Engine [cached since 1385s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:23.291259')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:23,301 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:24,278 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:24,278 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:24,278 INFO sqlalchemy.engine.Engine [cached since 1386s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:24.272857')
2025-10-22 16:38:24,278 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:24,278 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:24,278 INFO sqlalchemy.engine.Engine [cached since 1386s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:24.271350')
INFO:     127.0.0.1:35016 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:24,289 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:24,289 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:25,311 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:25,313 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:25,313 INFO sqlalchemy.engine.Engine [cached since 1387s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:25.287967')
2025-10-22 16:38:25,313 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:25,315 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:25,315 INFO sqlalchemy.engine.Engine [cached since 1387s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:25.285442')
2025-10-22 16:38:25,321 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:25,321 INFO sqlalchemy.engine.Engine [cached since 1384s ago] (1, 'completed', '2025-09-22 15:38:25.319824')
2025-10-22 16:38:25,324 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:25,324 INFO sqlalchemy.engine.Engine [cached since 1387s ago] (1,)
2025-10-22 16:38:25,327 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:25,327 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:25,333 INFO sqlalchemy.engine.Engine [cached since 1384s ago] (1,)
INFO:     127.0.0.1:35016 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:25,354 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:26,294 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:26,294 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:26,294 INFO sqlalchemy.engine.Engine [cached since 1388s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:26.291607')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:26,303 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:26,309 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:26,310 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:26,310 INFO sqlalchemy.engine.Engine [cached since 1388s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:26.306823')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:26,315 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:27,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:27,304 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:27,304 INFO sqlalchemy.engine.Engine [cached since 1389s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:27.304344')
2025-10-22 16:38:27,304 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:27,308 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:27,308 INFO sqlalchemy.engine.Engine [cached since 1389s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:27.302311')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:27,312 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:27,319 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:27,319 INFO sqlalchemy.engine.Engine [cached since 1389s ago] (1,)
2025-10-22 16:38:27,327 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:27,327 INFO sqlalchemy.engine.Engine [cached since 1386s ago] (1,)
INFO:     127.0.0.1:63953 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:27,335 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:28,324 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:28,326 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:28,326 INFO sqlalchemy.engine.Engine [cached since 1390s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:28.310121')
2025-10-22 16:38:28,330 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:28,330 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:28,330 INFO sqlalchemy.engine.Engine [cached since 1390s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:28.310121')
2025-10-22 16:38:28,354 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:28,354 INFO sqlalchemy.engine.Engine [cached since 1387s ago] (1, 'completed', '2025-09-22 15:38:28.349886')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:28,360 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:28,360 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:63953 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:29,319 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:29,319 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:29,319 INFO sqlalchemy.engine.Engine [cached since 1391s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:29.319708')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:29,328 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:29,336 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:29,336 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:29,336 INFO sqlalchemy.engine.Engine [cached since 1391s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:29.328460')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:29,341 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:30,326 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:30,326 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:30,326 INFO sqlalchemy.engine.Engine [cached since 1392s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:30.326231')
2025-10-22 16:38:30,326 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:30,326 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:30,326 INFO sqlalchemy.engine.Engine [cached since 1392s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:30.326231')
2025-10-22 16:38:30,341 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:30,341 INFO sqlalchemy.engine.Engine [cached since 1392s ago] (1,)
2025-10-22 16:38:30,345 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:30,345 INFO sqlalchemy.engine.Engine [cached since 1389s ago] (1, 'completed', '2025-09-22 15:38:30.341404')
2025-10-22 16:38:30,345 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:30,345 INFO sqlalchemy.engine.Engine [cached since 1389s ago] (1,)
2025-10-22 16:38:30,352 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:30,358 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:7491 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:31,341 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:31,344 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:31,344 INFO sqlalchemy.engine.Engine [cached since 1393s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:31.341204')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:31,351 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:31,359 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:31,359 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:31,359 INFO sqlalchemy.engine.Engine [cached since 1393s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:31.357120')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:31,369 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:32,345 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:32,345 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:32,345 INFO sqlalchemy.engine.Engine [cached since 1394s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:32.339856')
2025-10-22 16:38:32,345 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:32,351 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:32,352 INFO sqlalchemy.engine.Engine [cached since 1394s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:32.343266')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:32,359 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:32,361 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:32,361 INFO sqlalchemy.engine.Engine [cached since 1394s ago] (1,)
2025-10-22 16:38:32,374 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:32,377 INFO sqlalchemy.engine.Engine [cached since 1391s ago] (1,)
INFO:     127.0.0.1:5700 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:32,387 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:33,360 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:33,360 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:33,360 INFO sqlalchemy.engine.Engine [cached since 1395s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:33.359411')
2025-10-22 16:38:33,360 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:33,364 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:33,364 INFO sqlalchemy.engine.Engine [cached since 1395s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:33.354311')
2025-10-22 16:38:33,371 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:33,371 INFO sqlalchemy.engine.Engine [cached since 1392s ago] (1, 'completed', '2025-09-22 15:38:33.369282')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:33,375 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:33,377 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:5700 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:34,359 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:34,359 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:34,359 INFO sqlalchemy.engine.Engine [cached since 1396s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:34.356201')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:34,369 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:34,374 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:34,374 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:34,374 INFO sqlalchemy.engine.Engine [cached since 1396s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:34.374362')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:34,387 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:35,369 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:35,369 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:35,369 INFO sqlalchemy.engine.Engine [cached since 1397s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:35.362531')
2025-10-22 16:38:35,371 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:35,371 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:35,371 INFO sqlalchemy.engine.Engine [cached since 1397s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:35.362531')
2025-10-22 16:38:35,376 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:35,376 INFO sqlalchemy.engine.Engine [cached since 1394s ago] (1, 'completed', '2025-09-22 15:38:35.374405')
2025-10-22 16:38:35,376 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:35,376 INFO sqlalchemy.engine.Engine [cached since 1397s ago] (1,)
2025-10-22 16:38:35,383 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:35,385 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:35,387 INFO sqlalchemy.engine.Engine [cached since 1394s ago] (1,)
INFO:     127.0.0.1:6671 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:35,405 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:36,374 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:36,374 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:36,374 INFO sqlalchemy.engine.Engine [cached since 1398s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:36.374274')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:36,388 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:36,395 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:36,395 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:36,395 INFO sqlalchemy.engine.Engine [cached since 1398s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:36.390960')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:36,404 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:37,386 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:37,386 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:37,386 INFO sqlalchemy.engine.Engine [cached since 1399s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:37.374737')
2025-10-22 16:38:37,386 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:37,389 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:37,389 INFO sqlalchemy.engine.Engine [cached since 1399s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:37.381074')
2025-10-22 16:38:37,395 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:37,395 INFO sqlalchemy.engine.Engine [cached since 1399s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:37,402 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:37,406 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:37,406 INFO sqlalchemy.engine.Engine [cached since 1396s ago] (1,)
INFO:     127.0.0.1:9037 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:37,409 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:38,395 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:38,395 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:38,395 INFO sqlalchemy.engine.Engine [cached since 1400s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:38.392439')
2025-10-22 16:38:38,395 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:38,395 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:38,395 INFO sqlalchemy.engine.Engine [cached since 1400s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:38.390406')
2025-10-22 16:38:38,404 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:38,404 INFO sqlalchemy.engine.Engine [cached since 1397s ago] (1, 'completed', '2025-09-22 15:38:38.404764')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:38,411 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:38,414 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:9037 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:39,405 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:39,405 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:39,405 INFO sqlalchemy.engine.Engine [cached since 1401s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:39.402200')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:39,411 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:39,419 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:39,421 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:39,421 INFO sqlalchemy.engine.Engine [cached since 1401s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:39.418479')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:39,426 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:40,409 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:40,409 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:40,409 INFO sqlalchemy.engine.Engine [cached since 1402s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:40.406677')
2025-10-22 16:38:40,409 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:40,415 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:40,417 INFO sqlalchemy.engine.Engine [cached since 1402s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:40.409932')
2025-10-22 16:38:40,418 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:40,418 INFO sqlalchemy.engine.Engine [cached since 1402s ago] (1,)
2025-10-22 16:38:40,424 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:40,426 INFO sqlalchemy.engine.Engine [cached since 1399s ago] (1, 'completed', '2025-09-22 15:38:40.424241')
2025-10-22 16:38:40,426 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:40,430 INFO sqlalchemy.engine.Engine [cached since 1399s ago] (1,)
2025-10-22 16:38:40,430 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:43529 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:40,454 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:41,411 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:41,411 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:41,411 INFO sqlalchemy.engine.Engine [cached since 1403s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:41.409273')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:41,421 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:41,426 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:41,426 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:41,426 INFO sqlalchemy.engine.Engine [cached since 1403s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:41.426652')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:41,437 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:42,418 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:42,419 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:42,419 INFO sqlalchemy.engine.Engine [cached since 1404s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:42.409341')
2025-10-22 16:38:42,419 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:42,419 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:42,419 INFO sqlalchemy.engine.Engine [cached since 1404s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:42.409341')
2025-10-22 16:38:42,437 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:42,440 INFO sqlalchemy.engine.Engine [cached since 1404s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:42,442 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:42,446 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:42,446 INFO sqlalchemy.engine.Engine [cached since 1401s ago] (1,)
INFO:     127.0.0.1:36844 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:42,454 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:44,472 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:44,474 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:44,475 INFO sqlalchemy.engine.Engine [cached since 1406s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:44.467198')
2025-10-22 16:38:44,475 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:44,476 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:44,476 INFO sqlalchemy.engine.Engine [cached since 1406s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:44.469287')
2025-10-22 16:38:44,493 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:44,493 INFO sqlalchemy.engine.Engine [cached since 1403s ago] (1, 'completed', '2025-09-22 15:38:44.489422')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:44,510 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:44,512 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:36844 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:46,295 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:46,295 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:46,295 INFO sqlalchemy.engine.Engine [cached since 1408s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:46.292170')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:46,297 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:46,306 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:46,306 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:46,306 INFO sqlalchemy.engine.Engine [cached since 1408s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:46.304188')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:46,312 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:47,792 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:47,792 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:47,792 INFO sqlalchemy.engine.Engine [cached since 1410s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:47.775903')
2025-10-22 16:38:47,792 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:47,792 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:47,794 INFO sqlalchemy.engine.Engine [cached since 1410s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:47.775118')
2025-10-22 16:38:47,820 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:47,820 INFO sqlalchemy.engine.Engine [cached since 1407s ago] (1, 'completed', '2025-09-22 15:38:47.818332')
2025-10-22 16:38:47,821 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:47,821 INFO sqlalchemy.engine.Engine [cached since 1410s ago] (1,)
2025-10-22 16:38:47,826 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:47,826 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:47,826 INFO sqlalchemy.engine.Engine [cached since 1407s ago] (1,)
INFO:     127.0.0.1:44942 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:47,848 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:48,773 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:48,774 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:48,774 INFO sqlalchemy.engine.Engine [cached since 1411s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:48.771305')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:48,777 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:48,784 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:48,784 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:48,784 INFO sqlalchemy.engine.Engine [cached since 1411s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:48.784295')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:48,793 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:49,793 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:49,793 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:49,793 INFO sqlalchemy.engine.Engine [cached since 1412s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:49.774147')
2025-10-22 16:38:49,793 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:49,795 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:49,795 INFO sqlalchemy.engine.Engine [cached since 1412s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:49.772131')
2025-10-22 16:38:49,801 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:49,801 INFO sqlalchemy.engine.Engine [cached since 1412s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:49,804 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:49,809 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:49,809 INFO sqlalchemy.engine.Engine [cached since 1408s ago] (1,)
INFO:     127.0.0.1:64249 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:49,817 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:50,800 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:50,800 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:50,802 INFO sqlalchemy.engine.Engine [cached since 1413s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:50.783585')
2025-10-22 16:38:50,802 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:50,802 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:50,802 INFO sqlalchemy.engine.Engine [cached since 1413s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:50.779728')
2025-10-22 16:38:50,809 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:50,809 INFO sqlalchemy.engine.Engine [cached since 1410s ago] (1, 'completed', '2025-09-22 15:38:50.804502')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:50,816 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:50,819 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:64249 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:51,783 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:51,783 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:51,783 INFO sqlalchemy.engine.Engine [cached since 1414s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:51.783839')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:51,795 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:51,801 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:51,801 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:51,804 INFO sqlalchemy.engine.Engine [cached since 1414s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:51.800268')
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:51,809 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:52,799 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:52,799 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:52,802 INFO sqlalchemy.engine.Engine [cached since 1415s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:52.788453')
2025-10-22 16:38:52,802 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:52,802 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:52,802 INFO sqlalchemy.engine.Engine [cached since 1415s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:52.795168')
2025-10-22 16:38:52,807 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:52,807 INFO sqlalchemy.engine.Engine [cached since 1412s ago] (1, 'completed', '2025-09-22 15:38:52.804211')
2025-10-22 16:38:52,809 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:52,809 INFO sqlalchemy.engine.Engine [cached since 1415s ago] (1,)
2025-10-22 16:38:52,816 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:52,816 INFO sqlalchemy.engine.Engine [cached since 1412s ago] (1,)
2025-10-22 16:38:52,818 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:59671 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:29570 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:52,837 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:53,805 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:53,805 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:53,805 INFO sqlalchemy.engine.Engine [cached since 1416s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:53.804574')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:53,811 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:53,822 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:53,822 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:53,822 INFO sqlalchemy.engine.Engine [cached since 1416s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:53.819393')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:53,830 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:54,809 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:54,810 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:54,810 INFO sqlalchemy.engine.Engine [cached since 1417s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:54.805449')
2025-10-22 16:38:54,811 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:54,811 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:54,811 INFO sqlalchemy.engine.Engine [cached since 1417s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:54.805449')
2025-10-22 16:38:54,820 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:54,820 INFO sqlalchemy.engine.Engine [cached since 1417s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:54,820 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:54,826 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:54,826 INFO sqlalchemy.engine.Engine [cached since 1414s ago] (1,)
INFO:     127.0.0.1:19072 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:54,833 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:55,824 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:55,824 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:55,824 INFO sqlalchemy.engine.Engine [cached since 1418s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:55.824470')
2025-10-22 16:38:55,824 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:55,824 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:55,830 INFO sqlalchemy.engine.Engine [cached since 1418s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:55.819692')
2025-10-22 16:38:55,852 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:55,852 INFO sqlalchemy.engine.Engine [cached since 1415s ago] (1, 'completed', '2025-09-22 15:38:55.847345')
2025-10-22 16:38:55,854 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:38:55,854 INFO sqlalchemy.engine.Engine [cached since 1031s ago] (1,)
2025-10-22 16:38:55,856 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:29570 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:38:55,863 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:19072 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
2025-10-22 16:38:56,824 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:56,824 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:56,824 INFO sqlalchemy.engine.Engine [cached since 1419s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:56.823224')
2025-10-22 16:38:56,830 INFO sqlalchemy.engine.Engine SELECT customers.id, customers.name, customers.email, customers.total_spent, customers.total_purchases, customers.last_purchase, customers.join_date, customers.status, customers.owner_id, customers.created_at, customers.updated_at 
FROM customers 
WHERE customers.owner_id = ? ORDER BY customers.created_at DESC
2025-10-22 16:38:56,830 INFO sqlalchemy.engine.Engine [cached since 1032s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/customers HTTP/1.1" 200 OK
2025-10-22 16:38:56,834 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:56,839 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:56,844 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:56,844 INFO sqlalchemy.engine.Engine [cached since 1419s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:56.839486')
INFO:     127.0.0.1:29570 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:56,852 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:57,841 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:57,841 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:57,845 INFO sqlalchemy.engine.Engine [cached since 1420s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:57.833467')
2025-10-22 16:38:57,846 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:57,846 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:57,846 INFO sqlalchemy.engine.Engine [cached since 1420s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:57.833467')
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:57,854 INFO sqlalchemy.engine.Engine ROLLBACK
INFO:     127.0.0.1:33005 - "GET /api/analytics/top-paywalls HTTP/1.1" 200 OK
2025-10-22 16:38:57,859 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:58,849 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:58,849 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:58,849 INFO sqlalchemy.engine.Engine [cached since 1421s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:58.845543')
2025-10-22 16:38:58,852 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:58,852 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:58,852 INFO sqlalchemy.engine.Engine [cached since 1421s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:58.842700')
2025-10-22 16:38:58,869 INFO sqlalchemy.engine.Engine SELECT date(payments.created_at) AS date, sum(payments.amount) AS revenue 
FROM payments 
WHERE payments.owner_id = ? AND payments.status = ? AND payments.created_at >= ? GROUP BY date(payments.created_at) ORDER BY date(payments.created_at)
2025-10-22 16:38:58,869 INFO sqlalchemy.engine.Engine [cached since 1418s ago] (1, 'completed', '2025-09-22 15:38:58.869917')
2025-10-22 16:38:58,874 INFO sqlalchemy.engine.Engine SELECT count(customers.id) AS count_1 
FROM customers 
WHERE customers.owner_id = ?
2025-10-22 16:38:58,876 INFO sqlalchemy.engine.Engine [cached since 1421s ago] (1,)
2025-10-22 16:38:58,879 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:58,883 INFO sqlalchemy.engine.Engine SELECT CAST(STRFTIME('%Y', customers.created_at) AS INTEGER) AS year, CAST(STRFTIME('%m', customers.created_at) AS INTEGER) AS month, count(customers.id) AS count 
FROM customers 
WHERE customers.owner_id = ? GROUP BY CAST(STRFTIME('%Y', customers.created_at) AS INTEGER), CAST(STRFTIME('%m', customers.created_at) AS INTEGER) ORDER BY year, month
2025-10-22 16:38:58,884 INFO sqlalchemy.engine.Engine [cached since 1418s ago] (1,)
INFO:     127.0.0.1:29570 - "GET /api/analytics/revenue-forecast HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 98, in receive
    return self.receive_nowait()
           ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 93, in receive_nowait
    raise WouldBlock
anyio.WouldBlock

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 78, in call_next
    message = await recv_stream.receive()
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    raise EndOfStream
anyio.EndOfStream

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\protocols\http\httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\AppData\Roaming\Python\Python312\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\applications.py", line 1106, in __call__
    await super().__call__(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 184, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\advanced_rate_limit.py", line 119, in rate_limit_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\trustedhost.py", line 51, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 108, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\utils\middleware\security_headers.py", line 8, in dispatch
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 84, in call_next
    raise app_exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 91, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "C:\Python312\Lib\site-packages\starlette\middleware\cors.py", line 146, in simple_response
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 79, in __call__
    raise exc
  File "C:\Python312\Lib\site-packages\starlette\middleware\exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 20, in __call__
    raise e
  File "C:\Python312\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "C:\Python312\Lib\site-packages\starlette\routing.py", line 66, in app
    response = await func(request)
               ^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 274, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Python312\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\routes\analytics.py", line 123, in get_revenue_forecast
    forecast = await analytics_service.get_revenue_forecast(db, current_user.id)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Home\Downloads\Documents\paygate\paygate-backend-python\services\analytics_service.py", line 498, in get_revenue_forecast
    return RevenueForecast(
                  ^^^^^^^^^^
NameError: name 'RevenueForecastData' is not defined. Did you mean: 'RevenueForecast'?
INFO:     127.0.0.1:33005 - "GET /api/analytics/customers HTTP/1.1" 200 OK
2025-10-22 16:38:58,904 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:59,857 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:59,857 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:59,857 INFO sqlalchemy.engine.Engine [cached since 1422s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:59.854573')
INFO:     127.0.0.1:33005 - "GET /api/analytics/dashboard HTTP/1.1" 200 OK
2025-10-22 16:38:59,861 INFO sqlalchemy.engine.Engine ROLLBACK
2025-10-22 16:38:59,869 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-10-22 16:38:59,869 INFO sqlalchemy.engine.Engine SELECT token_blacklist.id, token_blacklist.token, token_blacklist.blacklisted_on, token_blacklist.expires_at 
FROM token_blacklist 
WHERE token_blacklist.token = ? AND token_blacklist.expires_at > ?
2025-10-22 16:38:59,869 INFO sqlalchemy.engine.Engine [cached since 1422s ago] ('eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBleGFtcGxlLmNvbSIsImV4cCI6MTc2MTE0NzY2Mn0.8SV8ojarhHplUggC4jaq2i9_bUzpv3KoXpQ4jB7ZBHw', '2025-10-22 15:38:59.866530')
INFO:     127.0.0.1:33005 - "GET /api/analytics/revenue HTTP/1.1" 200 OK
2025-10-22 16:38:59,875 INFO sqlalchemy.engine.Engine ROLLBACK
